<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Rhiot Kura Gateway Sample (Emulator &amp; RaspberryPi)  | Greg. I/O</title>
<meta name="keywords" content="en, rhiot, RaspberryPi, Kura, Gateway">
<meta name="description" content="For a while, I develop during my free time for Rhiot project with my Red Hat colleague Henryk. We started to develop several Camel components like (kura, pi4j, bluetooth) with others volunteers. Now we focus to develop and integrate those components for Kura Platform. Kura is an OSGi Platform designed for IoT, it can run on RaspberryPi, BeagleBone or Intel Edison device. Kura Platform has got lot of embedded services for IoT context (GPIO, USB, I2C, Cloud Service, etc&hellip;) In this post we will see :">
<meta name="author" content="">
<link rel="canonical" href="https://gautric.github.io/blog/2015/12/03/rhiot-kura-gateway-sample-emulator-raspberrypi/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.26cca5596cf53898626a540511b92ee26f2bfa182bb8ac88d95536b8581f7899.css" integrity="sha256-JsylWWz1OJhialQFEbku4m8r&#43;hgruKyI2VU2uFgfeJk=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://gautric.github.io/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://gautric.github.io/android-icon-36x36.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://gautric.github.io/android-icon-36x36.png">
<link rel="apple-touch-icon" href="https://gautric.github.io/apple-icon-180x180.png">
<link rel="mask-icon" href="https://gautric.github.io/apple-icon-180x180.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://gautric.github.io/blog/2015/12/03/rhiot-kura-gateway-sample-emulator-raspberrypi/index.xml">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-60791597-1', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="Rhiot Kura Gateway Sample (Emulator &amp; RaspberryPi) " />
<meta property="og:description" content="For a while, I develop during my free time for Rhiot project with my Red Hat colleague Henryk. We started to develop several Camel components like (kura, pi4j, bluetooth) with others volunteers. Now we focus to develop and integrate those components for Kura Platform. Kura is an OSGi Platform designed for IoT, it can run on RaspberryPi, BeagleBone or Intel Edison device. Kura Platform has got lot of embedded services for IoT context (GPIO, USB, I2C, Cloud Service, etc&hellip;) In this post we will see :" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gautric.github.io/blog/2015/12/03/rhiot-kura-gateway-sample-emulator-raspberrypi/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-12-03T14:00:00+00:00" />
<meta property="article:modified_time" content="2015-12-03T14:00:00+00:00" /><meta property="og:site_name" content="Greg. I/O" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Rhiot Kura Gateway Sample (Emulator &amp; RaspberryPi) "/>
<meta name="twitter:description" content="For a while, I develop during my free time for Rhiot project with my Red Hat colleague Henryk. We started to develop several Camel components like (kura, pi4j, bluetooth) with others volunteers. Now we focus to develop and integrate those components for Kura Platform. Kura is an OSGi Platform designed for IoT, it can run on RaspberryPi, BeagleBone or Intel Edison device. Kura Platform has got lot of embedded services for IoT context (GPIO, USB, I2C, Cloud Service, etc&hellip;) In this post we will see :"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Rhiot Kura Gateway Sample (Emulator \u0026 RaspberryPi) ",
      "item": "https://gautric.github.io/blog/2015/12/03/rhiot-kura-gateway-sample-emulator-raspberrypi/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Rhiot Kura Gateway Sample (Emulator \u0026 RaspberryPi) ",
  "name": "Rhiot Kura Gateway Sample (Emulator \u0026 RaspberryPi) ",
  "description": "For a while, I develop during my free time for Rhiot project with my Red Hat colleague Henryk. We started to develop several Camel components like (kura, pi4j, bluetooth) with others volunteers. Now we focus to develop and integrate those components for Kura Platform. Kura is an OSGi Platform designed for IoT, it can run on RaspberryPi, BeagleBone or Intel Edison device. Kura Platform has got lot of embedded services for IoT context (GPIO, USB, I2C, Cloud Service, etc\u0026hellip;) In this post we will see :",
  "keywords": [
    "en", "rhiot", "RaspberryPi", "Kura", "Gateway"
  ],
  "articleBody": "For a while, I develop during my free time for Rhiot project with my Red Hat colleague Henryk. We started to develop several Camel components like (kura, pi4j, bluetooth) with others volunteers. Now we focus to develop and integrate those components for Kura Platform. Kura is an OSGi Platform designed for IoT, it can run on RaspberryPi, BeagleBone or Intel Edison device. Kura Platform has got lot of embedded services for IoT context (GPIO, USB, I2C, Cloud Service, etcâ€¦) In this post we will see :\nHow to use Kura Rhiot Quickstart into emulator mode and real life mode.\nRequisites Eclipse Mars Linux or Mac only for emulation One RaspberryPi tested w/ RPi B+ Two LEDs Two Resistors Wires Kura Setup Emulator setup First of all, you have to setup your Eclipse workspace with Kura eclipse workspace available for download. Just follow instruct strictly.\nWarning\nTo avoid any compilation problem please downgrade your JRE to a 1.7 version\nInfo\nYou can test and configure your workspace with Heater Demo Project\nCamel and Rhiot configuration into Emulator Target Definition configuration Before setup Camel and Rhiot into Kura Emulator, you have to download several java libraries :\ncamel-core-2.16.0.jar From ASF Camel camel-core-osgi-2.16.0.jar From ASF Camel camel-kura-2.16.0.jar From ASF Camel camel-kura-0.1.3-SNAPSHOT.jar From Rhiot Project Camel After create a new folder into target-definition project like camel/2.16.0 and copy all previous downloaded libraries into it.\nOpen Target Definition panel and Add... a new Installation mapped to the new camel/2.16.0 folder.\nVerify that Target Content loads correctly Camel and Rhiot libraries, click into Content tab to check.\nSave configuration and click the Set as Target Definition action (top right).\nLaunch configuration We just finish to setup Target Definition stack, now we will see how to run it with the Launch command.\nEdit it and select correct libraries once again.\nIn order to check Installation, just run the Launch command as usual and check bundles loading via OSGi ss command.\nosgi\u003e ss | grep camel 39\tACTIVE org.apache.camel.camel-core_2.16.0 47\tACTIVE org.apache.camel.camel-core-osgi_2.16.0 58\tACTIVE org.apache.camel.camel-kura_2.16.0 61\tACTIVE io.rhiot.camel-kura_0.1.3.SNAPSHOT true osgi\u003e Cool everything looks good to run our example !!!\nTest an run Kura Rhiot quickstart into emulator. Import Quickstart Sample Download our Kura Rhiot quickstart directly from github repository.\nChange GatewayRouter class with\nGatewayRouter contains our Camel route as usual. It is a OSGi Service. Change GatewayRouter.xml file with\nThis OSGi file is needed to start GatewayRouter service with Service Component Runtime mechanism. Because we use SCR an not BundleActivation stuff.\n, change io.rhiot.quickstarts.kura.camel.GatewayRouter.xml file with\nThis last file provides configuration attributes used by GatewayRouter route, like camel.kura.gpio.ouput.id.\nCompile via maven mvn clean package -Dmaven.test.skip=true to regenerate some MANIFEST and OSGi stuff via Bnd maven plugin.\nYou can also checkout remote branch https://github.com/rhiot/quickstarts/tree/kura-gpio.\nEmulator run Use Kura_Emulator_OSX Eclipse to run Equinox OSGi.\na little log4j modification `${loc_workspace}/org.eclipse.kura.emulator/src/main/resources/log4j.properties` file. ## eclipse log4j.logger.org.eclipse.kura.emulator.position=INFO log4j.logger.org.eclipse=WARN log4j.logger.io.rhiot=DEBUG log4j.logger.org.eclipse.kura.emulator.gpio=DEBUG log4j.logger.org.apache.camel=INFO log4j.logger.org.apache.camel.core.osgi=INFO {% endhighlight %} Output should looks like SLF4J: Class path contains multiple SLF4J bindings. SLF4J: Found binding in [bundleresource://28.fwk1988196802:1/org/slf4j/impl/StaticLoggerBinder.class] SLF4J: Found binding in [bundleresource://28.fwk1988196802:2/org/slf4j/impl/StaticLoggerBinder.class] SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation. osgi\u003e Framework is running in emulation mode 21:20:43,749 [Start Level Event Dispatcher] INFO Activator:96 - Camel activator starting 21:20:43,766 [Start Level Event Dispatcher] INFO Activator:102 - Camel activator started 21:20:44,114 [Component Resolve Thread] DEBUG GpioServiceImpl:21 - activating emulated GPIOService 21:20:44,825 [Component Resolve Thread] WARN SystemServiceImpl:769 - Maximum command line upload size not available. Set default to 100 MB 21:20:44,825 [Component Resolve Thread] WARN SystemServiceImpl:778 - Missing the parameter that specifies the maximum number of files uploadable using the command servlet. Set default to 1024 files 21:20:44,926 [Component Resolve Thread] DEBUG GatewayRouter:46 - Initializing bundle 40. 21:20:45,119 [Component Resolve Thread] INFO CamelContextHelper:583 - No existing PropertiesComponent has been configured, creating a new default PropertiesComponent with name: properties 21:20:45,128 [Component Resolve Thread] INFO OsgiDefaultCamelContext:2750 - Apache Camel 2.16.0 (CamelContext: camel-1) is starting 21:20:45,129 [Component Resolve Thread] INFO ManagedManagementStrategy:191 - JMX is enabled 21:20:45,439 [Component Resolve Thread] INFO DefaultRuntimeEndpointRegistry:203 - Runtime endpoint registry is in extended mode gathering usage statistics of all incoming and outgoing endpoints (cache limit: 1000) 21:20:45,565 [Component Resolve Thread] INFO KuraServiceFactory:45 - Found Kura org.eclipse.kura.gpio.GPIOService in the registry. Kura component will use that instance. 21:20:45,576 [Component Resolve Thread] INFO OsgiDefaultCamelContext:2983 - AllowUseOriginalMessage is enabled. If access to the original message is not needed, then its recommended to turn this option off as it may improve performance. 21:20:45,576 [Component Resolve Thread] INFO OsgiDefaultCamelContext:2993 - StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at http://camel.apache.org/stream-caching.html 21:20:45,608 [Component Resolve Thread] DEBUG KuraGPIOProducer:73 - Starting producer: Producer[kura-gpio://6?action=BLINK] 21:20:45,608 [Component Resolve Thread] INFO EmulatedPin:76 - Emulated GPIO Pin 6 open. 21:20:45,684 [Component Resolve Thread] INFO OsgiDefaultCamelContext:3514 - Route: route1 started and consuming from: Endpoint[timer://io.rhiot.kura.timer?period=5000] 21:20:45,686 [Component Resolve Thread] INFO OsgiDefaultCamelContext:2785 - Total 1 routes, of which 1 is started. 21:20:45,687 [Component Resolve Thread] INFO OsgiDefaultCamelContext:2786 - Apache Camel 2.16.0 (CamelContext: camel-1) started in 0.558 seconds 21:20:45,690 [Component Resolve Thread] DEBUG GatewayRouter:52 - Bundle 40 started. 21:20:45,690 [Component Resolve Thread] DEBUG GatewayRouter:48 - Refreshing SCR properties: org.eclipse.equinox.internal.ds.impl.ReadOnlyDictionary@283dd358 â€˜21:20:46,698 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO heartbeat:96 - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 21:20:46,701 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58 - Emulated GPIO Pin 6 changed to on 21:20:46,752 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58 - Emulated GPIO Pin 6 changed to off 21:20:51,691 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO heartbeat:96 - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 21:20:51,692 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58 - Emulated GPIO Pin 6 changed to on 21:20:51,745 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58 - Emulated GPIO Pin 6 changed to off 21:20:56,692 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO heartbeat:96 - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 21:20:56,692 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58 - Emulated GPIO Pin 6 changed to on 21:20:56,747 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58 - Emulated GPIO Pin 6 changed to off 21:21:01,697 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO heartbeat:96 - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 21:21:01,698 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58 - Emulated GPIO Pin 6 changed to on 21:21:01,752 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58 - Emulated GPIO Pin 6 changed to off 21:21:06,703 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO heartbeat:96 - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 21:21:06,704 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58 - Emulated GPIO Pin 6 changed to on 21:21:06,758 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58 - Emulated GPIO Pin 6 changed to off 21:21:11,708 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO heartbeat:96 - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 21:21:11,709 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58 - Emulated GPIO Pin 6 changed to on 21:21:11,763 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58 - Emulated GPIO Pin 6 changed to offâ€™ 21:21:13,798 [qtp1872598749-36] INFO /:1947 - org.eclipse.kura.web.server.GwtSecurityTokenServiceImpl: Trying www resource2: /www/denali/CF261C606092B547DDA8A7EE4A5B1ADC.gwt.rpc 21:21:13,821 [qtp1872598749-34] INFO /:1947 - org.eclipse.kura.web.server.GwtComponentServiceImpl: Trying www resource2: /www/denali/48673E1A90F237B138F81C0DF07ED6D7.gwt.rpc 21:21:13,914 [Component Resolve Thread (Bundle 58)] INFO DefaultShutdownStrategy:190 - Starting to graceful shutdown 1 routes (timeout 10 seconds) â€˜21:21:13,920 [Camel (camel-1) thread #2 - ShutdownTask] INFO DefaultShutdownStrategy:663 - Route: route1 shutdown complete, was consuming from: Endpoint[timer://io.rhiot.kura.timer?period=5000]â€™ 21:21:13,921 [Component Resolve Thread (Bundle 58)] INFO DefaultShutdownStrategy:254 - Graceful shutdown of 1 routes completed in 0 seconds 21:21:13,930 [Component Resolve Thread (Bundle 58)] DEBUG KuraGPIOProducer:82 - Stopping producer: Producer[kura-gpio://6?action=BLINK] 21:21:13,931 [Component Resolve Thread (Bundle 58)] INFO EmulatedPin:81 - Emulated GPIO Pin 6 closed. 21:21:13,933 [Component Resolve Thread (Bundle 58)] INFO OsgiDefaultCamelContext:3311 - Route: route1 is stopped, was consuming from: Endpoint[timer://io.rhiot.kura.timer?period=5000] 21:21:13,947 [Component Resolve Thread (Bundle 58)] INFO OsgiDefaultCamelContext:3311 - Route: route1 is shutdown and removed, was consuming from: Endpoint[timer://io.rhiot.kura.timer?period=5000] 21:21:13,949 [Component Resolve Thread (Bundle 58)] INFO OsgiDefaultCamelContext:3010 - Apache Camel 2.16.0 (CamelContext: camel-1) is shutting down 21:21:13,957 [Component Resolve Thread (Bundle 58)] INFO OsgiDefaultCamelContext:3095 - Apache Camel 2.16.0 (CamelContext: camel-1) uptime 28.829 seconds 21:21:13,957 [Component Resolve Thread (Bundle 58)] INFO OsgiDefaultCamelContext:3096 - Apache Camel 2.16.0 (CamelContext: camel-1) is shutdown in 0.009 seconds 21:21:13,961 [Component Resolve Thread (Bundle 58)] DEBUG GatewayRouter:48 - Refreshing SCR properties: org.eclipse.equinox.internal.ds.impl.ReadOnlyDictionary@283dd358 21:21:13,961 [Component Resolve Thread (Bundle 58)] INFO OsgiDefaultCamelContext:2750 - Apache Camel 2.16.0 (CamelContext: camel-1) is starting 21:21:13,961 [Component Resolve Thread (Bundle 58)] INFO ManagedManagementStrategy:191 - JMX is enabled 21:21:13,961 [Component Resolve Thread (Bundle 58)] INFO DefaultRuntimeEndpointRegistry:203 - Runtime endpoint registry is in extended mode gathering usage statistics of all incoming and outgoing endpoints (cache limit: 1000) 21:21:14,167 [Component Resolve Thread (Bundle 58)] INFO KuraServiceFactory:45 - Found Kura org.eclipse.kura.gpio.GPIOService in the registry. Kura component will use that instance. 21:21:14,171 [Component Resolve Thread (Bundle 58)] INFO OsgiDefaultCamelContext:2983 - AllowUseOriginalMessage is enabled. If access to the original message is not needed, then its recommended to turn this option off as it may improve performance. 21:21:14,171 [Component Resolve Thread (Bundle 58)] INFO OsgiDefaultCamelContext:2993 - StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at http://camel.apache.org/stream-caching.html 21:21:14,183 [Component Resolve Thread (Bundle 58)] DEBUG KuraGPIOProducer:73 - Starting producer: Producer[kura-gpio://3?action=TOGGLE] 21:21:14,183 [Component Resolve Thread (Bundle 58)] INFO EmulatedPin:76 - Emulated GPIO Pin 3 open. 21:21:14,224 [Component Resolve Thread (Bundle 58)] INFO OsgiDefaultCamelContext:3514 - Route: route1 started and consuming from: Endpoint[timer://io.rhiot.kura.timer?period=10000] 21:21:14,224 [Component Resolve Thread (Bundle 58)] INFO OsgiDefaultCamelContext:2785 - Total 1 routes, of which 1 is started. 21:21:14,225 [Component Resolve Thread (Bundle 58)] INFO OsgiDefaultCamelContext:2786 - Apache Camel 2.16.0 (CamelContext: camel-1) started in 0.263 seconds â€˜21:21:15,228 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO heartbeat:96 - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 21:21:15,228 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58 - Emulated GPIO Pin 3 changed to on 21:21:25,233 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO heartbeat:96 - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 21:21:25,234 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58 - Emulated GPIO Pin 3 changed to off 21:21:35,238 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO heartbeat:96 - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 21:21:35,239 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58 - Emulated GPIO Pin 3 changed to on 21:21:45,239 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO heartbeat:96 - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 21:21:45,239 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58 - Emulated GPIO Pin 3 changed to off 21:21:55,244 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO heartbeat:96 - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 21:21:55,244 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58 - Emulated GPIO Pin 3 changed to onâ€™\nYou can change some parameter via the Kura WebUI ## Execution IRL Let's run it IRL ### Wire, LED, RaspberryPi Follow schema below ### Bundles installation into RaspberryPi Compile Kura-Rhiot Sample via common `mvn clean package` After you have installed [Kura deb](https://s3.amazonaws.com/kura_downloads/raspbian/release/1.3.0/kura_1.3.0_raspberry-pi-bplus-nn_installer.deb) into RaspberryPi you can start and install bundles. To start kura service: rpbi\u003e sudo service kura start\nyou can use `tail -f /var/log/kura.log` to check Kura Platform running. Copy to RaspberryPi and Install all bundles via command line. Connect to Kura OSGi via telnet protocol: rpbi\u003e telnet 127.0.0.1 5002 Trying 127.0.0.1â€¦ Connected to 127.0.0.1. Escape character is â€˜^]â€™.\nosgi\u003e osgi\u003e install file:///home/pi/kura/camel-core-2.16.0.jar osgi\u003e install file:///home/pi/kura/camel-core-osgi-2.16.0.jar osgi\u003e install file:///home/pi/kura/camel-kura-2.16.0.jar osgi\u003e install file:///home/pi/kura/camel-kura-0.1.3-SNAPSHOT.jar osgi\u003e install file:///home/pi/kura/rhiot-kura-camel-1.0.0-SNAPSHOT.jar\nAnd start all INSTALLED bundle start 69 70 71 72 73 // for example\nOutput should look like this 2015-12-02 21:37:24,414 [Component Resolve Thread (Bundle 6)] DEBUG i.r.q.k.c.GatewayRouter - Initializing bundle 75. 2015-12-02 21:37:24,424 [Component Resolve Thread (Bundle 6)] INFO o.a.c.u.CamelContextHelper - No existing PropertiesComponent has been configured, creating a new default PropertiesComponent with name: properties 2015-12-02 21:37:24,432 [Component Resolve Thread (Bundle 6)] INFO o.a.c.c.o.OsgiDefaultCamelContext - Apache Camel 2.16.0 (CamelContext: camel-2) is starting 2015-12-02 21:37:24,433 [Component Resolve Thread (Bundle 6)] INFO o.a.c.m.ManagedManagementStrategy - JMX is enabled 2015-12-02 21:37:24,934 [Component Resolve Thread (Bundle 6)] INFO o.a.c.i.DefaultRuntimeEndpointRegistry - Runtime endpoint registry is in extended mode gathering usage statistics of all incoming and outgoing endpoints (cache limit: 1000) 2015-12-02 21:37:25,242 [Component Resolve Thread (Bundle 6)] INFO i.r.c.k.u.KuraServiceFactory - Found Kura org.eclipse.kura.gpio.GPIOService in the registry. Kura component will use that instance. 2015-12-02 21:37:25,260 [Component Resolve Thread (Bundle 6)] INFO o.a.c.c.o.OsgiDefaultCamelContext - AllowUseOriginalMessage is enabled. If access to the original message is not needed, then its recommended to turn this option off as it may improve performance. 2015-12-02 21:37:25,263 [Component Resolve Thread (Bundle 6)] INFO o.a.c.c.o.OsgiDefaultCamelContext - StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at http://camel.apache.org/stream-caching.html 2015-12-02 21:37:25,330 [Component Resolve Thread (Bundle 6)] DEBUG i.r.c.k.g.KuraGPIOProducer - Starting producer: Producer[kura-gpio://3?action=BLINK] 2015-12-02 21:37:25,619 [Component Resolve Thread (Bundle 6)] INFO o.a.c.c.o.OsgiDefaultCamelContext - Route: route2 started and consuming from: Endpoint[timer://io.rhiot.kura.timer?period=1000] 2015-12-02 21:37:25,622 [Component Resolve Thread (Bundle 6)] INFO o.a.c.c.o.OsgiDefaultCamelContext - Total 1 routes, of which 1 is started. 2015-12-02 21:37:25,624 [Component Resolve Thread (Bundle 6)] INFO o.a.c.c.o.OsgiDefaultCamelContext - Apache Camel 2.16.0 (CamelContext: camel-2) started in 1.191 seconds 2015-12-02 21:37:25,639 [Component Resolve Thread (Bundle 6)] DEBUG i.r.q.k.c.GatewayRouter - Bundle 75 started. 2015-12-02 21:37:25,640 [Component Resolve Thread (Bundle 6)] DEBUG i.r.q.k.c.GatewayRouter - Refreshing SCR properties: org.eclipse.equinox.internal.ds.impl.ReadOnlyDictionary@18158f3 2015-12-02 21:37:25,649 [Component Resolve Thread (Bundle 6)] INFO o.e.k.c.c.ConfigurableComponentTracker - Adding ConfigurableComponent io.rhiot.quickstarts.kura.camel.GatewayRouter 2015-12-02 21:37:25,657 [Component Resolve Thread (Bundle 6)] INFO o.e.k.c.c.ConfigurationServiceImpl - Registration of ConfigurableComponent io.rhiot.quickstarts.kura.camel.GatewayRouter by org.eclipse.kura.core.configuration.ConfigurationServiceImpl@18b94e4â€¦ 2015-12-02 21:37:25,700 [Component Resolve Thread (Bundle 6)] INFO o.e.k.c.c.ConfigurationServiceImpl - Registering io.rhiot.quickstarts.kura.camel.GatewayRouter with ocd: org.eclipse.kura.core.configuration.metatype.Tocd@1a80018 â€¦ 2015-12-02 21:37:25,701 [Component Resolve Thread (Bundle 6)] INFO o.e.k.c.c.ConfigurationServiceImpl - Registration Completed for Component io.rhiot.quickstarts.kura.camel.GatewayRouter. 2015-12-02 21:37:26,625 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 2015-12-02 21:37:27,735 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 2015-12-02 21:37:28,735 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 2015-12-02 21:37:29,736 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 2015-12-02 21:37:30,736 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 2015-12-02 21:37:31,736 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]] 2015-12-02 21:37:32,736 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]\n### YouTube Demo ## Conclusion [Kura Platform](http://www.eclipse.org/kura/) is really interesting OSGi Platform. As we prove today, the setup is not too complex if you know what you do. I love OSGi technology for its modularity, its flexibility and its robustness. If we can plug Camel and Rhiot bundles, I think we can develop some cool new components, applications and products. Let's develop and contribute more for [Kura](http://www.eclipse.org/kura/) , [Camel](http://camel.apache.org) and [Rhiot](http://rhiot.io) project too. Stay tuned !!! Please feel free to send me your feedback see [Apropos](/apropos/). ### Useful links * [KuraGateway configuration](http://127.0.0.1:8080/kura) * [rhiot projet](http://rhiot.io) * [camel-kura component](https://github.com/rhiot/rhiot/tree/master/gateway/components/camel-kura) ",
  "wordCount" : "2464",
  "inLanguage": "en",
  "datePublished": "2015-12-03T14:00:00Z",
  "dateModified": "2015-12-03T14:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://gautric.github.io/blog/2015/12/03/rhiot-kura-gateway-sample-emulator-raspberrypi/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Greg. I/O",
    "logo": {
      "@type": "ImageObject",
      "url": "https://gautric.github.io/apple-icon-180x180.png"
    }
  }
}
</script>
</head>

<body class="" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://gautric.github.io" accesskey="h" title="Greg. I/O (Alt + H)">
                <img src="https://gautric.github.io/apple-icon-180x180.png" alt="" aria-label="logo"
                    height="35">Greg. I/O</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://gautric.github.io/apropos/" title="Ã€ Propos">
                    <span>Ã€ Propos</span>
                </a>
            </li>
            <li>
                <a href="https://gautric.github.io/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://gautric.github.io/contact/" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://gautric.github.io">Home</a></div>
    <h1 class="post-title entry-hint-parent">
      Rhiot Kura Gateway Sample (Emulator &amp; RaspberryPi) 
    </h1>
    <div class="post-meta"><span title='2015-12-03 14:00:00 +0000 UTC'>December 3, 2015</span>

</div>
  </header> 
  <div class="post-content"><p>For a while, I develop during my free time for <a href="http://rhiot.io">Rhiot project</a> with my Red Hat colleague <a href="http://henryk-konsek.blogspot.fr/">Henryk</a>. We started to develop several <a href="http://camel.apache.org/components.html#Components-ExternalComponents">Camel components</a> like (kura, pi4j, bluetooth) with others volunteers.
Now we focus to develop and integrate those components for <a href="http://www.eclipse.org/kura/">Kura Platform</a>. Kura is an <a href="http://www.osgi.org">OSGi Platform</a> designed for IoT, it can run on RaspberryPi, BeagleBone or Intel Edison device.
Kura Platform has got lot of embedded services for IoT context (GPIO, USB, I2C, Cloud Service, etc&hellip;)
In this post we will see :</p>
<blockquote>
<p>How to use Kura Rhiot Quickstart into emulator mode and real life mode.</p>
</blockquote>
<h2 id="requisites">Requisites<a hidden class="anchor" aria-hidden="true" href="#requisites">#</a></h2>
<ul>
<li><a href="https://projects.eclipse.org/releases/mars">Eclipse Mars</a>
<ul>
<li>Linux or Mac only for emulation</li>
</ul>
</li>
<li>One <a href="https://www.raspberrypi.org/products/raspberry-pi-2-model-b/">RaspberryPi</a>
<ul>
<li>tested w/ RPi B+</li>
</ul>
</li>
<li>Two LEDs</li>
<li>Two Resistors</li>
<li>Wires</li>
</ul>
<h2 id="kura-setup">Kura Setup<a hidden class="anchor" aria-hidden="true" href="#kura-setup">#</a></h2>
<h3 id="emulator-setup">Emulator setup<a hidden class="anchor" aria-hidden="true" href="#emulator-setup">#</a></h3>
<p>First of all, you have to setup your Eclipse workspace with <a href="https://eclipse.org/kura/downloads.php">Kura eclipse workspace available for download</a>.
<a href="http://eclipse.github.io/kura/doc/raspberry-pi-quick-start.html">Just follow instruct strictly</a>.</p>
<div><svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg"><symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></symbol></svg></div><div class="notice warning" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#warning-notice"></use></svg></span>Warning</p><p>To avoid any compilation problem please downgrade your JRE to a 1.7 version</p></div>

<div class="notice info" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#info-notice"></use></svg></span>Info</p><p>You can test and configure your workspace with Heater Demo Project</p></div>

<h3 id="camel-and-rhiot-configuration-into-emulator">Camel and Rhiot configuration into Emulator<a hidden class="anchor" aria-hidden="true" href="#camel-and-rhiot-configuration-into-emulator">#</a></h3>
<h4 id="target-definition-configuration">Target Definition configuration<a hidden class="anchor" aria-hidden="true" href="#target-definition-configuration">#</a></h4>
<p>Before setup Camel and Rhiot into Kura Emulator, you have to download several java libraries :</p>
<ul>
<li>camel-core-2.16.0.jar
<ul>
<li>From <a href="http://camel.apache.org">ASF Camel</a></li>
</ul>
</li>
<li>camel-core-osgi-2.16.0.jar
<ul>
<li>From <a href="http://camel.apache.org">ASF Camel</a></li>
</ul>
</li>
<li>camel-kura-2.16.0.jar
<ul>
<li>From <a href="http://camel.apache.org">ASF Camel</a></li>
</ul>
</li>
<li>camel-kura-0.1.3-SNAPSHOT.jar
<ul>
<li>From <a href="http://rhiot.io">Rhiot Project Camel</a></li>
</ul>
</li>
</ul>
<p>After create a new folder into <code>target-definition</code> project like <code>camel/2.16.0</code> and copy all previous downloaded libraries into it.</p>
<img src="/img/kura-camel-rhiot-1.png" style="max-width:33%;" />
<p>Open Target Definition panel and <code>Add...</code> a new <code>Installation</code> mapped to the new <code>camel/2.16.0</code> folder.</p>
<img src="/img/kura-camel-rhiot-2.png" style="max-width:100%;" />
<p>Verify that <code>Target Content</code> loads correctly Camel and Rhiot libraries, click into <code>Content</code> tab to check.</p>
<img src="/img/kura-camel-rhiot-3.png" style="max-width:100%;" />
<p>Save configuration and click the <code>Set as Target Definition</code> action (top right).</p>
<h4 id="launch-configuration">Launch configuration<a hidden class="anchor" aria-hidden="true" href="#launch-configuration">#</a></h4>
<p>We just finish to setup <code>Target Definition</code> stack, now we will see how to run it with the <code>Launch</code> command.</p>
<img src="/img/kura-camel-rhiot-4.png" style="max-width:33%;" />
<img src="/img/kura-camel-rhiot-5.png" style="max-width:33%;" />
<p>Edit it and select correct libraries once again.</p>
<img src="/img/kura-camel-rhiot-6.png" style="max-width:100%;" />
<p>In order to check Installation, just run the <code>Launch</code> command as usual and check bundles loading via OSGi <code>ss</code> command.</p>
<pre tabindex="0"><code>
osgi&gt; ss | grep camel
39	ACTIVE      org.apache.camel.camel-core_2.16.0
47	ACTIVE      org.apache.camel.camel-core-osgi_2.16.0
58	ACTIVE      org.apache.camel.camel-kura_2.16.0
61	ACTIVE      io.rhiot.camel-kura_0.1.3.SNAPSHOT
true
osgi&gt;
</code></pre><img src="/img/kura-camel-rhiot-7.png" style="max-width:100%;" />
<p><em>Cool everything looks good to run our example !!!</em></p>
<h2 id="test-an-run-kura-rhiot-quickstart-into-emulator">Test an run Kura Rhiot quickstart into emulator.<a hidden class="anchor" aria-hidden="true" href="#test-an-run-kura-rhiot-quickstart-into-emulator">#</a></h2>
<h3 id="import-quickstart-sample">Import Quickstart Sample<a hidden class="anchor" aria-hidden="true" href="#import-quickstart-sample">#</a></h3>
<p>Download our <a href="https://github.com/rhiot/quickstarts/tree/master/kura-camel">Kura Rhiot quickstart directly from github repository</a>.</p>
<p>Change <code>GatewayRouter</code> class with</p>
<script src="https://gist.github.com/gautric/e478b4b28b40c8270257.js"></script>
<p><code>GatewayRouter</code> contains our Camel route as usual. It is a OSGi Service. Change <code>GatewayRouter.xml</code> file with</p>
<script src="https://gist.github.com/gautric/2134986bb6114b035cd5.js"></script>
<p>This OSGi file is needed to start GatewayRouter service with <a href="https://osgi.org/xmlns/scr/v1.1.0/scr.xsd">Service Component Runtime</a> mechanism. Because we use SCR an not BundleActivation stuff.</p>
<p>, change <code>io.rhiot.quickstarts.kura.camel.GatewayRouter.xml</code> file with</p>
<script src="https://gist.github.com/gautric/052adb5b2acf1b96c3cc.js"></script>
<p>This last file provides configuration attributes used by <code>GatewayRouter</code> route, like <code>camel.kura.gpio.ouput.id</code>.</p>
<p>Compile via maven <code>mvn clean package -Dmaven.test.skip=true</code> to regenerate some MANIFEST and OSGi stuff via Bnd maven plugin.</p>
<p>You can also checkout remote branch <code>https://github.com/rhiot/quickstarts/tree/kura-gpio</code>.</p>
<h4 id="emulator-run">Emulator run<a hidden class="anchor" aria-hidden="true" href="#emulator-run">#</a></h4>
<p>Use <code>Kura_Emulator_OSX</code> Eclipse to run Equinox OSGi.</p>
<pre tabindex="0"><code>
a little log4j modification `${loc_workspace}/org.eclipse.kura.emulator/src/main/resources/log4j.properties` file.

## eclipse
log4j.logger.org.eclipse.kura.emulator.position=INFO
log4j.logger.org.eclipse=WARN
log4j.logger.io.rhiot=DEBUG
log4j.logger.org.eclipse.kura.emulator.gpio=DEBUG
log4j.logger.org.apache.camel=INFO
log4j.logger.org.apache.camel.core.osgi=INFO
{% endhighlight  %}

Output should looks like
</code></pre><p>SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [bundleresource://28.fwk1988196802:1/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [bundleresource://28.fwk1988196802:2/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See <a href="http://www.slf4j.org/codes.html#multiple_bindings">http://www.slf4j.org/codes.html#multiple_bindings</a> for an explanation.
osgi&gt; Framework is running in emulation mode
21:20:43,749 [Start Level Event Dispatcher] INFO  Activator:96  - Camel activator starting
21:20:43,766 [Start Level Event Dispatcher] INFO  Activator:102  - Camel activator started
21:20:44,114 [Component Resolve Thread] DEBUG GpioServiceImpl:21  - activating emulated GPIOService
21:20:44,825 [Component Resolve Thread] WARN  SystemServiceImpl:769  - Maximum command line upload size not available. Set default to 100 MB
21:20:44,825 [Component Resolve Thread] WARN  SystemServiceImpl:778  - Missing the parameter that specifies the maximum number of files uploadable using the command servlet. Set default to 1024 files
21:20:44,926 [Component Resolve Thread] DEBUG GatewayRouter:46  - Initializing bundle 40.
21:20:45,119 [Component Resolve Thread] INFO  CamelContextHelper:583  - No existing PropertiesComponent has been configured, creating a new default PropertiesComponent with name: properties
21:20:45,128 [Component Resolve Thread] INFO  OsgiDefaultCamelContext:2750  - Apache Camel 2.16.0 (CamelContext: camel-1) is starting
21:20:45,129 [Component Resolve Thread] INFO  ManagedManagementStrategy:191  - JMX is enabled
21:20:45,439 [Component Resolve Thread] INFO  DefaultRuntimeEndpointRegistry:203  - Runtime endpoint registry is in extended mode gathering usage statistics of all incoming and outgoing endpoints (cache limit: 1000)
21:20:45,565 [Component Resolve Thread] INFO  KuraServiceFactory:45  - Found Kura org.eclipse.kura.gpio.GPIOService in the registry. Kura component will use that instance.
21:20:45,576 [Component Resolve Thread] INFO  OsgiDefaultCamelContext:2983  - AllowUseOriginalMessage is enabled. If access to the original message is not needed, then its recommended to turn this option off as it may improve performance.
21:20:45,576 [Component Resolve Thread] INFO  OsgiDefaultCamelContext:2993  - StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at <a href="http://camel.apache.org/stream-caching.html">http://camel.apache.org/stream-caching.html</a>
21:20:45,608 [Component Resolve Thread] DEBUG KuraGPIOProducer:73  - Starting producer: Producer[kura-gpio://6?action=BLINK]
21:20:45,608 [Component Resolve Thread] INFO  EmulatedPin:76  - Emulated GPIO Pin 6 open.
21:20:45,684 [Component Resolve Thread] INFO  OsgiDefaultCamelContext:3514  - Route: route1 started and consuming from: Endpoint[timer://io.rhiot.kura.timer?period=5000]
21:20:45,686 [Component Resolve Thread] INFO  OsgiDefaultCamelContext:2785  - Total 1 routes, of which 1 is started.
21:20:45,687 [Component Resolve Thread] INFO  OsgiDefaultCamelContext:2786  - Apache Camel 2.16.0 (CamelContext: camel-1) started in 0.558 seconds
21:20:45,690 [Component Resolve Thread] DEBUG GatewayRouter:52  - Bundle 40 started.
21:20:45,690 [Component Resolve Thread] DEBUG GatewayRouter:48  - Refreshing SCR properties: org.eclipse.equinox.internal.ds.impl.ReadOnlyDictionary@283dd358
&lsquo;21:20:46,698 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:20:46,701 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to on
21:20:46,752 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to off
21:20:51,691 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:20:51,692 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to on
21:20:51,745 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to off
21:20:56,692 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:20:56,692 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to on
21:20:56,747 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to off
21:21:01,697 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:01,698 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to on
21:21:01,752 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to off
21:21:06,703 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:06,704 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to on
21:21:06,758 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to off
21:21:11,708 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:11,709 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to on
21:21:11,763 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to off&rsquo;
21:21:13,798 [qtp1872598749-36] INFO  /:1947  - org.eclipse.kura.web.server.GwtSecurityTokenServiceImpl: Trying www resource2: /www/denali/CF261C606092B547DDA8A7EE4A5B1ADC.gwt.rpc
21:21:13,821 [qtp1872598749-34] INFO  /:1947  - org.eclipse.kura.web.server.GwtComponentServiceImpl: Trying www resource2: /www/denali/48673E1A90F237B138F81C0DF07ED6D7.gwt.rpc
21:21:13,914 [Component Resolve Thread (Bundle 58)] INFO  DefaultShutdownStrategy:190  - Starting to graceful shutdown 1 routes (timeout 10 seconds)
&lsquo;21:21:13,920 [Camel (camel-1) thread #2 - ShutdownTask] INFO  DefaultShutdownStrategy:663  - Route: route1 shutdown complete, was consuming from: Endpoint[timer://io.rhiot.kura.timer?period=5000]&rsquo;
21:21:13,921 [Component Resolve Thread (Bundle 58)] INFO  DefaultShutdownStrategy:254  - Graceful shutdown of 1 routes completed in 0 seconds
21:21:13,930 [Component Resolve Thread (Bundle 58)] DEBUG KuraGPIOProducer:82  - Stopping producer: Producer[kura-gpio://6?action=BLINK]
21:21:13,931 [Component Resolve Thread (Bundle 58)] INFO  EmulatedPin:81  - Emulated GPIO Pin 6 closed.
21:21:13,933 [Component Resolve Thread (Bundle 58)] INFO  OsgiDefaultCamelContext:3311  - Route: route1 is stopped, was consuming from: Endpoint[timer://io.rhiot.kura.timer?period=5000]
21:21:13,947 [Component Resolve Thread (Bundle 58)] INFO  OsgiDefaultCamelContext:3311  - Route: route1 is shutdown and removed, was consuming from: Endpoint[timer://io.rhiot.kura.timer?period=5000]
21:21:13,949 [Component Resolve Thread (Bundle 58)] INFO  OsgiDefaultCamelContext:3010  - Apache Camel 2.16.0 (CamelContext: camel-1) is shutting down
21:21:13,957 [Component Resolve Thread (Bundle 58)] INFO  OsgiDefaultCamelContext:3095  - Apache Camel 2.16.0 (CamelContext: camel-1) uptime 28.829 seconds
21:21:13,957 [Component Resolve Thread (Bundle 58)] INFO  OsgiDefaultCamelContext:3096  - Apache Camel 2.16.0 (CamelContext: camel-1) is shutdown in 0.009 seconds
21:21:13,961 [Component Resolve Thread (Bundle 58)] DEBUG GatewayRouter:48  - Refreshing SCR properties: org.eclipse.equinox.internal.ds.impl.ReadOnlyDictionary@283dd358
21:21:13,961 [Component Resolve Thread (Bundle 58)] INFO  OsgiDefaultCamelContext:2750  - Apache Camel 2.16.0 (CamelContext: camel-1) is starting
21:21:13,961 [Component Resolve Thread (Bundle 58)] INFO  ManagedManagementStrategy:191  - JMX is enabled
21:21:13,961 [Component Resolve Thread (Bundle 58)] INFO  DefaultRuntimeEndpointRegistry:203  - Runtime endpoint registry is in extended mode gathering usage statistics of all incoming and outgoing endpoints (cache limit: 1000)
21:21:14,167 [Component Resolve Thread (Bundle 58)] INFO  KuraServiceFactory:45  - Found Kura org.eclipse.kura.gpio.GPIOService in the registry. Kura component will use that instance.
21:21:14,171 [Component Resolve Thread (Bundle 58)] INFO  OsgiDefaultCamelContext:2983  - AllowUseOriginalMessage is enabled. If access to the original message is not needed, then its recommended to turn this option off as it may improve performance.
21:21:14,171 [Component Resolve Thread (Bundle 58)] INFO  OsgiDefaultCamelContext:2993  - StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at <a href="http://camel.apache.org/stream-caching.html">http://camel.apache.org/stream-caching.html</a>
21:21:14,183 [Component Resolve Thread (Bundle 58)] DEBUG KuraGPIOProducer:73  - Starting producer: Producer[kura-gpio://3?action=TOGGLE]
21:21:14,183 [Component Resolve Thread (Bundle 58)] INFO  EmulatedPin:76  - Emulated GPIO Pin 3 open.
21:21:14,224 [Component Resolve Thread (Bundle 58)] INFO  OsgiDefaultCamelContext:3514  - Route: route1 started and consuming from: Endpoint[timer://io.rhiot.kura.timer?period=10000]
21:21:14,224 [Component Resolve Thread (Bundle 58)] INFO  OsgiDefaultCamelContext:2785  - Total 1 routes, of which 1 is started.
21:21:14,225 [Component Resolve Thread (Bundle 58)] INFO  OsgiDefaultCamelContext:2786  - Apache Camel 2.16.0 (CamelContext: camel-1) started in 0.263 seconds
&lsquo;21:21:15,228 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:15,228 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58  - Emulated GPIO Pin 3 changed to on
21:21:25,233 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:25,234 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58  - Emulated GPIO Pin 3 changed to off
21:21:35,238 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:35,239 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58  - Emulated GPIO Pin 3 changed to on
21:21:45,239 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:45,239 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58  - Emulated GPIO Pin 3 changed to off
21:21:55,244 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:55,244 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58  - Emulated GPIO Pin 3 changed to on&rsquo;</p>
<pre tabindex="0"><code>
You can change some parameter via the Kura WebUI

&lt;img src=&#34;/img/kura-camel-rhiot-7bis.png&#34; style=&#34;max-width:100%;&#34; /&gt;

## Execution IRL

Let&#39;s run it IRL

### Wire, LED, RaspberryPi

Follow schema below

&lt;img src=&#34;/img/kura-camel-rhiot-8.png&#34; style=&#34;max-width:80%;&#34; /&gt;


### Bundles installation into RaspberryPi

Compile Kura-Rhiot Sample via common `mvn clean package`

After you have installed [Kura deb](https://s3.amazonaws.com/kura_downloads/raspbian/release/1.3.0/kura_1.3.0_raspberry-pi-bplus-nn_installer.deb) into RaspberryPi you can start and install bundles.

To start kura service:
</code></pre><p>rpbi&gt; sudo service kura start</p>
<pre tabindex="0"><code>
you can use `tail -f /var/log/kura.log` to check Kura Platform running.

Copy to RaspberryPi and Install all bundles via command line. Connect to Kura OSGi via telnet protocol:
</code></pre><p>rpbi&gt; telnet 127.0.0.1 5002
Trying 127.0.0.1&hellip;
Connected to 127.0.0.1.
Escape character is &lsquo;^]&rsquo;.</p>
<p>osgi&gt;
osgi&gt; install file:///home/pi/kura/camel-core-2.16.0.jar
osgi&gt; install file:///home/pi/kura/camel-core-osgi-2.16.0.jar
osgi&gt; install file:///home/pi/kura/camel-kura-2.16.0.jar           <br>
osgi&gt; install file:///home/pi/kura/camel-kura-0.1.3-SNAPSHOT.jar   <br>
osgi&gt; install file:///home/pi/kura/rhiot-kura-camel-1.0.0-SNAPSHOT.jar</p>
<pre tabindex="0"><code>
And start all INSTALLED bundle
</code></pre><p>start 69 70 71 72 73  // for example</p>
<pre tabindex="0"><code>

Output should look like this
</code></pre><p>2015-12-02 21:37:24,414 [Component Resolve Thread (Bundle 6)] DEBUG i.r.q.k.c.GatewayRouter - Initializing bundle 75.
2015-12-02 21:37:24,424 [Component Resolve Thread (Bundle 6)] INFO  o.a.c.u.CamelContextHelper - No existing PropertiesComponent has been configured, creating a new default PropertiesComponent with name: properties
2015-12-02 21:37:24,432 [Component Resolve Thread (Bundle 6)] INFO  o.a.c.c.o.OsgiDefaultCamelContext - Apache Camel 2.16.0 (CamelContext: camel-2) is starting
2015-12-02 21:37:24,433 [Component Resolve Thread (Bundle 6)] INFO  o.a.c.m.ManagedManagementStrategy - JMX is enabled
2015-12-02 21:37:24,934 [Component Resolve Thread (Bundle 6)] INFO  o.a.c.i.DefaultRuntimeEndpointRegistry - Runtime endpoint registry is in extended mode gathering usage statistics of all incoming and outgoing endpoints (cache limit: 1000)
2015-12-02 21:37:25,242 [Component Resolve Thread (Bundle 6)] INFO  i.r.c.k.u.KuraServiceFactory - Found Kura org.eclipse.kura.gpio.GPIOService in the registry. Kura component will use that instance.
2015-12-02 21:37:25,260 [Component Resolve Thread (Bundle 6)] INFO  o.a.c.c.o.OsgiDefaultCamelContext - AllowUseOriginalMessage is enabled. If access to the original message is not needed, then its recommended to turn this option off as it may improve performance.
2015-12-02 21:37:25,263 [Component Resolve Thread (Bundle 6)] INFO  o.a.c.c.o.OsgiDefaultCamelContext - StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at <a href="http://camel.apache.org/stream-caching.html">http://camel.apache.org/stream-caching.html</a>
2015-12-02 21:37:25,330 [Component Resolve Thread (Bundle 6)] DEBUG i.r.c.k.g.KuraGPIOProducer - Starting producer: Producer[kura-gpio://3?action=BLINK]
2015-12-02 21:37:25,619 [Component Resolve Thread (Bundle 6)] INFO  o.a.c.c.o.OsgiDefaultCamelContext - Route: route2 started and consuming from: Endpoint[timer://io.rhiot.kura.timer?period=1000]
2015-12-02 21:37:25,622 [Component Resolve Thread (Bundle 6)] INFO  o.a.c.c.o.OsgiDefaultCamelContext - Total 1 routes, of which 1 is started.
2015-12-02 21:37:25,624 [Component Resolve Thread (Bundle 6)] INFO  o.a.c.c.o.OsgiDefaultCamelContext - Apache Camel 2.16.0 (CamelContext: camel-2) started in 1.191 seconds
2015-12-02 21:37:25,639 [Component Resolve Thread (Bundle 6)] DEBUG i.r.q.k.c.GatewayRouter - Bundle 75 started.
2015-12-02 21:37:25,640 [Component Resolve Thread (Bundle 6)] DEBUG i.r.q.k.c.GatewayRouter - Refreshing SCR properties: org.eclipse.equinox.internal.ds.impl.ReadOnlyDictionary@18158f3
2015-12-02 21:37:25,649 [Component Resolve Thread (Bundle 6)] INFO  o.e.k.c.c.ConfigurableComponentTracker - Adding ConfigurableComponent io.rhiot.quickstarts.kura.camel.GatewayRouter
2015-12-02 21:37:25,657 [Component Resolve Thread (Bundle 6)] INFO  o.e.k.c.c.ConfigurationServiceImpl - Registration of ConfigurableComponent io.rhiot.quickstarts.kura.camel.GatewayRouter by org.eclipse.kura.core.configuration.ConfigurationServiceImpl@18b94e4&hellip;
2015-12-02 21:37:25,700 [Component Resolve Thread (Bundle 6)] INFO  o.e.k.c.c.ConfigurationServiceImpl - Registering io.rhiot.quickstarts.kura.camel.GatewayRouter with ocd: org.eclipse.kura.core.configuration.metatype.Tocd@1a80018 &hellip;
2015-12-02 21:37:25,701 [Component Resolve Thread (Bundle 6)] INFO  o.e.k.c.c.ConfigurationServiceImpl - Registration Completed for Component io.rhiot.quickstarts.kura.camel.GatewayRouter.
2015-12-02 21:37:26,625 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
2015-12-02 21:37:27,735 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
2015-12-02 21:37:28,735 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
2015-12-02 21:37:29,736 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
2015-12-02 21:37:30,736 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
2015-12-02 21:37:31,736 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
2015-12-02 21:37:32,736 [Camel (camel-2) thread #12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]</p>
<pre tabindex="0"><code>
### YouTube Demo

&lt;iframe width=&#34;650&#34; height=&#34;415&#34; src=&#34;https://www.youtube.com/embed/ZAUm_g4Xp5U&#34; frameborder=&#34;0&#34; &gt;&lt;/iframe&gt;

&lt;br/&gt;

## Conclusion

[Kura Platform](http://www.eclipse.org/kura/) is really interesting OSGi Platform. As we prove today, the setup is not too complex if you know what you do.  I love OSGi technology for its modularity, its flexibility and its robustness.
If we can plug Camel and Rhiot bundles, I think we can develop some cool new components, applications and products.
Let&#39;s develop and contribute more for [Kura](http://www.eclipse.org/kura/) , [Camel](http://camel.apache.org) and [Rhiot](http://rhiot.io) project too.
Stay tuned !!!

Please feel free to send me your feedback see [Apropos](/apropos/).


### Useful links

 * [KuraGateway configuration](http://127.0.0.1:8080/kura)
 * [rhiot projet](http://rhiot.io)
 * [camel-kura component](https://github.com/rhiot/rhiot/tree/master/gateway/components/camel-kura)
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://gautric.github.io/tags/en/">en</a></li>
      <li><a href="https://gautric.github.io/tags/rhiot/">rhiot</a></li>
      <li><a href="https://gautric.github.io/tags/raspberrypi/">RaspberryPi</a></li>
      <li><a href="https://gautric.github.io/tags/kura/">Kura</a></li>
      <li><a href="https://gautric.github.io/tags/gateway/">Gateway</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://gautric.github.io/blog/2015/12/23/kura-over-docker/">
    <span class="title">Â« Prev</span>
    <br>
    <span>Kura over Docker</span>
  </a>
  <a class="next" href="https://gautric.github.io/blog/2015/11/24/rhiot-raspberrypi-sense-hat-display/">
    <span class="title">Next Â»</span>
    <br>
    <span>RHIoT RaspberryPi Sense-Hat display</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2016 - 2024 <a href="https://gautric.github.io">Greg. I/O</a></span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
</body>

</html>
