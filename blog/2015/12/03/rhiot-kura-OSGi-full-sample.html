<!DOCTYPE html>
<html><!--<![-->
<head>

  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="For a while, I develop during my free time for Rhiot project with my Red Hat colleague Henryk. We started to develop several Camel components like (kura, pi4..."/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Icon bar -->
  <link rel="apple-touch-icon" sizes="57x57" href="/img/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/img/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/img/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/img/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/img/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/img/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/img/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/img/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
  <meta name="robots" content="index,follow,noarchive" />
  <meta name="googlebot" content="noarchive" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="Greg I/O" />
  <meta name="twitter:site:id" content="@gautric_io" />
  <meta name="twitter:creator" content="@gautric_io" />
  <meta name="twitter:title" content="Rhiot Kura Gateway Sample (Emulator & RaspberryPi) " />
  <meta name="twitter:description" content="For a while, I develop during my free time for Rhiot project with my Red Hat colleague Henryk. We started to develop several Camel components like (kura, pi4..." />
  <meta name="twitter:image" content="/img/apple-icon-152x152.png" />

  <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="/blog/2015/12/03/rhiot-kura-OSGi-full-sample.html">
  <link rel="alternate" type="application/rss+xml" title="Greg I/Open" href="/feed.xml" />
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <title>Rhiot Kura Gateway Sample (Emulator & RaspberryPi) </title>
</head>

  <body>
        <header class="site-header blog-header">

  <div class="wrapper">

    <a class="site-title blog-site-title" href="/">Greg I/Open</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        <a class="page-link" href="/apropos">A propos</a><a class="page-link" href="/blog">Blog</a><a class="page-link" href="/contact">Contact</a>
      </div>
    </nav>

  </div>

</header>


    <header class="post-header blog-title">
      <div class="wrapper">
      <h1 class="post-title">Rhiot Kura Gateway Sample (Emulator & RaspberryPi) </h1>
    </div>
    </header>

    <main class="page-content" role="main">
      <div class="wrapper">
          <article class="post-content">
    <p class="post-meta">Dec 3, 2015  <a href="#en">en</a>  <a href="#rhiot">rhiot</a>  <a href="#RaspberryPi">RaspberryPi</a>  <a href="#Kura">Kura</a>  <a href="#Gateway">Gateway</a> </p>
    <p>For a while, I develop during my free time for <a href="http://rhiot.io">Rhiot project</a> with my Red Hat colleague <a href="http://henryk-konsek.blogspot.fr/">Henryk</a>. We started to develop several <a href="http://camel.apache.org/components.html#Components-ExternalComponents">Camel components</a> like (kura, pi4j, bluetooth) with others volunteers.
Now we focus to develop and integrate those components for <a href="http://www.eclipse.org/kura/">Kura Platform</a>. Kura is an <a href="http://www.osgi.org">OSGi Platform</a> designed for IoT, it can run on RaspberryPi, BeagleBone or Intel Edison device.
Kura Platform has got lot of embedded services for IoT context (GPIO, USB, I2C, Cloud Service, etc…)
In this post we will see :</p>

<blockquote>
  <p>How to use Kura Rhiot Quickstart into emulator mode and real life mode.</p>
</blockquote>

<h2 id="requisites">Requisites</h2>

<ul>
  <li><a href="https://projects.eclipse.org/releases/mars">Eclipse Mars</a>
    <ul>
      <li>Linux or Mac only for emulation</li>
    </ul>
  </li>
  <li>One <a href="https://www.raspberrypi.org/products/raspberry-pi-2-model-b/">RaspberryPi</a>
    <ul>
      <li>tested w/ RPi B+</li>
    </ul>
  </li>
  <li>Two LEDs</li>
  <li>Two Resistors</li>
  <li>Wires</li>
</ul>

<h2 id="kura-setup">Kura Setup</h2>

<h3 id="emulator-setup">Emulator setup</h3>

<p>First of all, you have to setup your Eclipse workspace with <a href="https://eclipse.org/kura/downloads.php">Kura eclipse workspace available for download</a>.
<a href="http://eclipse.github.io/kura/doc/raspberry-pi-quick-start.html">Just follow instruct strictly</a>.</p>

<div class="warn">
To avoid any compilation problem please downgrade your JRE to a 1.7 version
</div>

<div class="info">
You can test and configure your workspace with Heater Demo Project
</div>

<h3 id="camel-and-rhiot-configuration-into-emulator">Camel and Rhiot configuration into Emulator</h3>

<h4 id="target-definition-configuration">Target Definition configuration</h4>

<p>Before setup Camel and Rhiot into Kura Emulator, you have to download several java libraries :</p>

<ul>
  <li>camel-core-2.16.0.jar
    <ul>
      <li>From <a href="http://camel.apache.org">ASF Camel</a></li>
    </ul>
  </li>
  <li>camel-core-osgi-2.16.0.jar
    <ul>
      <li>From <a href="http://camel.apache.org">ASF Camel</a></li>
    </ul>
  </li>
  <li>camel-kura-2.16.0.jar
    <ul>
      <li>From <a href="http://camel.apache.org">ASF Camel</a></li>
    </ul>
  </li>
  <li>camel-kura-0.1.3-SNAPSHOT.jar
    <ul>
      <li>From <a href="http://rhiot.io">Rhiot Project Camel</a></li>
    </ul>
  </li>
</ul>

<p>After create a new folder into <code class="language-plaintext highlighter-rouge">target-definition</code> project like <code class="language-plaintext highlighter-rouge">camel/2.16.0</code> and copy all previous downloaded libraries into it.</p>

<p><img src="/img/kura-camel-rhiot-1.png" style="max-width:33%;" /></p>

<p>Open Target Definition panel and <code class="language-plaintext highlighter-rouge">Add...</code> a new <code class="language-plaintext highlighter-rouge">Installation</code> mapped to the new <code class="language-plaintext highlighter-rouge">camel/2.16.0</code> folder.</p>

<p><img src="/img/kura-camel-rhiot-2.png" style="max-width:100%;" /></p>

<p>Verify that <code class="language-plaintext highlighter-rouge">Target Content</code> loads correctly Camel and Rhiot libraries, click into <code class="language-plaintext highlighter-rouge">Content</code> tab to check.</p>

<p><img src="/img/kura-camel-rhiot-3.png" style="max-width:100%;" /></p>

<p>Save configuration and click the <code class="language-plaintext highlighter-rouge">Set as Target Definition</code> action (top right).</p>

<h4 id="launch-configuration">Launch configuration</h4>

<p>We just finish to setup <code class="language-plaintext highlighter-rouge">Target Definition</code> stack, now we will see how to run it with the <code class="language-plaintext highlighter-rouge">Launch</code> command.</p>

<p><img src="/img/kura-camel-rhiot-4.png" style="max-width:33%;" />
<img src="/img/kura-camel-rhiot-5.png" style="max-width:33%;" /></p>

<p>Edit it and select correct libraries once again.</p>

<p><img src="/img/kura-camel-rhiot-6.png" style="max-width:100%;" /></p>

<p>In order to check Installation, just run the <code class="language-plaintext highlighter-rouge">Launch</code> command as usual and check bundles loading via OSGi <code class="language-plaintext highlighter-rouge">ss</code> command.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">osgi&gt; ss | <span class="nb">grep </span>camel
39	ACTIVE      org.apache.camel.camel-core_2.16.0
47	ACTIVE      org.apache.camel.camel-core-osgi_2.16.0
58	ACTIVE      org.apache.camel.camel-kura_2.16.0
61	ACTIVE      io.rhiot.camel-kura_0.1.3.SNAPSHOT
<span class="nb">true
</span>osgi&gt;</code></pre></figure>

<p><img src="/img/kura-camel-rhiot-7.png" style="max-width:100%;" /></p>

<p><em>Cool everything looks good to run our example !!!</em></p>

<h2 id="test-an-run-kura-rhiot-quickstart-into-emulator">Test an run Kura Rhiot quickstart into emulator.</h2>

<h3 id="import-quickstart-sample">Import Quickstart Sample</h3>

<p>Download our <a href="https://github.com/rhiot/quickstarts/tree/master/kura-camel">Kura Rhiot quickstart directly from github repository</a>.</p>

<p>Change <code class="language-plaintext highlighter-rouge">GatewayRouter</code> class with</p>

<script src="https://gist.github.com/gautric/e478b4b28b40c8270257.js"></script>

<p><code class="language-plaintext highlighter-rouge">GatewayRouter</code> contains our Camel route as usual. It is a OSGi Service. Change <code class="language-plaintext highlighter-rouge">GatewayRouter.xml</code> file with</p>

<script src="https://gist.github.com/gautric/2134986bb6114b035cd5.js"></script>

<p>This OSGi file is needed to start GatewayRouter service with <a href="https://osgi.org/xmlns/scr/v1.1.0/scr.xsd">Service Component Runtime</a> mechanism. Because we use SCR an not BundleActivation stuff.</p>

<p>, change <code class="language-plaintext highlighter-rouge">io.rhiot.quickstarts.kura.camel.GatewayRouter.xml</code> file with</p>

<script src="https://gist.github.com/gautric/052adb5b2acf1b96c3cc.js"></script>

<p>This last file provides configuration attributes used by <code class="language-plaintext highlighter-rouge">GatewayRouter</code> route, like <code class="language-plaintext highlighter-rouge">camel.kura.gpio.ouput.id</code>.</p>

<p>Compile via maven <code class="language-plaintext highlighter-rouge">mvn clean package -Dmaven.test.skip=true</code> to regenerate some MANIFEST and OSGi stuff via Bnd maven plugin.</p>

<p>You can also checkout remote branch <code class="language-plaintext highlighter-rouge">https://github.com/rhiot/quickstarts/tree/kura-gpio</code>.</p>

<h4 id="emulator-run">Emulator run</h4>

<p>Use <code class="language-plaintext highlighter-rouge">Kura_Emulator_OSX</code> Eclipse to run Equinox OSGi.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">a little log4j modification <span class="sb">`</span><span class="k">${</span><span class="nv">loc_workspace</span><span class="k">}</span>/org.eclipse.kura.emulator/src/main/resources/log4j.properties<span class="sb">`</span> file.

<span class="c">## eclipse</span>
log4j.logger.org.eclipse.kura.emulator.position<span class="o">=</span>INFO
log4j.logger.org.eclipse<span class="o">=</span>WARN
log4j.logger.io.rhiot<span class="o">=</span>DEBUG
log4j.logger.org.eclipse.kura.emulator.gpio<span class="o">=</span>DEBUG
log4j.logger.org.apache.camel<span class="o">=</span>INFO
log4j.logger.org.apache.camel.core.osgi<span class="o">=</span>INFO</code></pre></figure>

<p>Output should looks like</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding <span class="k">in</span> <span class="o">[</span>bundleresource://28.fwk1988196802:1/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding <span class="k">in</span> <span class="o">[</span>bundleresource://28.fwk1988196802:2/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings <span class="k">for </span>an explanation.
osgi&gt; Framework is running <span class="k">in </span>emulation mode
21:20:43,749 <span class="o">[</span>Start Level Event Dispatcher] INFO  Activator:96  - Camel activator starting
21:20:43,766 <span class="o">[</span>Start Level Event Dispatcher] INFO  Activator:102  - Camel activator started
21:20:44,114 <span class="o">[</span>Component Resolve Thread] DEBUG GpioServiceImpl:21  - activating emulated GPIOService
21:20:44,825 <span class="o">[</span>Component Resolve Thread] WARN  SystemServiceImpl:769  - Maximum <span class="nb">command </span>line upload size not available. Set default to 100 MB
21:20:44,825 <span class="o">[</span>Component Resolve Thread] WARN  SystemServiceImpl:778  - Missing the parameter that specifies the maximum number of files uploadable using the <span class="nb">command </span>servlet. Set default to 1024 files
21:20:44,926 <span class="o">[</span>Component Resolve Thread] DEBUG GatewayRouter:46  - Initializing bundle 40.
21:20:45,119 <span class="o">[</span>Component Resolve Thread] INFO  CamelContextHelper:583  - No existing PropertiesComponent has been configured, creating a new default PropertiesComponent with name: properties
21:20:45,128 <span class="o">[</span>Component Resolve Thread] INFO  OsgiDefaultCamelContext:2750  - Apache Camel 2.16.0 <span class="o">(</span>CamelContext: camel-1<span class="o">)</span> is starting
21:20:45,129 <span class="o">[</span>Component Resolve Thread] INFO  ManagedManagementStrategy:191  - JMX is enabled
21:20:45,439 <span class="o">[</span>Component Resolve Thread] INFO  DefaultRuntimeEndpointRegistry:203  - Runtime endpoint registry is <span class="k">in </span>extended mode gathering usage statistics of all incoming and outgoing endpoints <span class="o">(</span>cache limit: 1000<span class="o">)</span>
21:20:45,565 <span class="o">[</span>Component Resolve Thread] INFO  KuraServiceFactory:45  - Found Kura org.eclipse.kura.gpio.GPIOService <span class="k">in </span>the registry. Kura component will use that instance.
21:20:45,576 <span class="o">[</span>Component Resolve Thread] INFO  OsgiDefaultCamelContext:2983  - AllowUseOriginalMessage is enabled. If access to the original message is not needed, <span class="k">then </span>its recommended to turn this option off as it may improve performance.
21:20:45,576 <span class="o">[</span>Component Resolve Thread] INFO  OsgiDefaultCamelContext:2993  - StreamCaching is not <span class="k">in </span>use. If using streams <span class="k">then </span>its recommended to <span class="nb">enable </span>stream caching. See more details at http://camel.apache.org/stream-caching.html
21:20:45,608 <span class="o">[</span>Component Resolve Thread] DEBUG KuraGPIOProducer:73  - Starting producer: Producer[kura-gpio://6?action<span class="o">=</span>BLINK]
21:20:45,608 <span class="o">[</span>Component Resolve Thread] INFO  EmulatedPin:76  - Emulated GPIO Pin 6 open.
21:20:45,684 <span class="o">[</span>Component Resolve Thread] INFO  OsgiDefaultCamelContext:3514  - Route: route1 started and consuming from: Endpoint[timer://io.rhiot.kura.timer?period<span class="o">=</span>5000]
21:20:45,686 <span class="o">[</span>Component Resolve Thread] INFO  OsgiDefaultCamelContext:2785  - Total 1 routes, of which 1 is started.
21:20:45,687 <span class="o">[</span>Component Resolve Thread] INFO  OsgiDefaultCamelContext:2786  - Apache Camel 2.16.0 <span class="o">(</span>CamelContext: camel-1<span class="o">)</span> started <span class="k">in </span>0.558 seconds
21:20:45,690 <span class="o">[</span>Component Resolve Thread] DEBUG GatewayRouter:52  - Bundle 40 started.
21:20:45,690 <span class="o">[</span>Component Resolve Thread] DEBUG GatewayRouter:48  - Refreshing SCR properties: org.eclipse.equinox.internal.ds.impl.ReadOnlyDictionary@283dd358
<span class="s1">'21:20:46,698 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:20:46,701 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to on
21:20:46,752 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to off
21:20:51,691 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:20:51,692 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to on
21:20:51,745 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to off
21:20:56,692 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:20:56,692 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to on
21:20:56,747 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to off
21:21:01,697 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:01,698 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to on
21:21:01,752 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to off
21:21:06,703 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:06,704 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to on
21:21:06,758 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to off
21:21:11,708 [Camel (camel-1) thread #0 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:11,709 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to on
21:21:11,763 [Camel (camel-1) thread #1 - kura-gpio-camel] DEBUG EmulatedPin:58  - Emulated GPIO Pin 6 changed to off'</span>
21:21:13,798 <span class="o">[</span>qtp1872598749-36] INFO  /:1947  - org.eclipse.kura.web.server.GwtSecurityTokenServiceImpl: Trying www resource2: /www/denali/CF261C606092B547DDA8A7EE4A5B1ADC.gwt.rpc
21:21:13,821 <span class="o">[</span>qtp1872598749-34] INFO  /:1947  - org.eclipse.kura.web.server.GwtComponentServiceImpl: Trying www resource2: /www/denali/48673E1A90F237B138F81C0DF07ED6D7.gwt.rpc
21:21:13,914 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  DefaultShutdownStrategy:190  - Starting to graceful shutdown 1 routes <span class="o">(</span><span class="nb">timeout </span>10 seconds<span class="o">)</span>
<span class="s1">'21:21:13,920 [Camel (camel-1) thread #2 - ShutdownTask] INFO  DefaultShutdownStrategy:663  - Route: route1 shutdown complete, was consuming from: Endpoint[timer://io.rhiot.kura.timer?period=5000]'</span>
21:21:13,921 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  DefaultShutdownStrategy:254  - Graceful shutdown of 1 routes completed <span class="k">in </span>0 seconds
21:21:13,930 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> DEBUG KuraGPIOProducer:82  - Stopping producer: Producer[kura-gpio://6?action<span class="o">=</span>BLINK]
21:21:13,931 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  EmulatedPin:81  - Emulated GPIO Pin 6 closed.
21:21:13,933 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  OsgiDefaultCamelContext:3311  - Route: route1 is stopped, was consuming from: Endpoint[timer://io.rhiot.kura.timer?period<span class="o">=</span>5000]
21:21:13,947 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  OsgiDefaultCamelContext:3311  - Route: route1 is shutdown and removed, was consuming from: Endpoint[timer://io.rhiot.kura.timer?period<span class="o">=</span>5000]
21:21:13,949 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  OsgiDefaultCamelContext:3010  - Apache Camel 2.16.0 <span class="o">(</span>CamelContext: camel-1<span class="o">)</span> is shutting down
21:21:13,957 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  OsgiDefaultCamelContext:3095  - Apache Camel 2.16.0 <span class="o">(</span>CamelContext: camel-1<span class="o">)</span> <span class="nb">uptime </span>28.829 seconds
21:21:13,957 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  OsgiDefaultCamelContext:3096  - Apache Camel 2.16.0 <span class="o">(</span>CamelContext: camel-1<span class="o">)</span> is shutdown <span class="k">in </span>0.009 seconds
21:21:13,961 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> DEBUG GatewayRouter:48  - Refreshing SCR properties: org.eclipse.equinox.internal.ds.impl.ReadOnlyDictionary@283dd358
21:21:13,961 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  OsgiDefaultCamelContext:2750  - Apache Camel 2.16.0 <span class="o">(</span>CamelContext: camel-1<span class="o">)</span> is starting
21:21:13,961 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  ManagedManagementStrategy:191  - JMX is enabled
21:21:13,961 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  DefaultRuntimeEndpointRegistry:203  - Runtime endpoint registry is <span class="k">in </span>extended mode gathering usage statistics of all incoming and outgoing endpoints <span class="o">(</span>cache limit: 1000<span class="o">)</span>
21:21:14,167 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  KuraServiceFactory:45  - Found Kura org.eclipse.kura.gpio.GPIOService <span class="k">in </span>the registry. Kura component will use that instance.
21:21:14,171 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  OsgiDefaultCamelContext:2983  - AllowUseOriginalMessage is enabled. If access to the original message is not needed, <span class="k">then </span>its recommended to turn this option off as it may improve performance.
21:21:14,171 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  OsgiDefaultCamelContext:2993  - StreamCaching is not <span class="k">in </span>use. If using streams <span class="k">then </span>its recommended to <span class="nb">enable </span>stream caching. See more details at http://camel.apache.org/stream-caching.html
21:21:14,183 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> DEBUG KuraGPIOProducer:73  - Starting producer: Producer[kura-gpio://3?action<span class="o">=</span>TOGGLE]
21:21:14,183 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  EmulatedPin:76  - Emulated GPIO Pin 3 open.
21:21:14,224 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  OsgiDefaultCamelContext:3514  - Route: route1 started and consuming from: Endpoint[timer://io.rhiot.kura.timer?period<span class="o">=</span>10000]
21:21:14,224 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  OsgiDefaultCamelContext:2785  - Total 1 routes, of which 1 is started.
21:21:14,225 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 58<span class="o">)]</span> INFO  OsgiDefaultCamelContext:2786  - Apache Camel 2.16.0 <span class="o">(</span>CamelContext: camel-1<span class="o">)</span> started <span class="k">in </span>0.263 seconds
<span class="s1">'21:21:15,228 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:15,228 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58  - Emulated GPIO Pin 3 changed to on
21:21:25,233 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:25,234 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58  - Emulated GPIO Pin 3 changed to off
21:21:35,238 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:35,239 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58  - Emulated GPIO Pin 3 changed to on
21:21:45,239 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:45,239 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58  - Emulated GPIO Pin 3 changed to off
21:21:55,244 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] INFO  heartbeat:96  - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]
21:21:55,244 [Camel (camel-1) thread #3 - timer://io.rhiot.kura.timer] DEBUG EmulatedPin:58  - Emulated GPIO Pin 3 changed to on'</span></code></pre></figure>

<p>You can change some parameter via the Kura WebUI</p>

<p><img src="/img/kura-camel-rhiot-7bis.png" style="max-width:100%;" /></p>

<h2 id="execution-irl">Execution IRL</h2>

<p>Let’s run it IRL</p>

<h3 id="wire-led-raspberrypi">Wire, LED, RaspberryPi</h3>

<p>Follow schema below</p>

<p><img src="/img/kura-camel-rhiot-8.png" style="max-width:80%;" /></p>

<h3 id="bundles-installation-into-raspberrypi">Bundles installation into RaspberryPi</h3>

<p>Compile Kura-Rhiot Sample via common <code class="language-plaintext highlighter-rouge">mvn clean package</code></p>

<p>After you have installed <a href="https://s3.amazonaws.com/kura_downloads/raspbian/release/1.3.0/kura_1.3.0_raspberry-pi-bplus-nn_installer.deb">Kura deb</a> into RaspberryPi you can start and install bundles.</p>

<p>To start kura service:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">rpbi&gt; <span class="nb">sudo </span>service kura start  </code></pre></figure>

<p>you can use <code class="language-plaintext highlighter-rouge">tail -f /var/log/kura.log</code> to check Kura Platform running.</p>

<p>Copy to RaspberryPi and Install all bundles via command line. Connect to Kura OSGi via telnet protocol:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">rpbi&gt; telnet 127.0.0.1 5002
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is <span class="s1">'^]'</span><span class="nb">.</span>

osgi&gt;
osgi&gt; <span class="nb">install </span>file:///home/pi/kura/camel-core-2.16.0.jar
osgi&gt; <span class="nb">install </span>file:///home/pi/kura/camel-core-osgi-2.16.0.jar
osgi&gt; <span class="nb">install </span>file:///home/pi/kura/camel-kura-2.16.0.jar              
osgi&gt; <span class="nb">install </span>file:///home/pi/kura/camel-kura-0.1.3-SNAPSHOT.jar      
osgi&gt; <span class="nb">install </span>file:///home/pi/kura/rhiot-kura-camel-1.0.0-SNAPSHOT.jar</code></pre></figure>

<p>And start all INSTALLED bundle</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">start 69 70 71 72 73  // <span class="k">for </span>example</code></pre></figure>

<p>Output should look like this</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">2015-12-02 21:37:24,414 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> DEBUG i.r.q.k.c.GatewayRouter - Initializing bundle 75.
2015-12-02 21:37:24,424 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.a.c.u.CamelContextHelper - No existing PropertiesComponent has been configured, creating a new default PropertiesComponent with name: properties
2015-12-02 21:37:24,432 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.a.c.c.o.OsgiDefaultCamelContext - Apache Camel 2.16.0 <span class="o">(</span>CamelContext: camel-2<span class="o">)</span> is starting
2015-12-02 21:37:24,433 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.a.c.m.ManagedManagementStrategy - JMX is enabled
2015-12-02 21:37:24,934 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.a.c.i.DefaultRuntimeEndpointRegistry - Runtime endpoint registry is <span class="k">in </span>extended mode gathering usage statistics of all incoming and outgoing endpoints <span class="o">(</span>cache limit: 1000<span class="o">)</span>
2015-12-02 21:37:25,242 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  i.r.c.k.u.KuraServiceFactory - Found Kura org.eclipse.kura.gpio.GPIOService <span class="k">in </span>the registry. Kura component will use that instance.
2015-12-02 21:37:25,260 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.a.c.c.o.OsgiDefaultCamelContext - AllowUseOriginalMessage is enabled. If access to the original message is not needed, <span class="k">then </span>its recommended to turn this option off as it may improve performance.
2015-12-02 21:37:25,263 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.a.c.c.o.OsgiDefaultCamelContext - StreamCaching is not <span class="k">in </span>use. If using streams <span class="k">then </span>its recommended to <span class="nb">enable </span>stream caching. See more details at http://camel.apache.org/stream-caching.html
2015-12-02 21:37:25,330 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> DEBUG i.r.c.k.g.KuraGPIOProducer - Starting producer: Producer[kura-gpio://3?action<span class="o">=</span>BLINK]
2015-12-02 21:37:25,619 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.a.c.c.o.OsgiDefaultCamelContext - Route: route2 started and consuming from: Endpoint[timer://io.rhiot.kura.timer?period<span class="o">=</span>1000]
2015-12-02 21:37:25,622 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.a.c.c.o.OsgiDefaultCamelContext - Total 1 routes, of which 1 is started.
2015-12-02 21:37:25,624 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.a.c.c.o.OsgiDefaultCamelContext - Apache Camel 2.16.0 <span class="o">(</span>CamelContext: camel-2<span class="o">)</span> started <span class="k">in </span>1.191 seconds
2015-12-02 21:37:25,639 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> DEBUG i.r.q.k.c.GatewayRouter - Bundle 75 started.
2015-12-02 21:37:25,640 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> DEBUG i.r.q.k.c.GatewayRouter - Refreshing SCR properties: org.eclipse.equinox.internal.ds.impl.ReadOnlyDictionary@18158f3
2015-12-02 21:37:25,649 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.e.k.c.c.ConfigurableComponentTracker - Adding ConfigurableComponent io.rhiot.quickstarts.kura.camel.GatewayRouter
2015-12-02 21:37:25,657 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.e.k.c.c.ConfigurationServiceImpl - Registration of ConfigurableComponent io.rhiot.quickstarts.kura.camel.GatewayRouter by org.eclipse.kura.core.configuration.ConfigurationServiceImpl@18b94e4...
2015-12-02 21:37:25,700 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.e.k.c.c.ConfigurationServiceImpl - Registering io.rhiot.quickstarts.kura.camel.GatewayRouter with ocd: org.eclipse.kura.core.configuration.metatype.Tocd@1a80018 ...
2015-12-02 21:37:25,701 <span class="o">[</span>Component Resolve Thread <span class="o">(</span>Bundle 6<span class="o">)]</span> INFO  o.e.k.c.c.ConfigurationServiceImpl - Registration Completed <span class="k">for </span>Component io.rhiot.quickstarts.kura.camel.GatewayRouter.
2015-12-02 21:37:26,625 <span class="o">[</span>Camel <span class="o">(</span>camel-2<span class="o">)</span> thread <span class="c">#12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]</span>
2015-12-02 21:37:27,735 <span class="o">[</span>Camel <span class="o">(</span>camel-2<span class="o">)</span> thread <span class="c">#12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]</span>
2015-12-02 21:37:28,735 <span class="o">[</span>Camel <span class="o">(</span>camel-2<span class="o">)</span> thread <span class="c">#12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]</span>
2015-12-02 21:37:29,736 <span class="o">[</span>Camel <span class="o">(</span>camel-2<span class="o">)</span> thread <span class="c">#12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]</span>
2015-12-02 21:37:30,736 <span class="o">[</span>Camel <span class="o">(</span>camel-2<span class="o">)</span> thread <span class="c">#12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]</span>
2015-12-02 21:37:31,736 <span class="o">[</span>Camel <span class="o">(</span>camel-2<span class="o">)</span> thread <span class="c">#12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]</span>
2015-12-02 21:37:32,736 <span class="o">[</span>Camel <span class="o">(</span>camel-2<span class="o">)</span> thread <span class="c">#12 - timer://io.rhiot.kura.timer] INFO  i.r.k.heartbeat - Exchange[ExchangePattern: InOnly, BodyType: null, Body: [Body is null]]</span></code></pre></figure>

<h3 id="youtube-demo">YouTube Demo</h3>

<iframe width="650" height="415" src="https://www.youtube.com/embed/ZAUm_g4Xp5U" frameborder="0"></iframe>

<p><br /></p>

<h2 id="conclusion">Conclusion</h2>

<p><a href="http://www.eclipse.org/kura/">Kura Platform</a> is really interesting OSGi Platform. As we prove today, the setup is not too complex if you know what you do.  I love OSGi technology for its modularity, its flexibility and its robustness.
If we can plug Camel and Rhiot bundles, I think we can develop some cool new components, applications and products.
Let’s develop and contribute more for <a href="http://www.eclipse.org/kura/">Kura</a> , <a href="http://camel.apache.org">Camel</a> and <a href="http://rhiot.io">Rhiot</a> project too.
Stay tuned !!!</p>

<p>Please feel free to send me your feedback see <a href="/apropos/">Apropos</a>.</p>

<h3 id="useful-links">Useful links</h3>

<ul>
  <li><a href="http://127.0.0.1:8080/kura">KuraGateway configuration</a></li>
  <li><a href="http://rhiot.io">rhiot projet</a></li>
  <li><a href="https://github.com/rhiot/rhiot/tree/master/gateway/components/camel-kura">camel-kura component</a></li>
</ul>

  </article>

  <div class="post-social">
    
   <a href="https://twitter.com/share" class="twitter-share-button" data-via="gautric_io">Tweet</a>
   <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'greg-iopen';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


</div>


      </div>
    </main>

    <footer class="site-footer blog-footer">

  <div class="wrapper">

    <h2 class="footer-heading"><a href="#" title="Haut de la page / Head of page">Greg I/Open</a></h2>

    <div class="footer-col-wrapper">
      <p class="text">Cloud Architecte, Greg Autric, Web, Cloud, IoT, Automation, Red Hat, OpenSource</p>

      &mdash; 
 <a href="https://twitter.com/gautric_io">
    <span class="icon  icon--twitter">
      <svg viewBox="0 0 16 16">
        <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
        c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
      </svg>
    </span>
  </a>

 &mdash; 
  <a href="https://github.com/gautric">
    <span class="icon  icon--github">
      <svg viewBox="0 0 16 16">
        <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
      </svg>
    </span>
  </a>

 &mdash;
    </div>


  </div>

  <div class="copyright">Copyright © Greg Autric 2015 - 2024</div>


</footer>


  </body>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60791597-1', 'auto');
    ga('send', 'pageview');

  </script>

</html>
