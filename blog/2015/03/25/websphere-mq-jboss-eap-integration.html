<!DOCTYPE html>
<html><!--<![-->
<head>

  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Le serveur d’application JBoss EAP est certifié JAVA EE 6, il implémente donc via le framework IronJacamar le standard JAVA EE Connector Architecture (JCA). ..."/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Icon bar -->
  <link rel="apple-touch-icon" sizes="57x57" href="/img/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/img/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/img/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/img/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/img/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/img/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/img/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/img/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
  <meta name="robots" content="index,follow,noarchive" />
  <meta name="googlebot" content="noarchive" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="Greg I/O" />
  <meta name="twitter:site:id" content="@gautric_io" />
  <meta name="twitter:creator" content="@gautric_io" />
  <meta name="twitter:title" content="Best Practices Websphere MQ/JBoss EAP 6" />
  <meta name="twitter:description" content="Le serveur d’application JBoss EAP est certifié JAVA EE 6, il implémente donc via le framework IronJacamar le standard JAVA EE Connector Architecture (JCA). ..." />
  <meta name="twitter:image" content="/img/apple-icon-152x152.png" />

  <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="/blog/2015/03/25/websphere-mq-jboss-eap-integration.html">
  <link rel="alternate" type="application/rss+xml" title="Greg I/Open" href="/feed.xml" />
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <title>Best Practices Websphere MQ/JBoss EAP 6</title>
</head>

  <body>
        <header class="site-header blog-header">

  <div class="wrapper">

    <a class="site-title blog-site-title" href="/">Greg I/Open</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        <a class="page-link" href="/apropos">A propos</a><a class="page-link" href="/blog">Blog</a><a class="page-link" href="/contact">Contact</a>
      </div>
    </nav>

  </div>

</header>


    <header class="post-header blog-title">
      <div class="wrapper">
      <h1 class="post-title">Best Practices Websphere MQ/JBoss EAP 6</h1>
    </div>
    </header>

    <main class="page-content" role="main">
      <div class="wrapper">
          <article class="post-content">
    <p class="post-meta">Mar 25, 2015  <a href="#fr">fr</a>  <a href="#jboss">jboss</a>  <a href="#eap">eap</a>  <a href="#wildfly">wildfly</a>  <a href="#websphereMQ">websphereMQ</a>  <a href="#JCA">JCA</a> </p>
    <p>Le serveur d’application <a href="http://www.jboss.org/products/eap/overview/">JBoss EAP</a> est <a href="http://www.oracle.com/technetwork/java/javaee/overview/compatibility-jsp-136984.html">certifié JAVA EE 6</a>, il implémente donc via le framework <a href="http://www.ironjacamar.org/">IronJacamar</a> le standard JAVA EE Connector Architecture (JCA). Ce standard permet de connecter les applications Java EE à des ressources externes comme par exemple un broker JMS, un système de fichier ou un mainframe. Il est possible de faire l’analogie du standard JCA avec le standard JDBC, JDBC se limitant uniquement aux bases de données de type relationnel, JCA se veut beaucoup plus large, il permet d’intégrer tout type de systèmes d’informations d’entreprise (EIS)</p>

<p>Le standard JCA va prendre en charge l’ensemble des fonctionnalités suivantes (liste non-exhaustive) :</p>

<ul>
  <li>Connexion au système (socket, IPC, …)</li>
  <li>Gestion des transactions (locales, XA)</li>
  <li>Sécurisation de l’accès à la ressource distante</li>
  <li>Management du cycle de vie et du threading</li>
</ul>

<p>Le fournisseur de service va fournir aux développeurs et à l’intégrateur un driver appelé dans le contexte JCA : <a href="http://docs.oracle.com/javaee/6/tutorial/doc/gipgl.html">Resource Adapter</a></p>

<p>Nous allons voir dans notre exemple :</p>

<blockquote>
  <p>Best Pratice d’integration JMS entre Websphere MQ (WMQ) et JBoss EAP 6</p>
</blockquote>

<h2 id="matériels">Matériels</h2>

<p>Pour ce lab, nous allons avoir besoin de deux logiciels :</p>

<ul>
  <li>Un serveur JBoss EAP <a href="http://www.jboss.org/products/eap/download/">http://www.jboss.org/products/eap/download/</a></li>
  <li>Un serveur WebSphereMQ <a href="http://www.ibm.com/developerworks/downloads/ws/wmq/">http://www.ibm.com/developerworks/downloads/ws/wmq/</a>
    <ul>
      <li>Le ressource adapteur disponible dans le répertoire <strong>/opt/mqm/java/lib/jca</strong></li>
    </ul>
  </li>
</ul>

<div class="warn">
Attention, il s'agit de version d'essai ou d'évaluation uniquement, le déploiement en production nécessite l'achat de souscription pour JBoss et de license pour IBM
</div>

<h2 id="développement">Développement</h2>

<p>Afin de pouvoir tester notre intégration nous allons avoir besoin de développer un client pour l’envoi et un MDB pour la réception d’un message JMS.</p>

<h3 id="pour-lenvoi">Pour l’envoi</h3>

<p>Dans notre cas nous allons créer un EJB Stateless pour envoyer le message JMS. Mais il est possible d’utiliser un autre mécanisme pour l’envoi, une servlet par exemple.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// ..OMIT .. //</span>

<span class="nd">@Stateless</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MoMSenderBean</span> <span class="o">{</span>

  <span class="c1">// ..OMIT .. //</span>

	<span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"jms/connectionFactory"</span><span class="o">)</span>
	<span class="nc">ConnectionFactory</span> <span class="n">factory</span><span class="o">;</span>

	<span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"jms/queue/Queue"</span><span class="o">)</span>
	<span class="nc">Queue</span> <span class="n">queue</span><span class="o">;</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMessage</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">JMSException</span> <span class="o">{</span>

            <span class="nc">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">createConnection</span><span class="o">();</span>
            <span class="no">LOGGER</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">"Recuperation d'une connexion {}"</span><span class="o">,</span> <span class="n">connection</span><span class="o">);</span>

            <span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">createSession</span><span class="o">(</span><span class="kc">false</span><span class="o">,</span> <span class="no">AUTO_ACKNOWLEDGE</span><span class="o">);</span>
            <span class="nc">MessageProducer</span> <span class="n">producer</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createProducer</span><span class="o">(</span><span class="n">queue</span><span class="o">);</span>
            <span class="no">LOGGER</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">"Creation du sender {} sur la queue {}"</span><span class="o">,</span> <span class="n">producer</span><span class="o">,</span> <span class="n">queue</span><span class="o">);</span>

            <span class="nc">TextMessage</span> <span class="n">textMessage</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createTextMessage</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
            <span class="n">textMessage</span><span class="o">.</span><span class="na">setJMSCorrelationID</span><span class="o">(</span><span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">textMessage</span><span class="o">);</span>
            <span class="n">producer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<div class="warn">
On notera dans ce code que les ressources JMS (Factory et Queue) sont récupérées du scope courant du module.
</div>

<p>Plus d’information sur <a href="https://docs.jboss.org/author/display/AS72/JNDI+Reference">JNDI avec JBoss</a></p>

<h3 id="pour-la-réception">Pour la réception</h3>

<p>Dans le monde Java EE, la réception de message JMS se fait par l’intermediaire d’un bean particulier.
Ce bean est un Message Driven Bean (MDB), c’est à dire que l’objet est appelé quand un message est reçu dans la file JMS.
La classe doit héritée de l’interface <strong>javax.jms.MessageListener</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// ..OMIT .. //</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MoMMDB</span> <span class="kd">implements</span> <span class="nc">MessageListener</span> <span class="o">{</span>

  <span class="c1">// ..OMIT .. //</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="o">(</span><span class="nc">Message</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
		<span class="no">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Received Message from queue: {}"</span> <span class="o">+</span> <span class="o">(</span><span class="nc">TextMessage</span><span class="o">)</span> <span class="n">message</span><span class="o">);</span>

	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<div class="warn">
Il est bien sûr possible décorer le MDB avec les annotations ActivationSpec, mais ces annotations noie dans le code des problematiques contextuelles à l'application (environnement extérieur à l'application). Avec d'autre resource adapter cela peut s'avérer plus simple.
</div>

<h2 id="configuration-application">Configuration Application</h2>

<p>Nous allons maintenant configurer l’application afin de nous connecter à la bonne file JMS.
Dans un premier temps nous allons utiliser le fichier <em>ejb-jar.xml</em> afin de definir les principaux objets.</p>

<h3 id="définition-java-ee-ejb-jarxml">Définition Java EE (ejb-jar.xml)</h3>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;ejb-jar</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span> <span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_0.xsd"</span> <span class="na">version=</span><span class="s">"3.0"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;description&gt;</span>MoM Application EJB / MDB <span class="nt">&lt;/description&gt;</span>
  <span class="nt">&lt;display-name&gt;</span>MoM Application EJB / MDB<span class="nt">&lt;/display-name&gt;</span>
  <span class="nt">&lt;enterprise-beans&gt;</span>
    <span class="nt">&lt;message-driven&gt;</span>
      <span class="nt">&lt;description&gt;</span>MoM MDB<span class="nt">&lt;/description&gt;</span>
      <span class="nt">&lt;ejb-name&gt;</span>MessageDrivenBean<span class="nt">&lt;/ejb-name&gt;</span>
      <span class="nt">&lt;ejb-class&gt;</span>net.a.g.jee.mom.mdb.MoMMDB<span class="nt">&lt;/ejb-class&gt;</span>
      <span class="nt">&lt;transaction-type&gt;</span>Container<span class="nt">&lt;/transaction-type&gt;</span>
      <span class="nt">&lt;message-destination-type&gt;</span>javax.jms.Queue<span class="nt">&lt;/message-destination-type&gt;</span>
    <span class="nt">&lt;/message-driven&gt;</span>
    <span class="nt">&lt;session&gt;</span>
      <span class="nt">&lt;ejb-name&gt;</span>MoMSenderBean<span class="nt">&lt;/ejb-name&gt;</span>
      <span class="nt">&lt;ejb-class&gt;</span>net.a.g.jee.mom.ejb.MoMSenderBean<span class="nt">&lt;/ejb-class&gt;</span>
    <span class="nt">&lt;/session&gt;</span>
  <span class="nt">&lt;/enterprise-beans&gt;</span>
<span class="nt">&lt;/ejb-jar&gt;</span></code></pre></figure>

<h3 id="configuration-des-implementations-spécifiques-jboss-ejb3xml">Configuration des implementations spécifiques (jboss-ejb3.xml)</h3>

<p>Comme nous souhaitons pouvoir nous connecter à un serveur WebsphereMQ nous allons devoir configurer le MDB afin qu’il réceptionne les messages. On effectura aussi le mapping des ressources d’environnement du serveur d’application avec les resources de l’application.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;jboss:ejb-jar</span> <span class="na">xmlns:jboss=</span><span class="s">"http://www.jboss.com/xml/ns/javaee"</span>
  <span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span> <span class="na">xmlns:jee=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span>
  <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:mdb=</span><span class="s">"urn:resource-adapter-binding"</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"</span>
  <span class="na">version=</span><span class="s">"3.1"</span> <span class="na">impl-version=</span><span class="s">"2.0"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;jee:enterprise-beans&gt;</span>
    <span class="nt">&lt;jee:message-driven&gt;</span>
      <span class="nt">&lt;jee:ejb-name&gt;</span>MessageDrivenBean<span class="nt">&lt;/jee:ejb-name&gt;</span>
      <span class="nt">&lt;jee:ejb-class&gt;</span>net.a.g.jee.mom.mdb.MoMMDB<span class="nt">&lt;/jee:ejb-class&gt;</span>
      <span class="nt">&lt;jee:transaction-type&gt;</span>Container<span class="nt">&lt;/jee:transaction-type&gt;</span>
      <span class="nt">&lt;jee:message-destination-type&gt;</span>javax.jms.Queue<span class="nt">&lt;/jee:message-destination-type&gt;</span>
      <span class="nt">&lt;jee:activation-config&gt;</span>
        <span class="nt">&lt;jee:activation-config-property&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>channel<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.channel}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
        <span class="nt">&lt;jee:activation-config-property&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>queueManager<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.queueManager}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
        <span class="nt">&lt;jee:activation-config-property&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>transportType<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.transportType}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
        <span class="nt">&lt;jee:activation-config-property&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>hostName<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.hostName}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
        <span class="nt">&lt;jee:activation-config-property&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>port<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.port}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
        <span class="nt">&lt;jee:activation-config-property&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>username<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.username}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
        <span class="nt">&lt;jee:activation-config-property&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>password<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.password}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
        <span class="nt">&lt;jee:activation-config-property&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>destination<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>java:/jboss/jms/wmq/queue/Queue<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
        <span class="nt">&lt;jee:activation-config-property&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>useJNDI<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>true<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
        <span class="nt">&lt;jee:activation-config-property&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>destinationType<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>javax.jms.Queue<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
      <span class="nt">&lt;/jee:activation-config&gt;</span>
    <span class="nt">&lt;/jee:message-driven&gt;</span>
    <span class="nt">&lt;jee:session&gt;</span>
      <span class="nt">&lt;jee:ejb-name&gt;</span>MoMSenderBean<span class="nt">&lt;/jee:ejb-name&gt;</span>
      <span class="nt">&lt;jee:ejb-class&gt;</span>net.a.g.jee.mom.ejb.MoMSenderBean<span class="nt">&lt;/jee:ejb-class&gt;</span>
      <span class="nt">&lt;jee:resource-ref&gt;</span>
        <span class="nt">&lt;jee:res-ref-name&gt;</span>jms/connectionFactory<span class="nt">&lt;/jee:res-ref-name&gt;</span>
        <span class="nt">&lt;jee:res-type&gt;</span>javax.jms.ConnectionFactory<span class="nt">&lt;/jee:res-type&gt;</span>
        <span class="nt">&lt;jee:lookup-name&gt;</span>java:/jboss/jms/wmq/connectionFactory<span class="nt">&lt;/jee:lookup-name&gt;</span>
      <span class="nt">&lt;/jee:resource-ref&gt;</span>
      <span class="nt">&lt;jee:resource-env-ref&gt;</span>
        <span class="nt">&lt;jee:resource-env-ref-name&gt;</span>jms/queue/Queue<span class="nt">&lt;/jee:resource-env-ref-name&gt;</span>
        <span class="nt">&lt;jee:lookup-name&gt;</span>java:/jboss/jms/wmq/queue/Queue<span class="nt">&lt;/jee:lookup-name&gt;</span>
      <span class="nt">&lt;/jee:resource-env-ref&gt;</span>
    <span class="nt">&lt;/jee:session&gt;</span>
  <span class="nt">&lt;/jee:enterprise-beans&gt;</span>
  <span class="nt">&lt;jee:assembly-descriptor&gt;</span>
    <span class="nt">&lt;mdb:resource-adapter-binding&gt;</span>
      <span class="nt">&lt;jee:ejb-name&gt;</span>MessageDrivenBean<span class="nt">&lt;/jee:ejb-name&gt;</span>
      <span class="nt">&lt;mdb:resource-adapter-name&gt;</span>${websphere.resource.adapter}<span class="nt">&lt;/mdb:resource-adapter-name&gt;</span>
    <span class="nt">&lt;/mdb:resource-adapter-binding&gt;</span>
  <span class="nt">&lt;/jee:assembly-descriptor&gt;</span>
<span class="nt">&lt;/jboss:ejb-jar&gt;</span></code></pre></figure>

<p>Plusieurs points importants dans cette configuration sont à noter :</p>

<ul>
  <li>L’utilisation de placeholder dans l’ensemble des configurations techniques afin de centraliser l’information dans le standalone.xml
    <ul>
      <li><strong>hostName</strong>     -&gt; <strong>${websphere.hostName}</strong></li>
      <li><strong>port</strong>         -&gt; <strong>${websphere.port}</strong></li>
      <li><strong>queueManager</strong> -&gt; <strong>${websphere.queueManager}</strong></li>
    </ul>
  </li>
  <li>La propriété <strong>useJNDI</strong> est activée afin de récuperer la queue par son nom JNDI</li>
  <li>Le mapping des noms JNDI du serveur JBoss avec les noms JNDI du module applicatif
    <ul>
      <li>Nom de la queue configurée dans le serveur : <strong>java:/jboss/jms/wmq/queue/Queue</strong></li>
      <li>Nom de la queue utilisée par le module applicatif : <strong>jms/queue/Queue</strong></li>
    </ul>
  </li>
  <li>Le binding du ressource adapteur (driver JCA) de websphere MQ au bean MDB de réception.
    <ul>
      <li>Balise <strong>&lt;mdb:resource-adapter-binding&gt;</strong></li>
    </ul>
  </li>
</ul>

<div class="warn">
Il est preferable d'utiliser les fichiers XML dans un contexte d'entreprise, en effet le changement d'environement et les fréquentes  modifications nécessite souvent des mises à jour d'informations. Le code Java doit dépendre le moins possible de l'environnement et de l'implémentation des systèmes externes.
</div>

<div class="info">
Si l'application doit se connecter à un autre système JMS, je preconise de recréer un autre fichier jboss-ejb3.xml, le mapping sera de nouveau à  effectuer dans ce fichier.
</div>

<h2 id="configuration-jboss">Configuration JBoss</h2>

<p>Dans ce chapitre nous allons voir comment configurer le fichier <strong>standalone.xml</strong> de l’instance JBoss EAP.</p>

<h3 id="les-systèmes-properties">Les systèmes properties</h3>

<p>Nous reprennons ici l’ensembles des variables d’environnement de connexion à WebsphereMQ que nous avons vu dans le fichier <strong>jboss-ejb3.xml</strong>.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;system-properties&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"websphere.hostName"</span>         <span class="na">value=</span><span class="s">"localhost"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"websphere.port"</span>             <span class="na">value=</span><span class="s">"1414"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"websphere.username"</span>         <span class="na">value=</span><span class="s">"mqm"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"websphere.password"</span>         <span class="na">value=</span><span class="s">"mqm"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"websphere.channel"</span>          <span class="na">value=</span><span class="s">"SYSTEM.AUTO.SVRCONN"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"websphere.transportType"</span>    <span class="na">value=</span><span class="s">"CLIENT"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"websphere.queueManager"</span>     <span class="na">value=</span><span class="s">"QUEUE.MANAGER"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"websphere.queueName"</span>        <span class="na">value=</span><span class="s">"Q_QUEUE"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"websphere.resource.adapter"</span> <span class="na">value=</span><span class="s">"wmq.jmsra.rar"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/system-properties&gt;</span></code></pre></figure>

<div class="info">
Le mode BINDING est le second type de transport possible pour la connexion à WebsphereMQ, mais il nécessite l'installation de composant binaires spécifiques aux systèmes d'exploitation.
</div>

<h3 id="le-mécanisme-de-remplacement">Le mécanisme de remplacement</h3>

<p>JBoss va utiliser les variables d’environnement et va les remplacer dans certain type objet de l’application.</p>

<p>Il y a trois types de fichier dans lesquels JBoss peut remplacer les placeholder par les variables d’environnement :</p>

<ul>
  <li>Les fichiers descripteurs du standard Java EE
    <ul>
      <li><strong>spec-descriptor-property-replacement</strong></li>
      <li>web.xml, ejb-jar.xml, etc…</li>
    </ul>
  </li>
  <li>Les fichiers descripteurs spécifiques à JBoss
    <ul>
      <li><strong>jboss-descriptor-property-replacement</strong></li>
      <li>jboss-web.xml, jboss-ejb3.xml, etc…</li>
    </ul>
  </li>
  <li>Les annotations
    <ul>
      <li><strong>annotation-property-replacement</strong></li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;subsystem</span> <span class="na">xmlns=</span><span class="s">"urn:jboss:domain:ee:1.2"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;spec-descriptor-property-replacement&gt;</span>false<span class="nt">&lt;/spec-descriptor-property-replacement&gt;</span>
  <span class="nt">&lt;jboss-descriptor-property-replacement&gt;</span>true<span class="nt">&lt;/jboss-descriptor-property-replacement&gt;</span>
  <span class="nt">&lt;annotation-property-replacement&gt;</span>false<span class="nt">&lt;/annotation-property-replacement&gt;</span>
<span class="nt">&lt;/subsystem&gt;</span></code></pre></figure>

<div class="notice">
Je préconise d'effectuer le remplacement uniquement pour les fichiers descripteurs JBoss, car cela est spécifique à JBoss.
</div>

<h3 id="le-ressource-adapteur-pour-la-connexion-à-wmq">Le ressource adapteur pour la connexion à WMQ</h3>

<p>Enfin pour terminer, nous allons configurer le ressource adapteur dans l’instance JBoss.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;subsystem</span> <span class="na">xmlns=</span><span class="s">"urn:jboss:domain:resource-adapters:1.1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;resource-adapters&gt;</span>
    <span class="nt">&lt;resource-adapter</span> <span class="na">id=</span><span class="s">"wmq.jmsra.rar"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;archive&gt;</span>wmq.jmsra.rar<span class="nt">&lt;/archive&gt;</span>
      <span class="nt">&lt;transaction-support&gt;</span>LocalTransaction<span class="nt">&lt;/transaction-support&gt;</span>
      <span class="nt">&lt;connection-definitions&gt;</span>
        <span class="nt">&lt;connection-definition</span> <span class="na">class-name=</span><span class="s">"com.ibm.mq.connector.outbound.ManagedConnectionFactoryImpl"</span> <span class="na">jndi-name=</span><span class="s">"java:/jboss/jms/wmq/connectionFactory"</span> <span class="na">use-java-context=</span><span class="s">"true"</span> <span class="na">pool-name=</span><span class="s">"MQConnectionFactory"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">"port"</span><span class="nt">&gt;</span>${websphere.port:1414}<span class="nt">&lt;/config-property&gt;</span>
          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">"hostName"</span><span class="nt">&gt;</span>${websphere.hostName:localhost}<span class="nt">&lt;/config-property&gt;</span>
          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">"username"</span><span class="nt">&gt;</span>${websphere.username:mqm}<span class="nt">&lt;/config-property&gt;</span>
          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">"password"</span><span class="nt">&gt;</span>${websphere.password:mqm}<span class="nt">&lt;/config-property&gt;</span>
          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">"channel"</span><span class="nt">&gt;</span>${websphere.channel:SYSTEM.AUTO.SVRCONN}<span class="nt">&lt;/config-property&gt;</span>
          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">"transportType"</span><span class="nt">&gt;</span>${websphere.transportType:CLIENT}<span class="nt">&lt;/config-property&gt;</span>
          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">"queueManager"</span><span class="nt">&gt;</span>${websphere.queueManager:QUEUE.MANAGER}<span class="nt">&lt;/config-property&gt;</span>
          <span class="nt">&lt;security&gt;</span>
            <span class="nt">&lt;application/&gt;</span>
          <span class="nt">&lt;/security&gt;</span>
        <span class="nt">&lt;/connection-definition&gt;</span>
      <span class="nt">&lt;/connection-definitions&gt;</span>
      <span class="nt">&lt;admin-objects&gt;</span>
        <span class="nt">&lt;admin-object</span> <span class="na">class-name=</span><span class="s">"com.ibm.mq.connector.outbound.MQQueueProxy"</span> <span class="na">jndi-name=</span><span class="s">"java:/jboss/jms/wmq/queue/Queue"</span> <span class="na">use-java-context=</span><span class="s">"true"</span> <span class="na">pool-name=</span><span class="s">"QueuePool"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">"baseQueueManagerName"</span><span class="nt">&gt;</span>${websphere.queueManager:QUEUE.MANAGER}<span class="nt">&lt;/config-property&gt;</span>
          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">"baseQueueName"</span><span class="nt">&gt;</span>${websphere.queueName:Q_QUEUE}<span class="nt">&lt;/config-property&gt;</span>
        <span class="nt">&lt;/admin-object&gt;</span>
      <span class="nt">&lt;/admin-objects&gt;</span>
    <span class="nt">&lt;/resource-adapter&gt;</span>
  <span class="nt">&lt;/resource-adapters&gt;</span>
<span class="nt">&lt;/subsystem&gt;</span></code></pre></figure>

<div class="info">
On remarquera l'utilisation des placeholders dans cette partie de configuration du fichier standalone.xml
</div>

<p>Il nous reste plus qu’à déposer le resource adapter de Websphere MQ <strong>wmq.jmsra.rar</strong> et notre application dans le répertoire de déploiement de l’instance de JBoss <strong>${JBOSS_HOME}/standalone/deployments</strong>, et le tour est joué.</p>

<h2 id="conclusion">Conclusion</h2>

<p>L’intégration du connecteur WebsphereMQ est relativement aisé dans le serveur d’application JBoss. En respectant les principes de ce post, il est possible d’obtenir une application modulaire et facile à maintenir. Le déploiement sur différents environnements (DEV, INT, PROD) en est simplifié, seules les variables d’environnements dans le fichier <strong>standalone.xml</strong> sont à modifier.</p>

<p><br /></p>

<h3 id="url">URL</h3>

<ul>
  <li><a href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6/html/Administration_and_Configuration_Guide/Deploy_the_WebSphere_MQ_Resource_Adapter.html">https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6/html/Administration_and_Configuration_Guide/Deploy_the_WebSphere_MQ_Resource_Adapter.html</a></li>
  <li><a href="https://developer.jboss.org/message/738670">https://developer.jboss.org/message/738670</a></li>
  <li><a href="https://developer.jboss.org/wiki/WebsphereMQIntegration">https://developer.jboss.org/wiki/WebsphereMQIntegration</a></li>
  <li><a href="http://www-01.ibm.com/support/knowledgecenter/SSFKSJ_7.5.0/com.ibm.mq.dev.doc/q031760_.htm">The installation verification test program for the WebSphere MQ resource adapter</a></li>
  <li><img id="uk" src="/img/flag-uk.png" width="23" height="23" /> <a href="/blog/2015/03/26/websphere-mq-jboss-eap-integration-english-version.html">English version</a></li>
</ul>

<h3 id="remerciements">Remerciements</h3>

<ul>
  <li>Akram B. A. @RedHat pour certaines ressources de ce post</li>
  <li>Guillaume C. @RedHat pour ces conseils</li>
</ul>

  </article>

  <div class="post-social">
    
   <a href="https://twitter.com/share" class="twitter-share-button" data-via="gautric_io">Tweet</a>
   <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'greg-iopen';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


</div>


      </div>
    </main>

    <footer class="site-footer blog-footer">

  <div class="wrapper">

    <h2 class="footer-heading"><a href="#" title="Haut de la page / Head of page">Greg I/Open</a></h2>

    <div class="footer-col-wrapper">
      <p class="text">Cloud Architecte, Greg Autric, Web, Cloud, IoT, Automation, Red Hat, OpenSource</p>

      &mdash; 
 <a href="https://twitter.com/gautric_io">
    <span class="icon  icon--twitter">
      <svg viewBox="0 0 16 16">
        <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
        c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
      </svg>
    </span>
  </a>

 &mdash; 
  <a href="https://github.com/gautric">
    <span class="icon  icon--github">
      <svg viewBox="0 0 16 16">
        <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
      </svg>
    </span>
  </a>

 &mdash;
    </div>


  </div>

  <div class="copyright">Copyright © Greg Autric 2015 - 2022</div>


</footer>


  </body>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60791597-1', 'auto');
    ga('send', 'pageview');

  </script>

</html>
