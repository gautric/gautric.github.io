<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Best Practices Websphere MQ/JBoss EAP 6 | Greg. I/O</title>
<meta name="keywords" content="fr, jboss, eap, wildfly, websphereMQ, JCA">
<meta name="description" content="Intégration de WebSphere MQ avec JBoss EAP 6 : Bonnes pratiques
L&rsquo;intégration entre différents systèmes d&rsquo;entreprise est un défi courant dans les architectures informatiques modernes. Dans cet article, nous allons explorer comment connecter efficacement le serveur d&rsquo;application JBoss EAP 6 avec le système de messagerie IBM WebSphere MQ, en utilisant les standards Java EE et en suivant les meilleures pratiques d&rsquo;intégration.
Introduction au standard JCA et à l&rsquo;intégration JMS
Le serveur d&rsquo;application JBoss EAP est certifié JAVA EE 6, ce qui signifie qu&rsquo;il implémente l&rsquo;ensemble des spécifications de cette version de la plateforme Java Enterprise Edition. Parmi ces spécifications, le standard Java EE Connector Architecture (JCA) est implémenté via le framework IronJacamar.">
<meta name="author" content="">
<link rel="canonical" href="https://gautric.github.io/blog/2015/03/25/best-practices-websphere-mq/jboss-eap-6/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.f247c1259a5749d481b4294f298a6c5d2074697de581723890ba552c718649ff.css" integrity="sha256-8kfBJZpXSdSBtClPKYpsXSB0aX3lgXI4kLpVLHGGSf8=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://gautric.github.io/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://gautric.github.io/android-icon-36x36.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://gautric.github.io/android-icon-36x36.png">
<link rel="apple-touch-icon" href="https://gautric.github.io/apple-icon-180x180.png">
<link rel="mask-icon" href="https://gautric.github.io/apple-icon-180x180.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://gautric.github.io/blog/2015/03/25/best-practices-websphere-mq/jboss-eap-6/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:url" content="https://gautric.github.io/blog/2015/03/25/best-practices-websphere-mq/jboss-eap-6/">
  <meta property="og:site_name" content="Greg. I/O">
  <meta property="og:title" content="Best Practices Websphere MQ/JBoss EAP 6">
  <meta property="og:description" content="Intégration de WebSphere MQ avec JBoss EAP 6 : Bonnes pratiques L’intégration entre différents systèmes d’entreprise est un défi courant dans les architectures informatiques modernes. Dans cet article, nous allons explorer comment connecter efficacement le serveur d’application JBoss EAP 6 avec le système de messagerie IBM WebSphere MQ, en utilisant les standards Java EE et en suivant les meilleures pratiques d’intégration.
Introduction au standard JCA et à l’intégration JMS Le serveur d’application JBoss EAP est certifié JAVA EE 6, ce qui signifie qu’il implémente l’ensemble des spécifications de cette version de la plateforme Java Enterprise Edition. Parmi ces spécifications, le standard Java EE Connector Architecture (JCA) est implémenté via le framework IronJacamar.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2015-03-25T13:58:00+00:00">
    <meta property="article:modified_time" content="2015-03-25T13:58:00+00:00">
    <meta property="article:tag" content="Fr">
    <meta property="article:tag" content="JBoss">
    <meta property="article:tag" content="Eap">
    <meta property="article:tag" content="Wildfly">
    <meta property="article:tag" content="WebsphereMQ">
    <meta property="article:tag" content="JCA">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Best Practices Websphere MQ/JBoss EAP 6">
<meta name="twitter:description" content="Intégration de WebSphere MQ avec JBoss EAP 6 : Bonnes pratiques
L&rsquo;intégration entre différents systèmes d&rsquo;entreprise est un défi courant dans les architectures informatiques modernes. Dans cet article, nous allons explorer comment connecter efficacement le serveur d&rsquo;application JBoss EAP 6 avec le système de messagerie IBM WebSphere MQ, en utilisant les standards Java EE et en suivant les meilleures pratiques d&rsquo;intégration.
Introduction au standard JCA et à l&rsquo;intégration JMS
Le serveur d&rsquo;application JBoss EAP est certifié JAVA EE 6, ce qui signifie qu&rsquo;il implémente l&rsquo;ensemble des spécifications de cette version de la plateforme Java Enterprise Edition. Parmi ces spécifications, le standard Java EE Connector Architecture (JCA) est implémenté via le framework IronJacamar.">
      <meta name="twitter:site" content="@gautric_io">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blog",
      "item": "https://gautric.github.io/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Best Practices Websphere MQ/JBoss EAP 6",
      "item": "https://gautric.github.io/blog/2015/03/25/best-practices-websphere-mq/jboss-eap-6/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Best Practices Websphere MQ/JBoss EAP 6",
  "name": "Best Practices Websphere MQ\/JBoss EAP 6",
  "description": "Intégration de WebSphere MQ avec JBoss EAP 6 : Bonnes pratiques L\u0026rsquo;intégration entre différents systèmes d\u0026rsquo;entreprise est un défi courant dans les architectures informatiques modernes. Dans cet article, nous allons explorer comment connecter efficacement le serveur d\u0026rsquo;application JBoss EAP 6 avec le système de messagerie IBM WebSphere MQ, en utilisant les standards Java EE et en suivant les meilleures pratiques d\u0026rsquo;intégration.\nIntroduction au standard JCA et à l\u0026rsquo;intégration JMS Le serveur d\u0026rsquo;application JBoss EAP est certifié JAVA EE 6, ce qui signifie qu\u0026rsquo;il implémente l\u0026rsquo;ensemble des spécifications de cette version de la plateforme Java Enterprise Edition. Parmi ces spécifications, le standard Java EE Connector Architecture (JCA) est implémenté via le framework IronJacamar.\n",
  "keywords": [
    "fr", "jboss", "eap", "wildfly", "websphereMQ", "JCA"
  ],
  "articleBody": "Intégration de WebSphere MQ avec JBoss EAP 6 : Bonnes pratiques L’intégration entre différents systèmes d’entreprise est un défi courant dans les architectures informatiques modernes. Dans cet article, nous allons explorer comment connecter efficacement le serveur d’application JBoss EAP 6 avec le système de messagerie IBM WebSphere MQ, en utilisant les standards Java EE et en suivant les meilleures pratiques d’intégration.\nIntroduction au standard JCA et à l’intégration JMS Le serveur d’application JBoss EAP est certifié JAVA EE 6, ce qui signifie qu’il implémente l’ensemble des spécifications de cette version de la plateforme Java Enterprise Edition. Parmi ces spécifications, le standard Java EE Connector Architecture (JCA) est implémenté via le framework IronJacamar.\nLe standard JCA permet de connecter les applications Java EE à des ressources externes comme :\nDes brokers de messagerie (JMS) Des systèmes de fichiers Des mainframes D’autres systèmes d’information d’entreprise (EIS) On peut faire l’analogie entre JCA et JDBC : alors que JDBC se limite aux bases de données relationnelles, JCA a une portée beaucoup plus large et permet d’intégrer pratiquement n’importe quel système d’information d’entreprise.\nFonctionnalités prises en charge par JCA Le standard JCA prend en charge un ensemble complet de fonctionnalités essentielles pour l’intégration d’applications :\nConnectivité : Établissement et gestion des connexions aux systèmes externes (sockets, IPC, etc.) Transactions : Support des transactions locales et distribuées (XA) Sécurité : Authentification et autorisation pour l’accès aux ressources distantes Gestion des ressources : Management du cycle de vie des connexions et du threading Contrats de service : Interfaces standardisées entre le serveur d’application et les systèmes externes Pour utiliser JCA, le fournisseur du système externe (dans notre cas, IBM pour WebSphere MQ) fournit un composant appelé Resource Adapter (adaptateur de ressources), qui joue le rôle de driver entre le serveur d’application et le système externe.\nObjectif de cet article : Présenter les meilleures pratiques d’intégration JMS entre WebSphere MQ (WMQ) et JBoss EAP 6, en utilisant le standard JCA pour une solution robuste et maintenable.\nPrérequis et environnement technique Pour mettre en place cette intégration, vous aurez besoin des composants suivants :\nUn serveur JBoss EAP : Téléchargeable sur http://www.jboss.org/products/eap/download/ Un serveur WebSphere MQ : Disponible sur http://www.ibm.com/developerworks/downloads/ws/wmq/ Le Resource Adapter WebSphere MQ : Généralement disponible dans le répertoire /opt/mqm/java/lib/jca après l’installation de WebSphere MQ Warning\nAttention, il s’agit de versions d’essai ou d’évaluation uniquement. Le déploiement en production nécessite l’achat d’une souscription pour JBoss EAP et d’une licence pour IBM WebSphere MQ.\nDéveloppement des composants d’intégration Pour tester notre intégration, nous allons développer deux composants essentiels :\nUn client pour l’envoi de messages JMS Un Message-Driven Bean (MDB) pour la réception des messages Composant d’envoi de messages Pour l’envoi de messages, nous allons créer un EJB Stateless. Cette approche est recommandée dans un environnement Java EE, mais d’autres mécanismes comme une servlet pourraient également être utilisés.\n// ..OMIT .. // @Stateless public class MoMSenderBean { // ..OMIT .. // @Resource(name = \"jms/connectionFactory\") ConnectionFactory factory; @Resource(name = \"jms/queue/Queue\") Queue queue; public void sendMessage(String message) throws JMSException { Connection connection = factory.createConnection(); LOGGER.trace(\"Recuperation d'une connexion {}\", connection); Session session = connection.createSession(false, AUTO_ACKNOWLEDGE); MessageProducer producer = session.createProducer(queue); LOGGER.trace(\"Creation du sender {} sur la queue {}\", producer, queue); TextMessage textMessage = session.createTextMessage(message); textMessage.setJMSCorrelationID(UUID.randomUUID().toString()); producer.send(textMessage); producer.close(); session.close(); connection.close(); } } Points importants à noter dans ce code :\nLes ressources JMS (ConnectionFactory et Queue) sont injectées via l’annotation @Resource Ces ressources sont récupérées du scope courant du module Un identifiant de corrélation unique (UUID) est généré pour chaque message Les ressources sont correctement fermées après utilisation Pour plus d’informations sur la configuration JNDI avec JBoss, consultez la documentation officielle.\nComposant de réception de messages Dans l’architecture Java EE, la réception de messages JMS se fait généralement via un Message-Driven Bean (MDB). Ce type de bean est spécifiquement conçu pour être activé par l’arrivée d’un message dans une file d’attente ou un topic.\nPour créer un MDB, la classe doit implémenter l’interface javax.jms.MessageListener :\n// ..OMIT .. // public class MoMMDB implements MessageListener { // ..OMIT .. // public void onMessage(Message message) { LOGGER.info(\"Received Message from queue: {}\" + (TextMessage) message); } } Bien qu’il soit possible de configurer le MDB directement avec des annotations ActivationSpec, cette approche n’est pas recommandée car elle mélange dans le code des préoccupations techniques liées à l’environnement d’exécution. Nous préférons externaliser cette configuration dans les descripteurs de déploiement, comme nous le verrons plus loin.\nConfiguration de l’application Maintenant que nous avons développé les composants de base, nous devons configurer l’application pour qu’elle se connecte correctement à WebSphere MQ. Cette configuration se fait principalement à travers deux fichiers descripteurs :\nejb-jar.xml : Définition standard Java EE des composants jboss-ejb3.xml : Configuration spécifique à JBoss pour l’intégration avec WebSphere MQ Définition Java EE (ejb-jar.xml) Le fichier ejb-jar.xml définit les composants EJB de notre application selon le standard Java EE :\n",
  "wordCount" : "1962",
  "inLanguage": "en",
  "datePublished": "2015-03-25T13:58:00Z",
  "dateModified": "2015-03-25T13:58:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://gautric.github.io/blog/2015/03/25/best-practices-websphere-mq/jboss-eap-6/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Greg. I/O",
    "logo": {
      "@type": "ImageObject",
      "url": "https://gautric.github.io/apple-icon-180x180.png"
    }
  }
}
</script>
</head>

<body class="" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://gautric.github.io/" accesskey="h" title="Greg. I/O (Alt + H)">
                <img src="https://gautric.github.io/apple-icon-180x180.png" alt="" aria-label="logo"
                    height="35">Greg. I/O</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://gautric.github.io/apropos/" title="À Propos">
                    <span>À Propos</span>
                </a>
            </li>
            <li>
                <a href="https://gautric.github.io/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://gautric.github.io/contact/" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://gautric.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://gautric.github.io/blog/">Blog</a></div>
    <h1 class="post-title entry-hint-parent">
      Best Practices Websphere MQ/JBoss EAP 6
    </h1>
    <div class="post-meta"><span title='2015-03-25 13:58:00 +0000 UTC'>March 25, 2015</span>

</div>
  </header> 
  <div class="post-content"><h1 id="intégration-de-websphere-mq-avec-jboss-eap-6--bonnes-pratiques">Intégration de WebSphere MQ avec JBoss EAP 6 : Bonnes pratiques<a hidden class="anchor" aria-hidden="true" href="#intégration-de-websphere-mq-avec-jboss-eap-6--bonnes-pratiques">#</a></h1>
<p>L&rsquo;intégration entre différents systèmes d&rsquo;entreprise est un défi courant dans les architectures informatiques modernes. Dans cet article, nous allons explorer comment connecter efficacement le serveur d&rsquo;application JBoss EAP 6 avec le système de messagerie IBM WebSphere MQ, en utilisant les standards Java EE et en suivant les meilleures pratiques d&rsquo;intégration.</p>
<h2 id="introduction-au-standard-jca-et-à-lintégration-jms">Introduction au standard JCA et à l&rsquo;intégration JMS<a hidden class="anchor" aria-hidden="true" href="#introduction-au-standard-jca-et-à-lintégration-jms">#</a></h2>
<p>Le serveur d&rsquo;application <a href="http://www.jboss.org/products/eap/overview/">JBoss EAP</a> est <a href="http://www.oracle.com/technetwork/java/javaee/overview/compatibility-jsp-136984.html">certifié JAVA EE 6</a>, ce qui signifie qu&rsquo;il implémente l&rsquo;ensemble des spécifications de cette version de la plateforme Java Enterprise Edition. Parmi ces spécifications, le standard Java EE Connector Architecture (JCA) est implémenté via le framework <a href="http://www.ironjacamar.org/">IronJacamar</a>.</p>
<p>Le standard JCA permet de connecter les applications Java EE à des ressources externes comme :</p>
<ul>
<li>Des brokers de messagerie (JMS)</li>
<li>Des systèmes de fichiers</li>
<li>Des mainframes</li>
<li>D&rsquo;autres systèmes d&rsquo;information d&rsquo;entreprise (EIS)</li>
</ul>
<p>On peut faire l&rsquo;analogie entre JCA et JDBC : alors que JDBC se limite aux bases de données relationnelles, JCA a une portée beaucoup plus large et permet d&rsquo;intégrer pratiquement n&rsquo;importe quel système d&rsquo;information d&rsquo;entreprise.</p>
<h3 id="fonctionnalités-prises-en-charge-par-jca">Fonctionnalités prises en charge par JCA<a hidden class="anchor" aria-hidden="true" href="#fonctionnalités-prises-en-charge-par-jca">#</a></h3>
<p>Le standard JCA prend en charge un ensemble complet de fonctionnalités essentielles pour l&rsquo;intégration d&rsquo;applications :</p>
<ul>
<li><strong>Connectivité</strong> : Établissement et gestion des connexions aux systèmes externes (sockets, IPC, etc.)</li>
<li><strong>Transactions</strong> : Support des transactions locales et distribuées (XA)</li>
<li><strong>Sécurité</strong> : Authentification et autorisation pour l&rsquo;accès aux ressources distantes</li>
<li><strong>Gestion des ressources</strong> : Management du cycle de vie des connexions et du threading</li>
<li><strong>Contrats de service</strong> : Interfaces standardisées entre le serveur d&rsquo;application et les systèmes externes</li>
</ul>
<p>Pour utiliser JCA, le fournisseur du système externe (dans notre cas, IBM pour WebSphere MQ) fournit un composant appelé <strong>Resource Adapter</strong> (adaptateur de ressources), qui joue le rôle de driver entre le serveur d&rsquo;application et le système externe.</p>
<blockquote>
<p><strong>Objectif de cet article</strong> : Présenter les meilleures pratiques d&rsquo;intégration JMS entre WebSphere MQ (WMQ) et JBoss EAP 6, en utilisant le standard JCA pour une solution robuste et maintenable.</p>
</blockquote>
<h2 id="prérequis-et-environnement-technique">Prérequis et environnement technique<a hidden class="anchor" aria-hidden="true" href="#prérequis-et-environnement-technique">#</a></h2>
<p>Pour mettre en place cette intégration, vous aurez besoin des composants suivants :</p>
<ul>
<li><strong>Un serveur JBoss EAP</strong> : Téléchargeable sur <a href="http://www.jboss.org/products/eap/download/">http://www.jboss.org/products/eap/download/</a></li>
<li><strong>Un serveur WebSphere MQ</strong> : Disponible sur <a href="http://www.ibm.com/developerworks/downloads/ws/wmq/">http://www.ibm.com/developerworks/downloads/ws/wmq/</a></li>
<li><strong>Le Resource Adapter WebSphere MQ</strong> : Généralement disponible dans le répertoire <strong>/opt/mqm/java/lib/jca</strong> après l&rsquo;installation de WebSphere MQ</li>
</ul>
<div><svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg"><symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></symbol></svg></div><div class="notice warning" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#warning-notice"></use></svg></span>Warning</p><p>Attention, il s&rsquo;agit de versions d&rsquo;essai ou d&rsquo;évaluation uniquement. Le déploiement en production nécessite l&rsquo;achat d&rsquo;une souscription pour JBoss EAP et d&rsquo;une licence pour IBM WebSphere MQ.</p></div>

<h2 id="développement-des-composants-dintégration">Développement des composants d&rsquo;intégration<a hidden class="anchor" aria-hidden="true" href="#développement-des-composants-dintégration">#</a></h2>
<p>Pour tester notre intégration, nous allons développer deux composants essentiels :</p>
<ol>
<li>Un client pour l&rsquo;envoi de messages JMS</li>
<li>Un Message-Driven Bean (MDB) pour la réception des messages</li>
</ol>
<h3 id="composant-denvoi-de-messages">Composant d&rsquo;envoi de messages<a hidden class="anchor" aria-hidden="true" href="#composant-denvoi-de-messages">#</a></h3>
<p>Pour l&rsquo;envoi de messages, nous allons créer un EJB Stateless. Cette approche est recommandée dans un environnement Java EE, mais d&rsquo;autres mécanismes comme une servlet pourraient également être utilisés.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ..OMIT .. //</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Stateless</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MoMSenderBean</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">// ..OMIT .. //</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nd">@Resource</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;jms/connectionFactory&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">ConnectionFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nd">@Resource</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;jms/queue/Queue&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Queue</span><span class="w"> </span><span class="n">queue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendMessage</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">JMSException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Connection</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="na">createConnection</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">trace</span><span class="p">(</span><span class="s">&#34;Recuperation d&#39;une connexion {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">connection</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Session</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="na">createSession</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">AUTO_ACKNOWLEDGE</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">MessageProducer</span><span class="w"> </span><span class="n">producer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createProducer</span><span class="p">(</span><span class="n">queue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">trace</span><span class="p">(</span><span class="s">&#34;Creation du sender {} sur la queue {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">producer</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">TextMessage</span><span class="w"> </span><span class="n">textMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createTextMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">textMessage</span><span class="p">.</span><span class="na">setJMSCorrelationID</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">producer</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">textMessage</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">producer</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">session</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">connection</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="notice notice" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#notice-notice"></use></svg></span></p><p>Points importants à noter dans ce code :</p>
<ol>
<li>Les ressources JMS (ConnectionFactory et Queue) sont injectées via l&rsquo;annotation @Resource</li>
<li>Ces ressources sont récupérées du scope courant du module</li>
<li>Un identifiant de corrélation unique (UUID) est généré pour chaque message</li>
<li>Les ressources sont correctement fermées après utilisation</li>
</ol></div>

<p>Pour plus d&rsquo;informations sur la configuration JNDI avec JBoss, consultez la <a href="https://docs.jboss.org/author/display/AS72/JNDI+Reference">documentation officielle</a>.</p>
<h3 id="composant-de-réception-de-messages">Composant de réception de messages<a hidden class="anchor" aria-hidden="true" href="#composant-de-réception-de-messages">#</a></h3>
<p>Dans l&rsquo;architecture Java EE, la réception de messages JMS se fait généralement via un Message-Driven Bean (MDB). Ce type de bean est spécifiquement conçu pour être activé par l&rsquo;arrivée d&rsquo;un message dans une file d&rsquo;attente ou un topic.</p>
<p>Pour créer un MDB, la classe doit implémenter l&rsquo;interface <strong>javax.jms.MessageListener</strong> :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ..OMIT .. //</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MoMMDB</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">MessageListener</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">// ..OMIT .. //</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;Received Message from queue: {}&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">TextMessage</span><span class="p">)</span><span class="w"> </span><span class="n">message</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="notice notice" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#notice-notice"></use></svg></span></p><p>Bien qu&rsquo;il soit possible de configurer le MDB directement avec des annotations ActivationSpec, cette approche n&rsquo;est pas recommandée car elle mélange dans le code des préoccupations techniques liées à l&rsquo;environnement d&rsquo;exécution. Nous préférons externaliser cette configuration dans les descripteurs de déploiement, comme nous le verrons plus loin.</p></div>

<h2 id="configuration-de-lapplication">Configuration de l&rsquo;application<a hidden class="anchor" aria-hidden="true" href="#configuration-de-lapplication">#</a></h2>
<p>Maintenant que nous avons développé les composants de base, nous devons configurer l&rsquo;application pour qu&rsquo;elle se connecte correctement à WebSphere MQ. Cette configuration se fait principalement à travers deux fichiers descripteurs :</p>
<ol>
<li><strong>ejb-jar.xml</strong> : Définition standard Java EE des composants</li>
<li><strong>jboss-ejb3.xml</strong> : Configuration spécifique à JBoss pour l&rsquo;intégration avec WebSphere MQ</li>
</ol>
<h3 id="définition-java-ee-ejb-jarxml">Définition Java EE (ejb-jar.xml)<a hidden class="anchor" aria-hidden="true" href="#définition-java-ee-ejb-jarxml">#</a></h3>
<p>Le fichier <strong>ejb-jar.xml</strong> définit les composants EJB de notre application selon le standard Java EE :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;ejb-jar</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class="na">xmlns=</span><span class="s">&#34;http://java.sun.com/xml/ns/javaee&#34;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_0.xsd&#34;</span> <span class="na">version=</span><span class="s">&#34;3.0&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;description&gt;</span>MoM Application EJB / MDB <span class="nt">&lt;/description&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;display-name&gt;</span>MoM Application EJB / MDB<span class="nt">&lt;/display-name&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;enterprise-beans&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;message-driven&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;description&gt;</span>MoM MDB<span class="nt">&lt;/description&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;ejb-name&gt;</span>MessageDrivenBean<span class="nt">&lt;/ejb-name&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;ejb-class&gt;</span>net.a.g.jee.mom.mdb.MoMMDB<span class="nt">&lt;/ejb-class&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;transaction-type&gt;</span>Container<span class="nt">&lt;/transaction-type&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;message-destination-type&gt;</span>javax.jms.Queue<span class="nt">&lt;/message-destination-type&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/message-driven&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;session&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;ejb-name&gt;</span>MoMSenderBean<span class="nt">&lt;/ejb-name&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;ejb-class&gt;</span>net.a.g.jee.mom.ejb.MoMSenderBean<span class="nt">&lt;/ejb-class&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/session&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/enterprise-beans&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/ejb-jar&gt;</span>
</span></span></code></pre></div><p>Ce fichier définit :</p>
<ul>
<li>Un Message-Driven Bean nommé &ldquo;MessageDrivenBean&rdquo; qui écoute une file d&rsquo;attente JMS</li>
<li>Un EJB de session nommé &ldquo;MoMSenderBean&rdquo; qui sera utilisé pour envoyer des messages</li>
</ul>
<h3 id="configuration-spécifique-à-jboss-jboss-ejb3xml">Configuration spécifique à JBoss (jboss-ejb3.xml)<a hidden class="anchor" aria-hidden="true" href="#configuration-spécifique-à-jboss-jboss-ejb3xml">#</a></h3>
<p>Le fichier <strong>jboss-ejb3.xml</strong> contient la configuration spécifique à JBoss pour l&rsquo;intégration avec WebSphere MQ :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;jboss:ejb-jar</span> <span class="na">xmlns:jboss=</span><span class="s">&#34;http://www.jboss.com/xml/ns/javaee&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">xmlns=</span><span class="s">&#34;http://java.sun.com/xml/ns/javaee&#34;</span> <span class="na">xmlns:jee=</span><span class="s">&#34;http://java.sun.com/xml/ns/javaee&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class="na">xmlns:mdb=</span><span class="s">&#34;urn:resource-adapter-binding&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">version=</span><span class="s">&#34;3.1&#34;</span> <span class="na">impl-version=</span><span class="s">&#34;2.0&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;jee:enterprise-beans&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;jee:message-driven&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;jee:ejb-name&gt;</span>MessageDrivenBean<span class="nt">&lt;/jee:ejb-name&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;jee:ejb-class&gt;</span>net.a.g.jee.mom.mdb.MoMMDB<span class="nt">&lt;/jee:ejb-class&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;jee:transaction-type&gt;</span>Container<span class="nt">&lt;/jee:transaction-type&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;jee:message-destination-type&gt;</span>javax.jms.Queue<span class="nt">&lt;/jee:message-destination-type&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;jee:activation-config&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>channel<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.channel}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>queueManager<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.queueManager}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>transportType<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.transportType}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>hostName<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.hostName}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>port<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.port}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>username<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.username}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>password<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>${websphere.password}<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>destination<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>java:/jboss/jms/wmq/queue/Queue<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>useJNDI<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>true<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-name&gt;</span>destinationType<span class="nt">&lt;/jee:activation-config-property-name&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;jee:activation-config-property-value&gt;</span>javax.jms.Queue<span class="nt">&lt;/jee:activation-config-property-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/jee:activation-config-property&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/jee:activation-config&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/jee:message-driven&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;jee:session&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;jee:ejb-name&gt;</span>MoMSenderBean<span class="nt">&lt;/jee:ejb-name&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;jee:ejb-class&gt;</span>net.a.g.jee.mom.ejb.MoMSenderBean<span class="nt">&lt;/jee:ejb-class&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;jee:resource-ref&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:res-ref-name&gt;</span>jms/connectionFactory<span class="nt">&lt;/jee:res-ref-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:res-type&gt;</span>javax.jms.ConnectionFactory<span class="nt">&lt;/jee:res-type&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:lookup-name&gt;</span>java:/jboss/jms/wmq/connectionFactory<span class="nt">&lt;/jee:lookup-name&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/jee:resource-ref&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;jee:resource-env-ref&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:resource-env-ref-name&gt;</span>jms/queue/Queue<span class="nt">&lt;/jee:resource-env-ref-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jee:lookup-name&gt;</span>java:/jboss/jms/wmq/queue/Queue<span class="nt">&lt;/jee:lookup-name&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/jee:resource-env-ref&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/jee:session&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/jee:enterprise-beans&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;jee:assembly-descriptor&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mdb:resource-adapter-binding&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;jee:ejb-name&gt;</span>MessageDrivenBean<span class="nt">&lt;/jee:ejb-name&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mdb:resource-adapter-name&gt;</span>${websphere.resource.adapter}<span class="nt">&lt;/mdb:resource-adapter-name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/mdb:resource-adapter-binding&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/jee:assembly-descriptor&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/jboss:ejb-jar&gt;</span>
</span></span></code></pre></div><h4 id="points-clés-de-cette-configuration">Points clés de cette configuration<a hidden class="anchor" aria-hidden="true" href="#points-clés-de-cette-configuration">#</a></h4>
<p>Cette configuration contient plusieurs éléments importants à comprendre :</p>
<ol>
<li>
<p><strong>Utilisation de placeholders</strong> : Toutes les informations techniques sont externalisées via des placeholders (variables) qui seront remplacés par les valeurs définies dans le fichier standalone.xml :</p>
<ul>
<li><code>${websphere.hostName}</code> : Nom d&rsquo;hôte du serveur WebSphere MQ</li>
<li><code>${websphere.port}</code> : Port d&rsquo;écoute</li>
<li><code>${websphere.queueManager}</code> : Nom du gestionnaire de files d&rsquo;attente</li>
<li>etc.</li>
</ul>
</li>
<li>
<p><strong>Activation de l&rsquo;utilisation JNDI</strong> : La propriété <code>useJNDI</code> est définie à <code>true</code> pour permettre la récupération de la file d&rsquo;attente par son nom JNDI.</p>
</li>
<li>
<p><strong>Mapping des noms JNDI</strong> : Les noms JNDI utilisés dans l&rsquo;application sont mappés aux noms JNDI configurés dans le serveur JBoss :</p>
<ul>
<li>Nom JNDI dans le serveur : <code>java:/jboss/jms/wmq/queue/Queue</code></li>
<li>Nom JNDI utilisé dans l&rsquo;application : <code>jms/queue/Queue</code></li>
</ul>
</li>
<li>
<p><strong>Binding du Resource Adapter</strong> : Le MDB est explicitement lié au Resource Adapter WebSphere MQ via la balise <code>&lt;mdb:resource-adapter-binding&gt;</code>.</p>
</li>
</ol>
<div class="notice warning" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#warning-notice"></use></svg></span>Warning</p><p>Dans un contexte d&rsquo;entreprise, il est fortement recommandé d&rsquo;utiliser des fichiers XML de configuration plutôt que des annotations Java. Cette approche facilite les changements d&rsquo;environnement (développement, test, production) sans nécessiter de recompilation du code. Le code Java doit rester aussi indépendant que possible de l&rsquo;environnement d&rsquo;exécution et des détails d&rsquo;implémentation des systèmes externes.</p></div>

<div class="notice info" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#info-notice"></use></svg></span>Info</p><p>Si votre application doit se connecter à plusieurs systèmes JMS différents, il est recommandé de créer un fichier jboss-ejb3.xml distinct pour chaque système. Cela permet de maintenir une séparation claire des configurations et facilite la maintenance.</p></div>

<h2 id="configuration-du-serveur-jboss-eap">Configuration du serveur JBoss EAP<a hidden class="anchor" aria-hidden="true" href="#configuration-du-serveur-jboss-eap">#</a></h2>
<p>Après avoir configuré l&rsquo;application, nous devons maintenant configurer le serveur JBoss EAP pour qu&rsquo;il puisse communiquer avec WebSphere MQ. Cette configuration se fait dans le fichier <strong>standalone.xml</strong> de l&rsquo;instance JBoss.</p>
<h3 id="définition-des-propriétés-système">Définition des propriétés système<a hidden class="anchor" aria-hidden="true" href="#définition-des-propriétés-système">#</a></h3>
<p>Commençons par définir les propriétés système qui seront utilisées pour remplacer les placeholders dans notre configuration :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;system-properties&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;websphere.hostName&#34;</span>         <span class="na">value=</span><span class="s">&#34;localhost&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;websphere.port&#34;</span>             <span class="na">value=</span><span class="s">&#34;1414&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;websphere.username&#34;</span>         <span class="na">value=</span><span class="s">&#34;mqm&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;websphere.password&#34;</span>         <span class="na">value=</span><span class="s">&#34;mqm&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;websphere.channel&#34;</span>          <span class="na">value=</span><span class="s">&#34;SYSTEM.AUTO.SVRCONN&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;websphere.transportType&#34;</span>    <span class="na">value=</span><span class="s">&#34;CLIENT&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;websphere.queueManager&#34;</span>     <span class="na">value=</span><span class="s">&#34;QUEUE.MANAGER&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;websphere.queueName&#34;</span>        <span class="na">value=</span><span class="s">&#34;Q_QUEUE&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;websphere.resource.adapter&#34;</span> <span class="na">value=</span><span class="s">&#34;wmq.jmsra.rar&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/system-properties&gt;</span>
</span></span></code></pre></div><p>Ces propriétés définissent tous les paramètres nécessaires pour se connecter au serveur WebSphere MQ :</p>
<ul>
<li>Informations de connexion (hôte, port)</li>
<li>Identifiants d&rsquo;authentification (nom d&rsquo;utilisateur, mot de passe)</li>
<li>Configuration du canal et du gestionnaire de files d&rsquo;attente</li>
<li>Nom du Resource Adapter à utiliser</li>
</ul>
<div class="notice info" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#info-notice"></use></svg></span>Info</p><p>WebSphere MQ propose deux modes de transport principaux :</p>
<ul>
<li><strong>CLIENT</strong> : Mode utilisé ici, qui fonctionne via TCP/IP et ne nécessite pas d&rsquo;installation locale de WebSphere MQ</li>
<li><strong>BINDING</strong> : Mode qui offre de meilleures performances mais nécessite l&rsquo;installation de composants binaires spécifiques au système d&rsquo;exploitation sur la même machine que JBoss</li>
</ul></div>

<h3 id="configuration-du-mécanisme-de-remplacement-des-propriétés">Configuration du mécanisme de remplacement des propriétés<a hidden class="anchor" aria-hidden="true" href="#configuration-du-mécanisme-de-remplacement-des-propriétés">#</a></h3>
<p>JBoss EAP offre un mécanisme puissant pour remplacer les placeholders par les valeurs des propriétés système dans différents types de fichiers de configuration. Voici comment l&rsquo;activer :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;subsystem</span> <span class="na">xmlns=</span><span class="s">&#34;urn:jboss:domain:ee:1.2&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;spec-descriptor-property-replacement&gt;</span>false<span class="nt">&lt;/spec-descriptor-property-replacement&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;jboss-descriptor-property-replacement&gt;</span>true<span class="nt">&lt;/jboss-descriptor-property-replacement&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;annotation-property-replacement&gt;</span>false<span class="nt">&lt;/annotation-property-replacement&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/subsystem&gt;</span>
</span></span></code></pre></div><p>Cette configuration active le remplacement des propriétés uniquement dans les descripteurs spécifiques à JBoss (comme jboss-ejb3.xml), mais pas dans les descripteurs standard Java EE ni dans les annotations.</p>
<p>Les trois options disponibles sont :</p>
<ul>
<li><strong>spec-descriptor-property-replacement</strong> : Pour les fichiers descripteurs standard Java EE (web.xml, ejb-jar.xml, etc.)</li>
<li><strong>jboss-descriptor-property-replacement</strong> : Pour les fichiers descripteurs spécifiques à JBoss (jboss-web.xml, jboss-ejb3.xml, etc.)</li>
<li><strong>annotation-property-replacement</strong> : Pour les annotations Java</li>
</ul>
<div class="notice note" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#note-notice"></use></svg></span>Note</p><p>Il est recommandé d&rsquo;activer le remplacement uniquement pour les descripteurs JBoss, car cela maintient une séparation claire entre la configuration standard Java EE et la configuration spécifique à l&rsquo;environnement d&rsquo;exécution.</p></div>

<h3 id="configuration-du-resource-adapter-websphere-mq">Configuration du Resource Adapter WebSphere MQ<a hidden class="anchor" aria-hidden="true" href="#configuration-du-resource-adapter-websphere-mq">#</a></h3>
<p>Enfin, nous devons configurer le Resource Adapter WebSphere MQ dans le serveur JBoss :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;subsystem</span> <span class="na">xmlns=</span><span class="s">&#34;urn:jboss:domain:resource-adapters:1.1&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;resource-adapters&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;resource-adapter</span> <span class="na">id=</span><span class="s">&#34;wmq.jmsra.rar&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;archive&gt;</span>wmq.jmsra.rar<span class="nt">&lt;/archive&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;transaction-support&gt;</span>LocalTransaction<span class="nt">&lt;/transaction-support&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;connection-definitions&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;connection-definition</span> <span class="na">class-name=</span><span class="s">&#34;com.ibm.mq.connector.outbound.ManagedConnectionFactoryImpl&#34;</span> <span class="na">jndi-name=</span><span class="s">&#34;java:/jboss/jms/wmq/connectionFactory&#34;</span> <span class="na">use-java-context=</span><span class="s">&#34;true&#34;</span> <span class="na">pool-name=</span><span class="s">&#34;MQConnectionFactory&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">&#34;port&#34;</span><span class="nt">&gt;</span>${websphere.port:1414}<span class="nt">&lt;/config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">&#34;hostName&#34;</span><span class="nt">&gt;</span>${websphere.hostName:localhost}<span class="nt">&lt;/config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">&#34;username&#34;</span><span class="nt">&gt;</span>${websphere.username:mqm}<span class="nt">&lt;/config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span><span class="nt">&gt;</span>${websphere.password:mqm}<span class="nt">&lt;/config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">&#34;channel&#34;</span><span class="nt">&gt;</span>${websphere.channel:SYSTEM.AUTO.SVRCONN}<span class="nt">&lt;/config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">&#34;transportType&#34;</span><span class="nt">&gt;</span>${websphere.transportType:CLIENT}<span class="nt">&lt;/config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">&#34;queueManager&#34;</span><span class="nt">&gt;</span>${websphere.queueManager:QUEUE.MANAGER}<span class="nt">&lt;/config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;security&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;application/&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;/security&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/connection-definition&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/connection-definitions&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;admin-objects&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;admin-object</span> <span class="na">class-name=</span><span class="s">&#34;com.ibm.mq.connector.outbound.MQQueueProxy&#34;</span> <span class="na">jndi-name=</span><span class="s">&#34;java:/jboss/jms/wmq/queue/Queue&#34;</span> <span class="na">use-java-context=</span><span class="s">&#34;true&#34;</span> <span class="na">pool-name=</span><span class="s">&#34;QueuePool&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">&#34;baseQueueManagerName&#34;</span><span class="nt">&gt;</span>${websphere.queueManager:QUEUE.MANAGER}<span class="nt">&lt;/config-property&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;config-property</span> <span class="na">name=</span><span class="s">&#34;baseQueueName&#34;</span><span class="nt">&gt;</span>${websphere.queueName:Q_QUEUE}<span class="nt">&lt;/config-property&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/admin-object&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/admin-objects&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/resource-adapter&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/resource-adapters&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/subsystem&gt;</span>
</span></span></code></pre></div><p>Cette configuration définit :</p>
<ol>
<li><strong>Le Resource Adapter</strong> : Identifié par &ldquo;wmq.jmsra.rar&rdquo;, qui est le fichier RAR fourni par IBM</li>
<li><strong>Le support transactionnel</strong> : Ici configuré pour les transactions locales</li>
<li><strong>La ConnectionFactory</strong> : Exposée via JNDI sous le nom &ldquo;java:/jboss/jms/wmq/connectionFactory&rdquo;</li>
<li><strong>La file d&rsquo;attente</strong> : Exposée via JNDI sous le nom &ldquo;java:/jboss/jms/wmq/queue/Queue&rdquo;</li>
</ol>
<div class="notice info" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#info-notice"></use></svg></span>Info</p><p>Notez l&rsquo;utilisation des placeholders avec des valeurs par défaut (par exemple <code>${websphere.port:1414}</code>). Cette syntaxe permet de spécifier une valeur par défaut qui sera utilisée si la propriété système n&rsquo;est pas définie.</p></div>

<h2 id="déploiement-et-mise-en-œuvre">Déploiement et mise en œuvre<a hidden class="anchor" aria-hidden="true" href="#déploiement-et-mise-en-œuvre">#</a></h2>
<p>Une fois toutes les configurations effectuées, il ne reste plus qu&rsquo;à déployer les composants nécessaires :</p>
<ol>
<li>Copiez le Resource Adapter WebSphere MQ (<strong>wmq.jmsra.rar</strong>) dans le répertoire de déploiement de JBoss : <code>${JBOSS_HOME}/standalone/deployments</code></li>
<li>Déployez votre application (WAR ou EAR) dans le même répertoire</li>
</ol>
<p>JBoss détectera automatiquement ces nouveaux déploiements et les activera. Votre application sera alors capable de communiquer avec WebSphere MQ.</p>
<h2 id="conclusion--avantages-de-cette-approche-dintégration">Conclusion : Avantages de cette approche d&rsquo;intégration<a hidden class="anchor" aria-hidden="true" href="#conclusion--avantages-de-cette-approche-dintégration">#</a></h2>
<p>L&rsquo;intégration entre JBoss EAP et WebSphere MQ via le standard JCA présente de nombreux avantages :</p>
<ol>
<li>
<p><strong>Modularité et maintenabilité</strong> : La séparation claire entre le code applicatif et la configuration d&rsquo;intégration facilite la maintenance et l&rsquo;évolution du système.</p>
</li>
<li>
<p><strong>Portabilité entre environnements</strong> : Le déploiement sur différents environnements (développement, test, production) est simplifié, car seules les variables d&rsquo;environnement dans le fichier standalone.xml doivent être modifiées.</p>
</li>
<li>
<p><strong>Utilisation des standards</strong> : L&rsquo;approche basée sur JCA et les standards Java EE garantit une meilleure interopérabilité et pérennité de la solution.</p>
</li>
<li>
<p><strong>Gestion des ressources optimisée</strong> : JCA fournit des mécanismes avancés pour la gestion des connexions, des transactions et de la sécurité, ce qui améliore les performances et la fiabilité du système.</p>
</li>
<li>
<p><strong>Flexibilité</strong> : Cette architecture permet de changer facilement de fournisseur JMS si nécessaire, en modifiant uniquement la configuration et non le code applicatif.</p>
</li>
</ol>
<p>En suivant les bonnes pratiques présentées dans cet article, vous pouvez mettre en place une intégration robuste et évolutive entre JBoss EAP et WebSphere MQ, qui répondra aux exigences des applications d&rsquo;entreprise modernes.</p>
<h3 id="ressources-utiles-pour-approfondir">Ressources utiles pour approfondir<a hidden class="anchor" aria-hidden="true" href="#ressources-utiles-pour-approfondir">#</a></h3>
<ul>
<li><a href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6/html/Administration_and_Configuration_Guide/Deploy_the_WebSphere_MQ_Resource_Adapter.html">Documentation Red Hat sur le déploiement du WebSphere MQ Resource Adapter</a></li>
<li><a href="https://developer.jboss.org/message/738670">Discussion sur le forum JBoss Developer</a></li>
<li><a href="https://developer.jboss.org/wiki/WebsphereMQIntegration">Wiki sur l&rsquo;intégration WebSphere MQ</a></li>
<li><a href="http://www-01.ibm.com/support/knowledgecenter/SSFKSJ_7.5.0/com.ibm.mq.dev.doc/q031760_.htm">Programme de test de vérification d&rsquo;installation pour le WebSphere MQ resource adapter</a></li>
<li><img id="en" src="/img/flag-uk.png" width="23" height="23" alt="English version"/> <a href="/blog/2015/03/26/websphere-mq-jboss-eap-integration-english-version.html">Version anglaise</a></li>
</ul>
<h3 id="remerciements">Remerciements<a hidden class="anchor" aria-hidden="true" href="#remerciements">#</a></h3>
<ul>
<li>Akram B. A. @RedHat pour certaines ressources de ce post</li>
<li>Guillaume C. @RedHat pour ses conseils</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://gautric.github.io/tags/fr/">Fr</a></li>
      <li><a href="https://gautric.github.io/tags/jboss/">JBoss</a></li>
      <li><a href="https://gautric.github.io/tags/eap/">Eap</a></li>
      <li><a href="https://gautric.github.io/tags/wildfly/">Wildfly</a></li>
      <li><a href="https://gautric.github.io/tags/webspheremq/">WebsphereMQ</a></li>
      <li><a href="https://gautric.github.io/tags/jca/">JCA</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://gautric.github.io/blog/2015/03/26/best-practices-websphere-mq/jboss-eap-6-english-version/">
    <span class="title">« Prev</span>
    <br>
    <span>Best Practices Websphere MQ/JBoss EAP 6 English Version</span>
  </a>
  <a class="next" href="https://gautric.github.io/blog/2015/03/19/yubico-otp-et-jboss-eap-6-ou-wildfly-8/">
    <span class="title">Next »</span>
    <br>
    <span>Yubico OTP et JBoss EAP 6 ou Wildfly 8</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2016 - 2025 <a href="https://gautric.github.io/">Greg. I/O</a></span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
</body>

</html>
