<!DOCTYPE html>
<html><!--<![-->
<head>

  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Yesterday, Wildfly community has just released Wildfly 9.0.0.Final, the last Application Server version. As I talked on my previous French post about Wildfly..."/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Icon bar -->
  <link rel="apple-touch-icon" sizes="57x57" href="/img/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/img/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/img/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/img/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/img/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/img/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/img/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/img/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
  <meta name="robots" content="index,follow,noarchive" />
  <meta name="googlebot" content="noarchive" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="Greg I/O" />
  <meta name="twitter:site:id" content="@gautric_io" />
  <meta name="twitter:creator" content="@gautric_io" />
  <meta name="twitter:title" content="Wildfly 9.0 Offline CLI and HTTP/2" />
  <meta name="twitter:description" content="Yesterday, Wildfly community has just released Wildfly 9.0.0.Final, the last Application Server version. As I talked on my previous French post about Wildfly..." />
  <meta name="twitter:image" content="/img/apple-icon-152x152.png" />

  <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="/blog/2015/07/03/wildfly-offline-cli-http-2.html">
  <link rel="alternate" type="application/rss+xml" title="Greg I/Open" href="/feed.xml" />
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <title>Wildfly 9.0 Offline CLI and HTTP/2</title>
</head>

  <body>
        <header class="site-header blog-header">

  <div class="wrapper">

    <a class="site-title blog-site-title" href="/">Greg I/Open</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        <a class="page-link" href="/apropos">A propos</a><a class="page-link" href="/blog">Blog</a><a class="page-link" href="/contact">Contact</a>
      </div>
    </nav>

  </div>

</header>


    <header class="post-header blog-title">
      <div class="wrapper">
      <h1 class="post-title">Wildfly 9.0 Offline CLI and HTTP/2</h1>
    </div>
    </header>

    <main class="page-content" role="main">
      <div class="wrapper">
          <article class="post-content">
    <p class="post-meta">Jul 3, 2015  <a href="#en">en</a>  <a href="#wildfly">wildfly</a>  <a href="#Offline">Offline</a>  <a href="#CLI">CLI</a>  <a href="#HTTP/2">HTTP/2</a>  <a href="#JDK8">JDK8</a> </p>
    <p>Yesterday, Wildfly community has just released <a href="http://wildfly.org/news/2015/07/02/WildFly9-Final-Released/"><strong><em>Wildfly 9.0.0.Final</em></strong></a>, the last Application Server version. As I talked on my previous <a href="/blog/2015/05/04/wildfly-9-CR01-released-sortie.html">French post about Wildfly</a> they are a lot of new cool stuffs. I noticed two of them we could use both together quickly. Into a datacenter, we want setup the first configuration without startup full process and open unnecessary port. I propose in this post to setup <a href="https://en.wikipedia.org/wiki/HTTP/2"><strong><em>HTTP/2</em></strong></a> with offline mode, it is quite useful because we could want to start a JBoss instance directly with HTTP/2 protocol enabled.</p>

<blockquote>
  <p>How to setup HTTP/2 configuration into Wildfly 9.0.0.Final with offline mode.</p>
</blockquote>

<h2 id="download-wildfly">Download Wildfly</h2>

<p>Please download it following <a href="http://wildfly.org/downloads/">this link</a>.</p>

<h2 id="installation">Installation</h2>

<p>After downloading it, you just have to unzip it into your folder like this :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">tar</span> <span class="nt">-zxvf</span> wildfly-9.0.0.Final.tar.gz</code></pre></figure>

<h2 id="x509-certificate">X509 Certificate</h2>

<p>HTTP/2 doesn’t need an encryption layer for transport, but we gonna implement it in this example.</p>

<p>Create a self-signed certificate</p>

<script src="https://gist.github.com/gautric/0a1d6b33fef9778d83b0.js"></script>

<p>Export it for your web browser</p>

<script src="https://gist.github.com/gautric/0208abcfdedc78b6471f.js"></script>

<h2 id="secure-configuration">Secure configuration</h2>

<p>Due of some JDK 8 limitations, <a href="http://www.eclipse.org/jetty/documentation/current/alpn-chapter.html">ALPN</a> isn’t supported natively by JDK 8. We will download it from the <a href="https://eclipse.org/org/"><em>Eclipse Foundation</em></a>. This feature is mandatory for the HTTP/2 protocol with encryption.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">export </span><span class="nv">ALPN_VERSION</span><span class="o">=</span>8.1.3.v20150130
curl http://central.maven.org/maven2/org/mortbay/jetty/alpn/alpn-boot/<span class="nv">$ALPN_VERSION</span>/alpn-boot-<span class="nv">$ALPN_VERSION</span>.jar <span class="o">&gt;</span> <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/alpn-boot-<span class="nv">$ALPN_VERSION</span>.jar
<span class="nb">export </span><span class="nv">JAVA_OPTS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$JAVA_OPTS</span><span class="s2"> -Xbootclasspath/p:</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span><span class="s2">/alpn-boot-</span><span class="nv">$ALPN_VERSION</span><span class="s2">.jar"</span></code></pre></figure>

<h2 id="configure-the-http2-into-undertow">Configure the HTTP/2 into Undertow</h2>

<p>Now, the best part, Wildly isn’t running yet and we will execute some Offline CLI commands to configure the standalone instance.
To use the offline mode, we just have to use the <strong><em>embed-server</em></strong> command. This command runs an internal Wildly process and will interact directly with it.</p>

<script src="https://gist.github.com/gautric/546b92951b9e91195f84.js"></script>

<p>As you should know <a href="http://undertow.io/"><strong><em>Undertow</em></strong></a> is now the JBoss embedded HTTP Webserver, we gonna configure it to enable http2 after we’ve configured the new security realm.
You should get an output result like this</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">You are disconnected at the moment. Type <span class="s1">'connect'</span> to connect to the server or <span class="s1">'help'</span> <span class="k">for </span>the list of supported commands.
<span class="o">[</span>disconnected /] embed-server
<span class="o">[</span>standalone@embedded /] /core-service<span class="o">=</span>management/security-realm<span class="o">=</span>https:add<span class="o">()</span>
<span class="o">{</span><span class="s2">"outcome"</span> <span class="o">=&gt;</span> <span class="s2">"success"</span><span class="o">}</span>
<span class="o">[</span>standalone@embedded /] /core-service<span class="o">=</span>management/security-realm<span class="o">=</span>https/authentication<span class="o">=</span>truststore:add<span class="o">(</span>keystore-path<span class="o">=</span>server.truststore, keystore-password<span class="o">=</span>password, keystore-relative-to<span class="o">=</span>jboss.server.config.dir<span class="o">)</span>
<span class="o">{</span>
    <span class="s2">"outcome"</span> <span class="o">=&gt;</span> <span class="s2">"success"</span>,
    <span class="s2">"response-headers"</span> <span class="o">=&gt;</span> <span class="o">{</span>
        <span class="s2">"operation-requires-reload"</span> <span class="o">=&gt;</span> <span class="nb">true</span>,
        <span class="s2">"process-state"</span> <span class="o">=&gt;</span> <span class="s2">"reload-required"</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="o">[</span>standalone@embedded /] /core-service<span class="o">=</span>management/security-realm<span class="o">=</span>https/server-identity<span class="o">=</span>ssl:add<span class="o">(</span>keystore-path<span class="o">=</span>server.keystore, keystore-password<span class="o">=</span>password, keystore-relative-to<span class="o">=</span>jboss.server.config.dir<span class="o">)</span>
<span class="o">{</span>
    <span class="s2">"outcome"</span> <span class="o">=&gt;</span> <span class="s2">"success"</span>,
    <span class="s2">"response-headers"</span> <span class="o">=&gt;</span> <span class="o">{</span>
        <span class="s2">"operation-requires-reload"</span> <span class="o">=&gt;</span> <span class="nb">true</span>,
        <span class="s2">"process-state"</span> <span class="o">=&gt;</span> <span class="s2">"reload-required"</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="o">[</span>standalone@embedded /] /subsystem<span class="o">=</span>undertow/server<span class="o">=</span>default-server/https-listener<span class="o">=</span>https:add<span class="o">(</span>socket-binding<span class="o">=</span>https, security-realm<span class="o">=</span>https, enable-http2<span class="o">=</span><span class="nb">true</span><span class="o">)</span>
<span class="o">{</span>
    <span class="s2">"outcome"</span> <span class="o">=&gt;</span> <span class="s2">"success"</span>,
    <span class="s2">"response-headers"</span> <span class="o">=&gt;</span> <span class="o">{</span><span class="s2">"process-state"</span> <span class="o">=&gt;</span> <span class="s2">"reload-required"</span><span class="o">}</span>
<span class="o">}</span>
<span class="o">[</span>standalone@embedded /] reload <span class="nt">--admin-only</span><span class="o">=</span><span class="nb">false</span>
<span class="o">[</span>standalone@embedded /]</code></pre></figure>

<h2 id="startup-jboss">Startup JBoss</h2>

<p>After a full correct configuration, you can startup the JBoss instance as usual.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$JBOSS_HOME</span>/bin/standalone.sh</code></pre></figure>

<h2 id="check-it">Check it</h2>

<p>After a very quick JBoss startup (about 3s), you can check <a href="https://localhost:8443/"><strong><em>the welcome page</em></strong></a> with your favorite browser like Firefox .
I use to check HTTP/2 protocol, the network panel available inside Firefox.</p>

<p><img src="/img/wildfly9-http2-offline.png" style="max-width:75%;" /></p>

<h3 id="useful-links">Useful links</h3>

<ul>
  <li><a href="https://developer.jboss.org/wiki/OfflineCLIWork">Offline CLI</a></li>
  <li><a href="http://undertow.io/blog/2015/03/26/HTTP2-In-Wildfly.html">HTTP/2</a></li>
</ul>

  </article>

  <div class="post-social">
    
   <a href="https://twitter.com/share" class="twitter-share-button" data-via="gautric_io">Tweet</a>
   <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'greg-iopen';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


</div>


      </div>
    </main>

    <footer class="site-footer blog-footer">

  <div class="wrapper">

    <h2 class="footer-heading"><a href="#" title="Haut de la page / Head of page">Greg I/Open</a></h2>

    <div class="footer-col-wrapper">
      <p class="text">Architecte Open Source, Blog Pro / Page Perso de Greg Autric, Java, Web, Cloud, JBoss, Red Hat, OpenSource</p>

      &mdash; 
 <a href="https://twitter.com/gautric_io">
    <span class="icon  icon--twitter">
      <svg viewBox="0 0 16 16">
        <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
        c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
      </svg>
    </span>
  </a>

 &mdash; 
  <a href="https://github.com/gautric">
    <span class="icon  icon--github">
      <svg viewBox="0 0 16 16">
        <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
      </svg>
    </span>
  </a>

 &mdash;
    </div>


  </div>

  <div class="copyright">Copyright © Greg Autric 2015 - 2020</div>


</footer>


  </body>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60791597-1', 'auto');
    ga('send', 'pageview');

  </script>

</html>
