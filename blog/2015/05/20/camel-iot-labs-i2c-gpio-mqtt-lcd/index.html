<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Camel IoT Labs i2c gpio mqtt lcd | Greg. I/O</title>
<meta name="keywords" content="en, apache, camel, camellabs, raspberry pi, i2c, lcd, mqtt, IoT">
<meta name="description" content="One month ago, Henryk, Claus and I started the Camel Labs project. This project provides exciting new components for the IoT community based on Apache Camel technology. These components connect electronic devices (I2C, SPI, GPIO, Tinkerforge) and cloud services (PubNub, Cloudlet, MQTT) together. In this lab, we will demonstrate how to build an end-to-end IoT integration with I2C devices, an MQTT broker, and an I2C LCD display using just a few lines of code.">
<meta name="author" content="">
<link rel="canonical" href="https://gautric.github.io/blog/2015/05/20/camel-iot-labs-i2c-gpio-mqtt-lcd/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8f91d8a03d2d03df35a93d161da5378cfcf6b504ad2ef312c29e142e3806a327.css" integrity="sha256-j5HYoD0tA981qT0WHaU3jPz2tQStLvMSwp4ULjgGoyc=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://gautric.github.io/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://gautric.github.io/android-icon-36x36.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://gautric.github.io/android-icon-36x36.png">
<link rel="apple-touch-icon" href="https://gautric.github.io/apple-icon-180x180.png">
<link rel="mask-icon" href="https://gautric.github.io/apple-icon-180x180.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://gautric.github.io/blog/2015/05/20/camel-iot-labs-i2c-gpio-mqtt-lcd/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:url" content="https://gautric.github.io/blog/2015/05/20/camel-iot-labs-i2c-gpio-mqtt-lcd/">
  <meta property="og:site_name" content="Greg. I/O">
  <meta property="og:title" content="Camel IoT Labs i2c gpio mqtt lcd">
  <meta property="og:description" content="One month ago, Henryk, Claus and I started the Camel Labs project. This project provides exciting new components for the IoT community based on Apache Camel technology. These components connect electronic devices (I2C, SPI, GPIO, Tinkerforge) and cloud services (PubNub, Cloudlet, MQTT) together. In this lab, we will demonstrate how to build an end-to-end IoT integration with I2C devices, an MQTT broker, and an I2C LCD display using just a few lines of code.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2015-05-20T13:58:00+00:00">
    <meta property="article:modified_time" content="2015-05-20T13:58:00+00:00">
    <meta property="article:tag" content="En">
    <meta property="article:tag" content="Apache">
    <meta property="article:tag" content="Camel">
    <meta property="article:tag" content="Camellabs">
    <meta property="article:tag" content="Raspberry Pi">
    <meta property="article:tag" content="I2C">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Camel IoT Labs i2c gpio mqtt lcd">
<meta name="twitter:description" content="One month ago, Henryk, Claus and I started the Camel Labs project. This project provides exciting new components for the IoT community based on Apache Camel technology. These components connect electronic devices (I2C, SPI, GPIO, Tinkerforge) and cloud services (PubNub, Cloudlet, MQTT) together. In this lab, we will demonstrate how to build an end-to-end IoT integration with I2C devices, an MQTT broker, and an I2C LCD display using just a few lines of code.">
      <meta name="twitter:site" content="@gautric_io">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blog",
      "item": "https://gautric.github.io/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Camel IoT Labs i2c gpio mqtt lcd",
      "item": "https://gautric.github.io/blog/2015/05/20/camel-iot-labs-i2c-gpio-mqtt-lcd/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Camel IoT Labs i2c gpio mqtt lcd",
  "name": "Camel IoT Labs i2c gpio mqtt lcd",
  "description": "One month ago, Henryk, Claus and I started the Camel Labs project. This project provides exciting new components for the IoT community based on Apache Camel technology. These components connect electronic devices (I2C, SPI, GPIO, Tinkerforge) and cloud services (PubNub, Cloudlet, MQTT) together. In this lab, we will demonstrate how to build an end-to-end IoT integration with I2C devices, an MQTT broker, and an I2C LCD display using just a few lines of code.\n",
  "keywords": [
    "en", "apache", "camel", "camellabs", "raspberry pi", "i2c", "lcd", "mqtt", "IoT"
  ],
  "articleBody": "One month ago, Henryk, Claus and I started the Camel Labs project. This project provides exciting new components for the IoT community based on Apache Camel technology. These components connect electronic devices (I2C, SPI, GPIO, Tinkerforge) and cloud services (PubNub, Cloudlet, MQTT) together. In this lab, we will demonstrate how to build an end-to-end IoT integration with I2C devices, an MQTT broker, and an I2C LCD display using just a few lines of code.\nLab Overview: I2C sensor + GPIO LED + MQTT broker + I2C LCD over Raspberry Pi\nIn this lab, we will build two Camel routes:\nA route to poll accelerometer information every 2 seconds, blink an LED on each message, and send the message to an MQTT topic A route to receive messages from the MQTT topic, check the Z value to set a header with a specific color, and display the message via an I2C LCD device Prerequisites For this lab, you will need the following components:\nTwo Raspberry Pi boards (Buy one) Tested with: B model and B+ Should work with: A, A+, B+, 2B Both on the same VLAN Raspbian OS installed (Download) 1 LED 1 220 Ω (ohms) resistor Wires 1 breadboard 1 RGB LCD 16x2 Available here 1 Accelerometer LSM303 Available here 1 ActiveMQ default installation Installation \u0026 Configuration Setting Up Your Raspberry Pi Be careful with your device! Always shut down power before wiring. Double-check all connections before powering on to avoid damaging your device.\nYou need to configure the I2C module on your Raspberry Pi.\nWiring for Accelerometer and Raspberry Pi Warning\nI am using the LSM303 from Adafruit, but the wiring should be similar for other models.\nYou can also use Olivier LD’s wiring diagram as a reference.\nWiring for LCD and Raspberry Pi Warning\nWith the RGB LCD 16x2 from Adafruit, you just need to plug the LCD component directly into the Raspberry Pi.\nFor more information on LCD wiring\nYou can test your wiring with the wiringpi library.\nInstalling the Pi4J Library First, let’s install the Pi4J library.\nCurrently, version 1.0 is available directly for Raspberry Pi:\n$\u003e ssh ${PI_USER}@${PI_HOST} pi@rbpi\u003e curl -s get.pi4j.com | sudo bash Info\nYou should use Public/Private key authentication for faster connections to your Raspberry Pi.\nFor more information about installation, visit the Pi4J installation guide.\nCompiling the Raspberry Pi Component This component is still under development. Please feel free to test it and send your feedback. Some aspects may change at any time (such as the URI format).\nIt’s better to build the camel-raspberry component on your personal computer, as the Raspberry Pi is typically too slow for efficient compilation.\nCheckout the code:\n$\u003e git clone https://github.com/camel-labs/camel-labs.git Creating the Accelerometer Program You need to compile the Accelerometer part program Accel2MQTT in the iot/components/camel-pi4j/src/main/java/com/github/camellabs/component/pi4j directory:\nCreating the LCD Program You need to compile the LCD part program MQTT2LCD in the iot/components/camel-pi4j/src/main/java/com/github/camellabs/component/pi4j directory:\nCompilation Command Line $\u003e mvn package -Dmaven.test.skip=true -P CopyDependencyforLab Pushing Binaries to Raspberry Pi Devices Copy JAR and dependency files to your two Raspberry Pi devices:\n$\u003e ssh ${PI_USER}@${PI_HOST_ACCEL} 'mkdir -p /home/pi/camel' $\u003e scp iot/components/camel-pi4j/target/*.jar ${PI_USER}@${PI_HOST_ACCEL}:/home/pi/camel $\u003e ssh ${PI_USER}@${PI_HOST_LCD} 'mkdir -p /home/pi/camel' $\u003e scp iot/components/camel-pi4j/target/*.jar ${PI_USER}@${PI_HOST_LCD}:/home/pi/camel Installing the Camel Program on Your Raspberry Pi Copy the log4j.properties file to the ${PI_HOST}:/home/pi/camel directory:\n# # The logging properties used # log4j.rootLogger=INFO, out # uncomment the following line to turn on Camel debugging #log4j.logger.org.apache.camel=DEBUG log4j.logger.org.pi4j=ALL log4j.logger.com.github.camellabs.component.pi4j=ALL # CONSOLE appender not used by default log4j.appender.out=org.apache.log4j.ConsoleAppender log4j.appender.out.layout=org.apache.log4j.PatternLayout log4j.appender.out.layout.ConversionPattern=%d{ISO8601} [%30.30t] %-30.30c{1} %-5p %m%n #log4j.appender.out.layout.ConversionPattern=%d [%-15.15t] %-5p %-30.30c{1} - %m%n Starting the MQTT Broker via ActiveMQ Run the MQTT broker using the following commands:\n$mqtt.acme.com\u003e cd $ACTIVEMQ_HOME/bin $mqtt.acme.com\u003e ./activemq start INFO: Loading '/Users/XXXXXX/Application/activemq/apache-activemq-5.11.1/bin/env' INFO: Using java '/usr/bin/java' INFO: Starting - inspect logfiles specified in logging.properties and log4j.properties to get details INFO: pidfile created : '/Users/XXXXXX/Application/activemq/apache-activemq-5.11.1/data/activemq.pid' (pid '4958') Starting the Accelerometer and MQTT Sender Part The first part of this lab collects X, Y, Z values from the accelerometer via the I2C bus every 2 seconds, flashes an LED, and sends the X, Y, Z vector to an MQTT topic.\nCommand Line for Accelerometer Part $\u003e ssh ${PI_USER}@${PI_HOST_ACCEL} pi@rbpi\u003e cd camel pi@rbpi\u003e pi4j -r com.github.camellabs.component.pij4.Accel2MQTT Console Output from ${PI_HOST_ACCEL} pi@rbpi8 ~/camel $ pi4j -r com.github.camellabs.component.pi4j.Accel2MQTT + sudo java -classpath '.:classes:*:classes:/opt/pi4j/lib/*' com.github.camellabs.component.pi4j.Accel2MQTT 19:45:30,979 [ main] Accel2MQTT INFO main 19:45:33,185 [ main] DefaultCamelContext INFO Apache Camel 2.15.2 (CamelContext: camel-1) is starting 19:45:33,200 [ main] ManagedManagementStrategy INFO JMX is enabled 19:45:36,620 [ main] DefaultTypeConverter INFO Loaded 188 type converters 19:45:38,347 [ main] GPIOEndpoint DEBUG Endpoint[pi4j-gpio://12?action=BLINK\u0026mode=DIGITAL_OUTPUT\u0026state=LOW] 19:45:38,353 [ main] GPIOEndpoint DEBUG Pin Id \u003e 12 19:45:38,360 [ main] GPIOEndpoint TRACE Field 12 not found in class class com.pi4j.io.gpio.RaspiPin 19:45:40,048 [ main] DefaultCamelContext INFO AllowUseOriginalMessage is enabled. If access to the original message is not needed, then its recommended to turn this option off as it may improve performance. 19:45:40,050 [ main] DefaultCamelContext INFO StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at http://camel.apache.org/stream-caching.html 19:45:40,115 [ main] GPIOProducer DEBUG Starting producer: Producer[pi4j-gpio://12?action=BLINK\u0026mode=DIGITAL_OUTPUT\u0026state=LOW] 19:45:40,499 [ main] MQTTEndpoint INFO Connecting to tcp://mac-mini.autric.net:1883 using 10 seconds timeout 19:45:40,895 [ hawtdispatch-DEFAULT-1] MQTTEndpoint WARN No topic subscriptions were specified in configuration 19:45:40,909 [ hawtdispatch-DEFAULT-1] MQTTEndpoint INFO MQTT Connection connected to tcp://mac-mini.autric.net:1883 19:45:41,495 [ main] LSM303AccelerometerConsumer DEBUG Starting consumer: Consumer[pi4j-i2c://1/0x19?delay=500\u0026driver=lsm303-accel] 19:45:41,620 [ main] DefaultCamelContext INFO Route: route1 started and consuming from: Endpoint[pi4j-i2c://1/0x19?delay=500\u0026driver=lsm303-accel] 19:45:41,625 [ main] DefaultCamelContext INFO Total 1 routes, of which 1 is started. 19:45:41,651 [ main] DefaultCamelContext INFO Apache Camel 2.15.2 (CamelContext: camel-1) started in 8.478 seconds 19:45:42,624 [ thread #0 - pi4j-i2c://1/0x19] LSM303AccelerometerConsumer DEBUG [16,120,1069] 19:45:42,850 [ (camel-1) thread #1 - WireTap] GPIOProducer TRACE Exchange[Message: [16,120,1069]] 19:45:42,859 [ (camel-1) thread #1 - WireTap] GPIOProducer TRACE action= BLINK 19:45:42,930 [ thread #0 - pi4j-i2c://1/0x19] pi4j INFO Exchange[ , Id: ID-rbpi8-44586-1432064731732-0-2 , ExchangePattern: InOnly , Properties: {CamelCreatedTimestamp=Tue May 19 19:45:42 UTC 2015, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=wireTap1], DefaultMessageHistory[routeId=route1, node=to1]], CamelToEndpoint=log://com.github.camellabs.component.pi4j?multiline=true\u0026showAll=true} , Headers: {breadcrumbId=ID-rbpi8-44586-1432064731732-0-1} , BodyType: com.github.camellabs.component.pi4j.i2c.driver.LSM303Value , Body: [16,120,1069] , Out: null: ] 19:45:43,630 [ thread #0 - pi4j-i2c://1/0x19] LSM303AccelerometerConsumer DEBUG [14,120,1071] 19:45:43,641 [ (camel-1) thread #3 - WireTap] GPIOProducer TRACE Exchange[Message: [14,120,1071]] 19:45:43,643 [ (camel-1) thread #3 - WireTap] GPIOProducer TRACE action= BLINK 19:45:43,642 [ thread #0 - pi4j-i2c://1/0x19] pi4j INFO Exchange[ , Id: ID-rbpi8-44586-1432064731732-0-6 , ExchangePattern: InOnly , Properties: {CamelCreatedTimestamp=Tue May 19 19:45:43 UTC 2015, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=wireTap1], DefaultMessageHistory[routeId=route1, node=to1]], CamelToEndpoint=log://com.github.camellabs.component.pi4j?multiline=true\u0026showAll=true} , Headers: {breadcrumbId=ID-rbpi8-44586-1432064731732-0-5} , BodyType: com.github.camellabs.component.pi4j.i2c.driver.LSM303Value , Body: [14,120,1071] , Out: null: ] 19:45:44,220 [ thread #0 - pi4j-i2c://1/0x19] LSM303AccelerometerConsumer DEBUG [38,140,1069] 19:45:44,231 [ (camel-1) thread #5 - WireTap] GPIOProducer TRACE Exchange[Message: [38,140,1069]] 19:45:44,233 [ (camel-1) thread #5 - WireTap] GPIOProducer TRACE action= BLINK Starting the MQTT Reception and LCD Display Part The second part of this lab receives X, Y, Z vectors from the MQTT topic, checks the Z value (STABLE or ERROR zone), changes the color of the LCD display, and sends the message to the LCD.\nCommand Line for LCD Part $\u003e ssh ${PI_USER}@${PI_HOST_LCD} pi@rbpi\u003e cd camel pi@rbpi\u003e pi4j -r com.github.camellabs.component.pi4j.MQTT2LCD Console Output from ${PI_HOST_LCD} pi@rbpi2 ~/camel $ pi4j -r com.github.camellabs.component.pi4j.MQTT2LCD + sudo java -classpath '.:classes:*:classes:/opt/pi4j/lib/*' com.github.camellabs.component.pi4j.MQTT2LCD 19:45:33,277 [ main] MQTT2LCD INFO main 19:45:35,516 [ main] DefaultCamelContext INFO Apache Camel 2.15.2 (CamelContext: camel-1) is starting 19:45:35,530 [ main] ManagedManagementStrategy INFO JMX is enabled 19:45:38,969 [ main] DefaultTypeConverter INFO Loaded 188 type converters 19:45:41,902 [ main] DefaultCamelContext INFO AllowUseOriginalMessage is enabled. If access to the original message is not needed, then its recommended to turn this option off as it may improve performance. 19:45:41,903 [ main] DefaultCamelContext INFO StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at http://camel.apache.org/stream-caching.html 19:45:42,117 [ main] MCP23017LCD DEBUG doStart 19:45:43,007 [ main] MQTTEndpoint INFO Connecting to tcp://mac-mini.autric.net:1883 using 10 seconds timeout 19:45:44,655 [ hawtdispatch-DEFAULT-1] MQTTEndpoint INFO MQTT Connection connected to tcp://mac-mini.autric.net:1883 19:45:44,789 [ main] DefaultCamelContext INFO Route: route1 started and consuming from: Endpoint[mqtt://pi4j?subscribeTopicName=i2c/accel\u0026host=tcp://mac-mini.autric.net:1883] 19:45:44,792 [ main] DefaultCamelContext INFO Total 1 routes, of which 1 is started. 19:45:44,843 [ main] DefaultCamelContext INFO Apache Camel 2.15.2 (CamelContext: camel-1) started in 9.314 seconds 19:45:45,120 [ hawtdispatch-DEFAULT-1] pi4j INFO Exchange[ , Id: ID-rbpi2-56870-1432064734049-0-2 , ExchangePattern: InOnly , Properties: {CamelCreatedTimestamp=Tue May 19 19:45:44 UTC 2015, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=process1], DefaultMessageHistory[routeId=route1, node=to1]], CamelToEndpoint=log://com.github.camellabs.component.pi4j?multiline=true\u0026showAll=true} , Headers: {breadcrumbId=ID-rbpi2-56870-1432064734049-0-1, CamelLCDBlinkCursor=false, CamelLCDColor=GREEN, CamelLCDCursor=false, CamelMQTTSubscribeTopic=i2c/accel} , BodyType: String , Body: [12,147,1064] , Out: null: ] 19:45:45,128 [ hawtdispatch-DEFAULT-1] MCP23017LCD DEBUG \u003e\u003e Exchange[Message: [12,147,1064]] 19:45:45,403 [ hawtdispatch-DEFAULT-1] pi4j INFO Exchange[ , Id: ID-rbpi2-56870-1432064734049-0-4 , ExchangePattern: InOnly , Properties: {CamelCreatedTimestamp=Tue May 19 19:45:45 UTC 2015, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=process1], DefaultMessageHistory[routeId=route1, node=to1]], CamelToEndpoint=log://com.github.camellabs.component.pi4j?multiline=true\u0026showAll=true} , Headers: {breadcrumbId=ID-rbpi2-56870-1432064734049-0-3, CamelLCDBlinkCursor=false, CamelLCDColor=GREEN, CamelLCDCursor=false, CamelMQTTSubscribeTopic=i2c/accel} , BodyType: String , Body: [3,136,1066] , Out: null: ] 19:45:45,407 [ hawtdispatch-DEFAULT-1] MCP23017LCD DEBUG \u003e\u003e Exchange[Message: [3,136,1066]] 19:45:45,965 [ hawtdispatch-DEFAULT-1] pi4j INFO Exchange[ , Id: ID-rbpi2-56870-1432064734049-0-6 , ExchangePattern: InOnly , Properties: {CamelCreatedTimestamp=Tue May 19 19:45:45 UTC 2015, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=process1], DefaultMessageHistory[routeId=route1, node=to1]], CamelToEndpoint=log://com.github.camellabs.component.pi4j?multiline=true\u0026showAll=true} , Headers: {breadcrumbId=ID-rbpi2-56870-1432064734049-0-5, CamelLCDBlinkCursor=false, CamelLCDColor=GREEN, CamelLCDCursor=false, CamelMQTTSubscribeTopic=i2c/accel} , BodyType: String , Body: [-3,133,1069] , Out: null: ] 19:45:45,969 [ hawtdispatch-DEFAULT-1] MCP23017LCD DEBUG \u003e\u003e Exchange[Message: [-3,133,1069]] ..... OMIT ...... 19:45:57,841 [ hawtdispatch-DEFAULT-1] pi4j INFO Exchange[ , Id: ID-rbpi2-56870-1432064734049-0-44 , ExchangePattern: InOnly , Properties: {CamelCreatedTimestamp=Tue May 19 19:45:57 UTC 2015, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=process1], DefaultMessageHistory[routeId=route1, node=to1]], CamelToEndpoint=log://com.github.camellabs.component.pi4j?multiline=true\u0026showAll=true} , Headers: {breadcrumbId=ID-rbpi2-56870-1432064734049-0-43, CamelLCDBlinkCursor=false, CamelLCDColor=YELLOW, CamelLCDCursor=false, CamelMQTTSubscribeTopic=i2c/accel} , BodyType: String , Body: [-67,-411,993] , Out: null: ] 19:45:57,844 [ hawtdispatch-DEFAULT-1] MCP23017LCD DEBUG \u003e\u003e Exchange[Message: [-67,-411,993]] Final Result Video Et voilà! Here’s the final result:\nNote: I had to change the LCD color scheme due to my low-cost camera:\nGREEN is now ON YELLOW is still YELLOW RED is now OFF Conclusion As you can see, integrating Camel Labs with Raspberry Pi is remarkably straightforward. The BMP180 driver is available for temperature and pressure sensing, and the TSL2561 driver is available for light sensing. The Java Camel DSL simplifies the code for assembling and integrating IoT devices. You can easily switch from an MQTT broker to a SOAP web service with minimal refactoring.\nRaspberry Pi can integrate and assemble various electronic (I2C) devices and protocols (like MQTT) with Camel IoT Labs components using just a few lines of code.\nRaspberry Pi and Camel IoT Labs make a powerful combination for IoT development!\nMore Links More information about me My colleague’s blog: Henryk Konsek (IoT, MQTT, etc.) Thanks to Olivier for LSM303 resources Thanks to Marcus Hirt for the Java LCD driver Camel Labs on GitHub Pi4J library Raspberry Pi Apache Camel ",
  "wordCount" : "1698",
  "inLanguage": "en",
  "datePublished": "2015-05-20T13:58:00Z",
  "dateModified": "2015-05-20T13:58:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://gautric.github.io/blog/2015/05/20/camel-iot-labs-i2c-gpio-mqtt-lcd/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Greg. I/O",
    "logo": {
      "@type": "ImageObject",
      "url": "https://gautric.github.io/apple-icon-180x180.png"
    }
  }
}
</script>
</head>

<body class="" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://gautric.github.io/" accesskey="h" title="Greg. I/O (Alt + H)">
                <img src="https://gautric.github.io/apple-icon-180x180.png" alt="" aria-label="logo"
                    height="35">Greg. I/O</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://gautric.github.io/apropos/" title="À Propos">
                    <span>À Propos</span>
                </a>
            </li>
            <li>
                <a href="https://gautric.github.io/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://gautric.github.io/contact/" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://gautric.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://gautric.github.io/blog/">Blog</a></div>
    <h1 class="post-title entry-hint-parent">
      Camel IoT Labs i2c gpio mqtt lcd
    </h1>
    <div class="post-meta"><span title='2015-05-20 13:58:00 +0000 UTC'>May 20, 2015</span>

</div>
  </header> 
  <div class="post-content"><p>One month ago, Henryk, Claus and I started the Camel Labs project. This project provides exciting new components for the IoT community based on Apache Camel technology. These components connect electronic devices (I2C, SPI, GPIO, Tinkerforge) and cloud services (PubNub, Cloudlet, MQTT) together. In this lab, we will demonstrate how to build an end-to-end IoT integration with I2C devices, an MQTT broker, and an I2C LCD display using just a few lines of code.</p>
<blockquote>
<p><strong>Lab Overview</strong>: I2C sensor + GPIO LED + MQTT broker + I2C LCD over Raspberry Pi</p></blockquote>
<p><img alt="end-to-end" loading="lazy" src="/img/end-to-end.png"></p>
<p>In this lab, we will build two Camel routes:</p>
<ol>
<li>A route to poll accelerometer information every 2 seconds, blink an LED on each message, and send the message to an MQTT topic</li>
<li>A route to receive messages from the MQTT topic, check the Z value to set a header with a specific color, and display the message via an I2C LCD device</li>
</ol>
<h2 id="prerequisites">Prerequisites<a hidden class="anchor" aria-hidden="true" href="#prerequisites">#</a></h2>
<p>For this lab, you will need the following components:</p>
<ul>
<li>Two Raspberry Pi boards (<a href="http://www.raspberrypi.org/products/">Buy one</a>)
<ul>
<li>Tested with: B model and B+</li>
<li>Should work with: A, A+, B+, 2B</li>
<li>Both on the same VLAN</li>
</ul>
</li>
<li>Raspbian OS installed (<a href="http://www.raspberrypi.org/downloads/">Download</a>)</li>
<li>1 LED</li>
<li>1 220 Ω (ohms) resistor</li>
<li>Wires</li>
<li>1 breadboard</li>
<li>1 RGB LCD 16x2 <a href="https://www.adafruit.com/products/716">Available here</a></li>
<li>1 Accelerometer LSM303 <a href="https://www.adafruit.com/products/1120">Available here</a></li>
<li>1 ActiveMQ default installation <a href="http://activemq.apache.org/getting-started.html">Installation &amp; Configuration</a></li>
</ul>
<h2 id="setting-up-your-raspberry-pi">Setting Up Your Raspberry Pi<a hidden class="anchor" aria-hidden="true" href="#setting-up-your-raspberry-pi">#</a></h2>
<div><svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg"><symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></symbol></svg></div><div class="notice error" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#error-notice"></use></svg></span></p><p>Be careful with your device! Always shut down power before wiring. Double-check all connections before powering on to avoid damaging your device.</p></div>

<p>You need to configure the <a href="https://learn.adafruit.com/adafruits-raspberry-pi-lesson-4-gpio-setup/configuring-i2c">I2C module</a> on your Raspberry Pi.</p>
<h3 id="wiring-for-accelerometer-and-raspberry-pi">Wiring for Accelerometer and Raspberry Pi<a hidden class="anchor" aria-hidden="true" href="#wiring-for-accelerometer-and-raspberry-pi">#</a></h3>
<div class="notice warning" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#warning-notice"></use></svg></span>Warning</p><p>I am using the LSM303 from Adafruit, but the wiring should be similar for other models.</p></div>

<p>You can also use Olivier LD&rsquo;s <a href="http://www.lediouris.net/RaspberryPI/LSM303/img/wiring.png">wiring diagram</a> as a reference.</p>
<p><img alt="Wire LSM303" loading="lazy" src="/img/LSM303_RPi.png"></p>
<h3 id="wiring-for-lcd-and-raspberry-pi">Wiring for LCD and Raspberry Pi<a hidden class="anchor" aria-hidden="true" href="#wiring-for-lcd-and-raspberry-pi">#</a></h3>
<div class="notice warning" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#warning-notice"></use></svg></span>Warning</p><p>With the RGB LCD 16x2 from Adafruit, you just need to plug the LCD component directly into the Raspberry Pi.</p></div>

<p><a href="https://learn.adafruit.com/adafruit-16x2-character-lcd-plus-keypad-for-raspberry-pi/overview">For more information on LCD wiring</a></p>
<p><img alt="Wire LCD" loading="lazy" src="/img/LCD_RPi.png"></p>
<p>You can test your wiring with the <a href="http://wiringpi.com">wiringpi</a> library.</p>
<h2 id="installing-the-pi4j-library">Installing the Pi4J Library<a hidden class="anchor" aria-hidden="true" href="#installing-the-pi4j-library">#</a></h2>
<p>First, let&rsquo;s install the Pi4J library.</p>
<p>Currently, version 1.0 is available directly for Raspberry Pi:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$&gt; ssh <span class="si">${</span><span class="nv">PI_USER</span><span class="si">}</span>@<span class="si">${</span><span class="nv">PI_HOST</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">pi@rbpi&gt; curl -s get.pi4j.com <span class="p">|</span> sudo bash
</span></span></code></pre></div><div class="notice info" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#info-notice"></use></svg></span>Info</p><p>You should use Public/Private key authentication for faster connections to your Raspberry Pi.</p></div>

<p>For more information about installation, visit the <a href="http://pi4j.com/install.html#Installation">Pi4J installation guide</a>.</p>
<h2 id="compiling-the-raspberry-pi-component">Compiling the Raspberry Pi Component<a hidden class="anchor" aria-hidden="true" href="#compiling-the-raspberry-pi-component">#</a></h2>
<div class="notice error" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#error-notice"></use></svg></span></p><p>This component is still under development. Please feel free to test it and send your feedback.
Some aspects may change at any time (such as the URI format).</p></div>

<p>It&rsquo;s better to build the camel-raspberry component on your personal computer, as the Raspberry Pi is typically too slow for efficient compilation.</p>
<p>Checkout the code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$&gt; git clone https://github.com/camel-labs/camel-labs.git
</span></span></code></pre></div><h3 id="creating-the-accelerometer-program">Creating the Accelerometer Program<a hidden class="anchor" aria-hidden="true" href="#creating-the-accelerometer-program">#</a></h3>
<p>You need to compile the Accelerometer part program <strong>Accel2MQTT</strong> in the <em>iot/components/camel-pi4j/src/main/java/com/github/camellabs/component/pi4j</em> directory:</p>
<script src="https://gist.github.com/gautric/edba044d912d53e4bf31.js"></script>
<h3 id="creating-the-lcd-program">Creating the LCD Program<a hidden class="anchor" aria-hidden="true" href="#creating-the-lcd-program">#</a></h3>
<p>You need to compile the LCD part program <strong>MQTT2LCD</strong> in the <em>iot/components/camel-pi4j/src/main/java/com/github/camellabs/component/pi4j</em> directory:</p>
<script src="https://gist.github.com/gautric/e8eef9489d62288dedb9.js"></script>
<h3 id="compilation-command-line">Compilation Command Line<a hidden class="anchor" aria-hidden="true" href="#compilation-command-line">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$&gt; mvn package -Dmaven.test.skip<span class="o">=</span><span class="nb">true</span> -P CopyDependencyforLab
</span></span></code></pre></div><h3 id="pushing-binaries-to-raspberry-pi-devices">Pushing Binaries to Raspberry Pi Devices<a hidden class="anchor" aria-hidden="true" href="#pushing-binaries-to-raspberry-pi-devices">#</a></h3>
<p>Copy JAR and dependency files to your two Raspberry Pi devices:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$&gt; ssh <span class="si">${</span><span class="nv">PI_USER</span><span class="si">}</span>@<span class="si">${</span><span class="nv">PI_HOST_ACCEL</span><span class="si">}</span> <span class="s1">&#39;mkdir -p /home/pi/camel&#39;</span>
</span></span><span class="line"><span class="cl">$&gt; scp iot/components/camel-pi4j/target/*.jar <span class="si">${</span><span class="nv">PI_USER</span><span class="si">}</span>@<span class="si">${</span><span class="nv">PI_HOST_ACCEL</span><span class="si">}</span>:/home/pi/camel
</span></span><span class="line"><span class="cl">$&gt; ssh <span class="si">${</span><span class="nv">PI_USER</span><span class="si">}</span>@<span class="si">${</span><span class="nv">PI_HOST_LCD</span><span class="si">}</span> <span class="s1">&#39;mkdir -p /home/pi/camel&#39;</span>
</span></span><span class="line"><span class="cl">$&gt; scp iot/components/camel-pi4j/target/*.jar <span class="si">${</span><span class="nv">PI_USER</span><span class="si">}</span>@<span class="si">${</span><span class="nv">PI_HOST_LCD</span><span class="si">}</span>:/home/pi/camel
</span></span></code></pre></div><h3 id="installing-the-camel-program-on-your-raspberry-pi">Installing the Camel Program on Your Raspberry Pi<a hidden class="anchor" aria-hidden="true" href="#installing-the-camel-program-on-your-raspberry-pi">#</a></h3>
<p>Copy the <strong>log4j.properties</strong> file to the <strong>${PI_HOST}:/home/pi/camel</strong> directory:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># The logging properties used</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="na">log4j.rootLogger</span><span class="o">=</span><span class="s">INFO, out</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># uncomment the following line to turn on Camel debugging</span>
</span></span><span class="line"><span class="cl"><span class="c1">#log4j.logger.org.apache.camel=DEBUG</span>
</span></span><span class="line"><span class="cl"><span class="na">log4j.logger.org.pi4j</span><span class="o">=</span><span class="s">ALL</span>
</span></span><span class="line"><span class="cl"><span class="na">log4j.logger.com.github.camellabs.component.pi4j</span><span class="o">=</span><span class="s">ALL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># CONSOLE appender not used by default</span>
</span></span><span class="line"><span class="cl"><span class="na">log4j.appender.out</span><span class="o">=</span><span class="s">org.apache.log4j.ConsoleAppender</span>
</span></span><span class="line"><span class="cl"><span class="na">log4j.appender.out.layout</span><span class="o">=</span><span class="s">org.apache.log4j.PatternLayout</span>
</span></span><span class="line"><span class="cl"><span class="na">log4j.appender.out.layout.ConversionPattern</span><span class="o">=</span><span class="s">%d{ISO8601} [%30.30t] %-30.30c{1} %-5p %m%n</span>
</span></span><span class="line"><span class="cl"><span class="c1">#log4j.appender.out.layout.ConversionPattern=%d [%-15.15t] %-5p %-30.30c{1} - %m%n</span>
</span></span></code></pre></div><h3 id="starting-the-mqtt-broker-via-activemq">Starting the MQTT Broker via ActiveMQ<a hidden class="anchor" aria-hidden="true" href="#starting-the-mqtt-broker-via-activemq">#</a></h3>
<p>Run the MQTT broker using the following commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">$mqtt</span>.acme.com&gt; <span class="nb">cd</span> <span class="nv">$ACTIVEMQ_HOME</span>/bin
</span></span><span class="line"><span class="cl"><span class="nv">$mqtt</span>.acme.com&gt; ./activemq start
</span></span><span class="line"><span class="cl">INFO: Loading <span class="s1">&#39;/Users/XXXXXX/Application/activemq/apache-activemq-5.11.1/bin/env&#39;</span>
</span></span><span class="line"><span class="cl">INFO: Using java <span class="s1">&#39;/usr/bin/java&#39;</span>
</span></span><span class="line"><span class="cl">INFO: Starting - inspect logfiles specified in logging.properties and log4j.properties to get details
</span></span><span class="line"><span class="cl">INFO: pidfile created : <span class="s1">&#39;/Users/XXXXXX/Application/activemq/apache-activemq-5.11.1/data/activemq.pid&#39;</span> <span class="o">(</span>pid <span class="s1">&#39;4958&#39;</span><span class="o">)</span>
</span></span></code></pre></div><h2 id="starting-the-accelerometer-and-mqtt-sender-part">Starting the Accelerometer and MQTT Sender Part<a hidden class="anchor" aria-hidden="true" href="#starting-the-accelerometer-and-mqtt-sender-part">#</a></h2>
<p>The first part of this lab collects <a href="https://gist.github.com/gautric/edba044d912d53e4bf31#file-accel2mqtt-java-L27">X, Y, Z values from the accelerometer via the I2C bus every 2 seconds</a>, <a href="https://gist.github.com/gautric/edba044d912d53e4bf31#file-accel2mqtt-java-L28">flashes an LED</a>, and <a href="https://gist.github.com/gautric/edba044d912d53e4bf31#file-accel2mqtt-java-L30">sends the X, Y, Z vector to an MQTT topic</a>.</p>
<img src="/img/LSM303_RPi_design.png" />
<h3 id="command-line-for-accelerometer-part">Command Line for Accelerometer Part<a hidden class="anchor" aria-hidden="true" href="#command-line-for-accelerometer-part">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$&gt; ssh <span class="si">${</span><span class="nv">PI_USER</span><span class="si">}</span>@<span class="si">${</span><span class="nv">PI_HOST_ACCEL</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">pi@rbpi&gt; <span class="nb">cd</span> camel
</span></span><span class="line"><span class="cl">pi@rbpi&gt; pi4j -r com.github.camellabs.component.pij4.Accel2MQTT
</span></span></code></pre></div><h3 id="console-output-from-pi_host_accel">Console Output from ${PI_HOST_ACCEL}<a hidden class="anchor" aria-hidden="true" href="#console-output-from-pi_host_accel">#</a></h3>
<pre tabindex="0"><code>pi@rbpi8 ~/camel $ pi4j -r com.github.camellabs.component.pi4j.Accel2MQTT
+ sudo java -classpath &#39;.:classes:*:classes:/opt/pi4j/lib/*&#39; com.github.camellabs.component.pi4j.Accel2MQTT
19:45:30,979 [                          main] Accel2MQTT                     INFO  main
19:45:33,185 [                          main] DefaultCamelContext            INFO  Apache Camel 2.15.2 (CamelContext: camel-1) is starting
19:45:33,200 [                          main] ManagedManagementStrategy      INFO  JMX is enabled
19:45:36,620 [                          main] DefaultTypeConverter           INFO  Loaded 188 type converters
19:45:38,347 [                          main] GPIOEndpoint                   DEBUG Endpoint[pi4j-gpio://12?action=BLINK&amp;mode=DIGITAL_OUTPUT&amp;state=LOW]
19:45:38,353 [                          main] GPIOEndpoint                   DEBUG  Pin Id &gt; 12
19:45:38,360 [                          main] GPIOEndpoint                   TRACE  Field 12 not found in class class com.pi4j.io.gpio.RaspiPin
19:45:40,048 [                          main] DefaultCamelContext            INFO  AllowUseOriginalMessage is enabled. If access to the original message is not needed, then its recommended to turn this option off as it may improve performance.
19:45:40,050 [                          main] DefaultCamelContext            INFO  StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at http://camel.apache.org/stream-caching.html
19:45:40,115 [                          main] GPIOProducer                   DEBUG Starting producer: Producer[pi4j-gpio://12?action=BLINK&amp;mode=DIGITAL_OUTPUT&amp;state=LOW]
19:45:40,499 [                          main] MQTTEndpoint                   INFO  Connecting to tcp://mac-mini.autric.net:1883 using 10 seconds timeout
19:45:40,895 [        hawtdispatch-DEFAULT-1] MQTTEndpoint                   WARN  No topic subscriptions were specified in configuration
19:45:40,909 [        hawtdispatch-DEFAULT-1] MQTTEndpoint                   INFO  MQTT Connection connected to tcp://mac-mini.autric.net:1883
19:45:41,495 [                          main] LSM303AccelerometerConsumer    DEBUG Starting consumer: Consumer[pi4j-i2c://1/0x19?delay=500&amp;driver=lsm303-accel]
19:45:41,620 [                          main] DefaultCamelContext            INFO  Route: route1 started and consuming from: Endpoint[pi4j-i2c://1/0x19?delay=500&amp;driver=lsm303-accel]
19:45:41,625 [                          main] DefaultCamelContext            INFO  Total 1 routes, of which 1 is started.
19:45:41,651 [                          main] DefaultCamelContext            INFO  Apache Camel 2.15.2 (CamelContext: camel-1) started in 8.478 seconds
19:45:42,624 [ thread #0 - pi4j-i2c://1/0x19] LSM303AccelerometerConsumer    DEBUG [16,120,1069]
19:45:42,850 [ (camel-1) thread #1 - WireTap] GPIOProducer                   TRACE Exchange[Message: [16,120,1069]]
19:45:42,859 [ (camel-1) thread #1 - WireTap] GPIOProducer                   TRACE action= BLINK
19:45:42,930 [ thread #0 - pi4j-i2c://1/0x19] pi4j                           INFO  Exchange[
, Id: ID-rbpi8-44586-1432064731732-0-2
, ExchangePattern: InOnly
, Properties: {CamelCreatedTimestamp=Tue May 19 19:45:42 UTC 2015, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=wireTap1], DefaultMessageHistory[routeId=route1, node=to1]], CamelToEndpoint=log://com.github.camellabs.component.pi4j?multiline=true&amp;showAll=true}
, Headers: {breadcrumbId=ID-rbpi8-44586-1432064731732-0-1}
, BodyType: com.github.camellabs.component.pi4j.i2c.driver.LSM303Value
, Body: [16,120,1069]
, Out: null:
]
19:45:43,630 [ thread #0 - pi4j-i2c://1/0x19] LSM303AccelerometerConsumer    DEBUG [14,120,1071]
19:45:43,641 [ (camel-1) thread #3 - WireTap] GPIOProducer                   TRACE Exchange[Message: [14,120,1071]]
19:45:43,643 [ (camel-1) thread #3 - WireTap] GPIOProducer                   TRACE action= BLINK
19:45:43,642 [ thread #0 - pi4j-i2c://1/0x19] pi4j                           INFO  Exchange[
, Id: ID-rbpi8-44586-1432064731732-0-6
, ExchangePattern: InOnly
, Properties: {CamelCreatedTimestamp=Tue May 19 19:45:43 UTC 2015, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=wireTap1], DefaultMessageHistory[routeId=route1, node=to1]], CamelToEndpoint=log://com.github.camellabs.component.pi4j?multiline=true&amp;showAll=true}
, Headers: {breadcrumbId=ID-rbpi8-44586-1432064731732-0-5}
, BodyType: com.github.camellabs.component.pi4j.i2c.driver.LSM303Value
, Body: [14,120,1071]
, Out: null:
]
19:45:44,220 [ thread #0 - pi4j-i2c://1/0x19] LSM303AccelerometerConsumer    DEBUG [38,140,1069]
19:45:44,231 [ (camel-1) thread #5 - WireTap] GPIOProducer                   TRACE Exchange[Message: [38,140,1069]]
19:45:44,233 [ (camel-1) thread #5 - WireTap] GPIOProducer                   TRACE action= BLINK
</code></pre><h2 id="starting-the-mqtt-reception-and-lcd-display-part">Starting the MQTT Reception and LCD Display Part<a hidden class="anchor" aria-hidden="true" href="#starting-the-mqtt-reception-and-lcd-display-part">#</a></h2>
<p>The second part of this lab <a href="https://gist.github.com/gautric/e8eef9489d62288dedb9#file-mqtt2lcd-java-L34">receives X, Y, Z vectors from the MQTT topic</a>, <a href="https://gist.github.com/gautric/e8eef9489d62288dedb9#file-mqtt2lcd-java-L41">checks the Z value</a> (STABLE or ERROR zone), changes the color of the LCD display, and <a href="https://gist.github.com/gautric/e8eef9489d62288dedb9#file-mqtt2lcd-java-L60">sends the message to the LCD</a>.</p>
<img src="/img/LCD_RPi_design.png" />
<h3 id="command-line-for-lcd-part">Command Line for LCD Part<a hidden class="anchor" aria-hidden="true" href="#command-line-for-lcd-part">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$&gt; ssh <span class="si">${</span><span class="nv">PI_USER</span><span class="si">}</span>@<span class="si">${</span><span class="nv">PI_HOST_LCD</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">pi@rbpi&gt; <span class="nb">cd</span> camel
</span></span><span class="line"><span class="cl">pi@rbpi&gt; pi4j -r com.github.camellabs.component.pi4j.MQTT2LCD
</span></span></code></pre></div><h3 id="console-output-from-pi_host_lcd">Console Output from ${PI_HOST_LCD}<a hidden class="anchor" aria-hidden="true" href="#console-output-from-pi_host_lcd">#</a></h3>
<pre tabindex="0"><code>pi@rbpi2 ~/camel $ pi4j -r com.github.camellabs.component.pi4j.MQTT2LCD
+ sudo java -classpath &#39;.:classes:*:classes:/opt/pi4j/lib/*&#39; com.github.camellabs.component.pi4j.MQTT2LCD
19:45:33,277 [                          main] MQTT2LCD                       INFO  main
19:45:35,516 [                          main] DefaultCamelContext            INFO  Apache Camel 2.15.2 (CamelContext: camel-1) is starting
19:45:35,530 [                          main] ManagedManagementStrategy      INFO  JMX is enabled
19:45:38,969 [                          main] DefaultTypeConverter           INFO  Loaded 188 type converters
19:45:41,902 [                          main] DefaultCamelContext            INFO  AllowUseOriginalMessage is enabled. If access to the original message is not needed, then its recommended to turn this option off as it may improve performance.
19:45:41,903 [                          main] DefaultCamelContext            INFO  StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at http://camel.apache.org/stream-caching.html
19:45:42,117 [                          main] MCP23017LCD                    DEBUG doStart
19:45:43,007 [                          main] MQTTEndpoint                   INFO  Connecting to tcp://mac-mini.autric.net:1883 using 10 seconds timeout
19:45:44,655 [        hawtdispatch-DEFAULT-1] MQTTEndpoint                   INFO  MQTT Connection connected to tcp://mac-mini.autric.net:1883
19:45:44,789 [                          main] DefaultCamelContext            INFO  Route: route1 started and consuming from: Endpoint[mqtt://pi4j?subscribeTopicName=i2c/accel&amp;host=tcp://mac-mini.autric.net:1883]
19:45:44,792 [                          main] DefaultCamelContext            INFO  Total 1 routes, of which 1 is started.
19:45:44,843 [                          main] DefaultCamelContext            INFO  Apache Camel 2.15.2 (CamelContext: camel-1) started in 9.314 seconds
19:45:45,120 [        hawtdispatch-DEFAULT-1] pi4j                           INFO  Exchange[
, Id: ID-rbpi2-56870-1432064734049-0-2
, ExchangePattern: InOnly
, Properties: {CamelCreatedTimestamp=Tue May 19 19:45:44 UTC 2015, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=process1], DefaultMessageHistory[routeId=route1, node=to1]], CamelToEndpoint=log://com.github.camellabs.component.pi4j?multiline=true&amp;showAll=true}
, Headers: {breadcrumbId=ID-rbpi2-56870-1432064734049-0-1, CamelLCDBlinkCursor=false, CamelLCDColor=GREEN, CamelLCDCursor=false, CamelMQTTSubscribeTopic=i2c/accel}
, BodyType: String
, Body: [12,147,1064]
, Out: null:
]
19:45:45,128 [        hawtdispatch-DEFAULT-1] MCP23017LCD                    DEBUG &gt;&gt; Exchange[Message: [12,147,1064]]
19:45:45,403 [        hawtdispatch-DEFAULT-1] pi4j                           INFO  Exchange[
, Id: ID-rbpi2-56870-1432064734049-0-4
, ExchangePattern: InOnly
, Properties: {CamelCreatedTimestamp=Tue May 19 19:45:45 UTC 2015, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=process1], DefaultMessageHistory[routeId=route1, node=to1]], CamelToEndpoint=log://com.github.camellabs.component.pi4j?multiline=true&amp;showAll=true}
, Headers: {breadcrumbId=ID-rbpi2-56870-1432064734049-0-3, CamelLCDBlinkCursor=false, CamelLCDColor=GREEN, CamelLCDCursor=false, CamelMQTTSubscribeTopic=i2c/accel}
, BodyType: String
, Body: [3,136,1066]
, Out: null:
]
19:45:45,407 [        hawtdispatch-DEFAULT-1] MCP23017LCD                    DEBUG &gt;&gt; Exchange[Message: [3,136,1066]]
19:45:45,965 [        hawtdispatch-DEFAULT-1] pi4j                           INFO  Exchange[
, Id: ID-rbpi2-56870-1432064734049-0-6
, ExchangePattern: InOnly
, Properties: {CamelCreatedTimestamp=Tue May 19 19:45:45 UTC 2015, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=process1], DefaultMessageHistory[routeId=route1, node=to1]], CamelToEndpoint=log://com.github.camellabs.component.pi4j?multiline=true&amp;showAll=true}
, Headers: {breadcrumbId=ID-rbpi2-56870-1432064734049-0-5, CamelLCDBlinkCursor=false, CamelLCDColor=GREEN, CamelLCDCursor=false, CamelMQTTSubscribeTopic=i2c/accel}
, BodyType: String
, Body: [-3,133,1069]
, Out: null:
]
19:45:45,969 [        hawtdispatch-DEFAULT-1] MCP23017LCD                    DEBUG &gt;&gt; Exchange[Message: [-3,133,1069]]

..... OMIT ......

19:45:57,841 [        hawtdispatch-DEFAULT-1] pi4j                           INFO  Exchange[
, Id: ID-rbpi2-56870-1432064734049-0-44
, ExchangePattern: InOnly
, Properties: {CamelCreatedTimestamp=Tue May 19 19:45:57 UTC 2015, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=process1], DefaultMessageHistory[routeId=route1, node=to1]], CamelToEndpoint=log://com.github.camellabs.component.pi4j?multiline=true&amp;showAll=true}
, Headers: {breadcrumbId=ID-rbpi2-56870-1432064734049-0-43, CamelLCDBlinkCursor=false, CamelLCDColor=YELLOW, CamelLCDCursor=false, CamelMQTTSubscribeTopic=i2c/accel}
, BodyType: String
, Body: [-67,-411,993]
, Out: null:
]
19:45:57,844 [        hawtdispatch-DEFAULT-1] MCP23017LCD                    DEBUG &gt;&gt; Exchange[Message: [-67,-411,993]]
</code></pre><h2 id="final-result-video">Final Result Video<a hidden class="anchor" aria-hidden="true" href="#final-result-video">#</a></h2>
<p>Et voilà! Here&rsquo;s the final result:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/bT-9DUi0SPo" frameborder="0" ></iframe>
<p><strong>Note</strong>: I had to change the LCD color scheme due to my low-cost camera:</p>
<ul>
<li>GREEN is now ON</li>
<li>YELLOW is still YELLOW</li>
<li>RED is now OFF</li>
</ul>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>As you can see, integrating Camel Labs with Raspberry Pi is remarkably straightforward. The BMP180 driver is available for temperature and pressure sensing, and the TSL2561 driver is available for light sensing. The Java Camel DSL simplifies the code for assembling and integrating IoT devices. You can easily switch from an MQTT broker to a SOAP web service with minimal refactoring.</p>
<p>Raspberry Pi can integrate and assemble various electronic (I2C) devices and protocols (like MQTT) with <a href="https://github.com/camel-labs/camel-labs/tree/master/iot/components">Camel IoT Labs components</a> using just a few lines of code.</p>
<p><em><a href="http://raspberrypi.org">Raspberry Pi</a> and <a href="https://github.com/camel-labs/camel-labs">Camel IoT Labs</a> make a powerful combination for IoT development!</em></p>
<h2 id="more-links">More Links<a hidden class="anchor" aria-hidden="true" href="#more-links">#</a></h2>
<ul>
<li>More information <a href="/apropos/">about me</a></li>
<li>My colleague&rsquo;s blog: <a href="http://henryk-konsek.blogspot.fr/">Henryk Konsek</a> (IoT, MQTT, etc.)</li>
<li>Thanks to <a href="http://www.lediouris.net/RaspberryPI/LSM303/readme.html">Olivier for LSM303 resources</a></li>
<li>Thanks to <a href="http://hirt.se/blog/?p=464">Marcus Hirt for the Java LCD driver</a></li>
<li><a href="https://github.com/camel-labs/camel-labs">Camel Labs on GitHub</a></li>
<li><a href="http://pi4j.com">Pi4J library</a></li>
<li><a href="http://raspberrypi.org">Raspberry Pi</a></li>
<li><a href="http://camel.apache.org">Apache Camel</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://gautric.github.io/tags/en/">En</a></li>
      <li><a href="https://gautric.github.io/tags/apache/">Apache</a></li>
      <li><a href="https://gautric.github.io/tags/camel/">Camel</a></li>
      <li><a href="https://gautric.github.io/tags/camellabs/">Camellabs</a></li>
      <li><a href="https://gautric.github.io/tags/raspberry-pi/">Raspberry Pi</a></li>
      <li><a href="https://gautric.github.io/tags/i2c/">I2C</a></li>
      <li><a href="https://gautric.github.io/tags/lcd/">Lcd</a></li>
      <li><a href="https://gautric.github.io/tags/mqtt/">MQTT</a></li>
      <li><a href="https://gautric.github.io/tags/iot/">IoT</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://gautric.github.io/blog/2015/06/18/java-regex-group-name/">
    <span class="title">« Prev</span>
    <br>
    <span>Java Regex Group Name</span>
  </a>
  <a class="next" href="https://gautric.github.io/blog/2015/05/04/sortie-de-wildfly-9.0-cr-01/">
    <span class="title">Next »</span>
    <br>
    <span>Sortie de wildfly 9.0 CR-01</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2016 - 2025 <a href="https://gautric.github.io/">Greg. I/O</a></span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
</body>

</html>
