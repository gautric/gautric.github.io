<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcast Thomas et Marie</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .podcast-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .episode-info {
            margin-bottom: 20px;
        }
        .player-container {
            margin: 20px 0;
        }
        audio {
            width: 100%;
        }
        .playlist {
            margin-top: 30px;
        }
        .playlist-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .playlist-item:hover {
            background-color: #f0f0f0;
        }
        .playlist-item.active {
            background-color: #e3f2fd;
        }
        .speaker {
            font-weight: bold;
            width: 80px;
        }
        .thomas {
            color: #2980b9;
        }
        .marie {
            color: #e74c3c;
        }
        .controls {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #2980b9;
        }
        .play-all {
            background-color: #27ae60;
        }
        .play-all:hover {
            background-color: #219653;
        }
        .podcast-selector {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        .podcast-selector a {
            display: inline-block;
            padding: 10px 15px;
            margin: 0 10px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
        }
        .podcast-selector a:hover {
            background-color: #2980b9;
        }
        .podcast-selector a.active {
            background-color: #27ae60;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="podcast-selector" id="podcast-selector">
        <!-- Podcast links will be generated by JavaScript -->
    </div>

    <div id="loading" class="loading">Chargement du podcast...</div>
    
    <div id="podcast-container" class="podcast-container" style="display: none;">
        <h1 id="podcast-title"></h1>
        <div class="podcast-image" style="text-align: center; margin: 20px 0;">
            <img id="podcast-image" src="" alt="Image du podcast" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
        </div>
        <div class="episode-info">
            <h2>Podcast de Thomas et Marie</h2>
            <p id="podcast-description"></p>
        </div>
        
        <div class="player-container">
            <audio id="audio-player" controls></audio>
        </div>
        
        <div class="controls">
            <button id="prev-btn">Précédent</button>
            <button id="play-all-btn" class="play-all">Tout Jouer</button>
            <button id="next-btn">Suivant</button>
        </div>
        
        <div class="playlist" id="playlist">
            <!-- Playlist items will be generated by JavaScript -->
        </div>
    </div>

    <script>
        // Get podcast parameter from URL
        const urlParams = new URLSearchParams(window.location.search);
        const podcastParam = urlParams.get('podcast') || 'pluton'; // Default to pluton if no parameter
        
        // Load podcasts list
        async function loadPodcastsList() {
            try {
                const response = await fetch('podcasts.json');
                if (!response.ok) {
                    throw new Error('Failed to load podcasts list');
                }
                const data = await response.json();
                
                // Generate podcast selector links
                const podcastSelector = document.getElementById('podcast-selector');
                podcastSelector.innerHTML = '';
                
                data.podcasts.forEach(podcast => {
                    const link = document.createElement('a');
                    link.href = `?podcast=${podcast.id}`;
                    link.id = `${podcast.id}-link`;
                    link.textContent = podcast.title;
                    
                    // Add active class if this is the current podcast
                    if (podcast.id === podcastParam) {
                        link.classList.add('active');
                    }
                    
                    podcastSelector.appendChild(link);
                });
            } catch (error) {
                console.error('Error loading podcasts list:', error);
            }
        }
        
        // Load podcast data
        async function loadPodcast() {
            try {
                const response = await fetch(podcastParam + '.json');
                if (!response.ok) {
                    throw new Error('Failed to load podcast data');
                }
                const podcastData = await response.json();
                
                // Update page title
                document.title = podcastData.title;
                
                // Update podcast content
                document.getElementById('podcast-title').textContent = podcastData.title;
                document.getElementById('podcast-description').textContent = podcastData.description;
                
                // Load podcast image
                const podcastImage = document.getElementById('podcast-image');
                // Get image path from podcasts.json based on current podcast ID
                fetch('podcasts.json')
                    .then(response => response.json())
                    .then(data => {
                        const currentPodcast = data.podcasts.find(p => p.id === podcastParam);
                        if (currentPodcast && currentPodcast.image) {
                            podcastImage.src = currentPodcast.image;
                            podcastImage.alt = `Image du podcast ${currentPodcast.title}`;
                        }
                    });
                
                // Initialize audio player with podcast data
                initializePlayer(podcastData.audioFiles);
                
                // Show podcast container and hide loading message
                document.getElementById('loading').style.display = 'none';
                document.getElementById('podcast-container').style.display = 'block';
            } catch (error) {
                console.error('Error loading podcast:', error);
                document.getElementById('loading').textContent = 'Erreur lors du chargement du podcast. Veuillez réessayer.';
            }
        }
        
        // Initialize audio player
        function initializePlayer(audioFiles) {
            // DOM elements
            const audioPlayer = document.getElementById('audio-player');
            const playlist = document.getElementById('playlist');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const playAllBtn = document.getElementById('play-all-btn');
            
            // Clear existing playlist
            playlist.innerHTML = '';
            
            let currentTrack = 0;
            let isPlayingAll = false;

            // Create playlist items
            audioFiles.forEach((track, index) => {
                const item = document.createElement('div');
                item.className = 'playlist-item';
                item.innerHTML = `
                    <span class="speaker ${track.speaker.toLowerCase()}">${track.speaker}:</span>
                    <span>${track.text}</span>
                `;
                item.addEventListener('click', () => {
                    playTrack(index);
                });
                playlist.appendChild(item);
            });

            // Function to play a specific track
            function playTrack(index) {
                if (index >= 0 && index < audioFiles.length) {
                    currentTrack = index;
                    
                    // Update audio source
                    audioPlayer.src = audioFiles[currentTrack].file;
                    
                    // Play the audio
                    audioPlayer.play();
                    
                    // Update active class in playlist
                    updateActiveTrack();
                }
            }

            // Update the active track in the playlist
            function updateActiveTrack() {
                const items = playlist.querySelectorAll('.playlist-item');
                items.forEach((item, index) => {
                    if (index === currentTrack) {
                        item.classList.add('active');
                        // Scroll to the active item
                        item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else {
                        item.classList.remove('active');
                    }
                });
            }

            // Event listeners
            prevBtn.addEventListener('click', () => {
                playTrack(currentTrack - 1);
            });

            nextBtn.addEventListener('click', () => {
                playTrack(currentTrack + 1);
            });

            playAllBtn.addEventListener('click', () => {
                if (!isPlayingAll) {
                    isPlayingAll = true;
                    playAllBtn.textContent = 'Pause';
                    if (audioPlayer.paused) {
                        playTrack(currentTrack);
                    }
                } else {
                    isPlayingAll = false;
                    playAllBtn.textContent = 'Tout Jouer';
                    audioPlayer.pause();
                }
            });

            // When a track ends, play the next one if in "play all" mode
            audioPlayer.addEventListener('ended', () => {
                if (isPlayingAll && currentTrack < audioFiles.length - 1) {
                    playTrack(currentTrack + 1);
                } else if (currentTrack === audioFiles.length - 1) {
                    // Reset to beginning when the last track ends
                    isPlayingAll = false;
                    playAllBtn.textContent = 'Tout Jouer';
                }
            });

            // Initialize the first track
            if (audioFiles.length > 0) {
                audioPlayer.src = audioFiles[0].file;
                updateActiveTrack();
            }
        }
        
        // Load podcast data when page loads
        window.addEventListener('DOMContentLoaded', () => {
            loadPodcastsList();
            loadPodcast();
        });
    </script>
</body>
</html>
